function getOrCreateInst(e){var t=e;return null==t.__inst&&(t.__inst=new e),t.__inst}function singleton(e){Object.defineProperty(e,"Instance",{get:function(){return getOrCreateInst(e)},enumerable:!0,configurable:!0})}function applyMixins(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(i){0!=i.indexOf("__")&&"constructor"!=i&&(e.prototype[i]=t.prototype[i])})})}function isFirstType(e,t){return t(e)}function asType(e,t){return t(e)}function p2v(e){return{u:e.x,v:e.y}}function vNormalize(e){var t=Math.sqrt(e.u*e.u+e.v*e.v);return{u:e.u/t,v:e.v/t}}function pNormalize(e){var t=Math.sqrt(e.x*e.x+e.y*e.y);return{x:e.x/t,y:e.y/t}}function pNormalizeByMSq(e,t){var i=Math.sqrt(t);return{x:e.x/i,y:e.y/i}}function vAdd(e,t){return{u:e.u+t.u,v:e.v+t.v}}function pAdd(e,t){return{x:e.x+t.x,y:e.y+t.y}}function vSub(e,t){return{u:e.u-t.u,v:e.v-t.v}}function pSub(e,t){return{x:e.x-t.x,y:e.y-t.y}}function vMul(e,t){return{u:e.u*t.u,v:e.v*t.v}}function pMul(e,t){return{x:e.x*t.x,y:e.y*t.y}}function gRound(e){e.x=Math.round(e.x),e.y=Math.round(e.y),e.width=Math.round(e.width),e.height=Math.round(e.height)}function cloneRect(e){return{x:e.x,y:e.y,width:e.width,height:e.height}}function asignRect(e,t){return t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t}function ZeroV(){return{u:0,v:0}}function IdV(){return{u:1,v:1}}function ZeroPos(){return{x:0,y:0}}var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(o,r){function s(e){try{h(n.next(e))}catch(t){r(t)}}function a(e){try{h(n["throw"](e))}catch(t){r(t)}}function h(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(s,a)}h((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=t.call(e,h)}catch(n){i=[6,n],r=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,r,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},__decorate=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,s=3>r?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(3>r?o(s):r>3?o(t,i,s):o(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s},Core;!function(e){var t=function(){function e(){}return e.getInstance=function(){var e=this;return null==e.__instance&&(e.__instance=new e),e.__instance},e.prototype.destroyInstance=function(){var e=this;e.__instance&&(e.__instance=null,delete e.__instance)},e}();e.BaseSingleton=t,__reflect(t.prototype,"Core.BaseSingleton")}(Core||(Core={}));var Core;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;if(i._active=!1,i._active=!0,i.skinName=e,null==i.skinName)throw new Error(e.name);return i._skinResName=e.name?e.name:e,i}return __extends(i,t),i.prototype.destroy=function(){this._active&&(App.MessageCenter.removeByThisObj(this),this.skinName=null,this._skinResName=null,this._active=!1,App.MessageCenter.dispatch(e.AppMessageType.EUI_VIEW_DESTROY,this))},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),App.Display.moveToStageCenter(this),this.onViewReady(),App.MessageCenter.dispatch(e.AppMessageType.EUI_VIEW_READY,this)},i.prototype.callbackProccessor=function(e,t){void 0===t&&(t=null),App.CallbackMappingCenter.doCallback(this,e,t)},i.prototype.bindingCallbackProccessWith=function(e){App.CallbackMappingCenter.register(this.callbackProccessor,this,e)},Object.defineProperty(i.prototype,"skinResName",{get:function(){return this._skinResName},enumerable:!0,configurable:!0}),i.prototype.onViewReady=function(){},i}(eui.Component);e.BaseEuiView=t,__reflect(t.prototype,"Core.BaseEuiView")}(Core||(Core={})),eui.Component.prototype.getUICoord=function(e,t){t?e.localToGlobal(0,0,t):t=e.localToGlobal(0,0);var i=t.x,n=t.y;return this.localToGlobal(0,0,t),t.x=i-t.x,t.y=n-t.y,t};var Core;!function(e){var t=function(t){function i(e,i,n){void 0===i&&(i=!0),void 0===n&&(n=0);var o=t.call(this,e)||this;return o._isModal=i,o._bgMask=null,o._showTransitionType=n,o._isOnTopShow=!1,o._isNoInWinZ=!1,o}return __extends(i,t),i.prototype.destroy=function(){this._active&&(egret.Tween.removeTweens(this),App.MessageCenter.removeListener(e.AppMessageType.CLIENT_RESIZE,this.lockViewWithinWindow,this),this.btnClose&&this.btnClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnCloseTap,this),this.hideBgMask(),this.btnClose=null),t.prototype.destroy.call(this)},i.prototype.init=function(e){},i.prototype.display=function(){this.scaleX=.01,this.scaleY=.01,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.x+=this.anchorOffsetX,this.y+=this.anchorOffsetY,egret.Tween.get(this).to({scaleX:1,scaleY:1},100)},i.prototype.onBringToTop=function(e){this._isOnTopShow=!0,this.whenToTop(e)},i.prototype.onDropFromTop=function(e){this._isOnTopShow=!1,this.whenDropFromTop(e)},i.prototype.onWinOpened=function(e){this.whenOpenedNewWin(e)},i.prototype.whenOpenedNewWin=function(e){},i.prototype.whenToTop=function(e){},i.prototype.whenDropFromTop=function(e){},Object.defineProperty(i.prototype,"isOnTop",{get:function(){return this._isOnTopShow},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isModal",{get:function(){return this._isModal},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isNoInWinZ",{get:function(){return this._isNoInWinZ},enumerable:!0,configurable:!0}),i.prototype.childrenCreated=function(){this.btnClose&&this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnCloseTap,this),this._isModal&&this.parent&&this.showBgMask(),t.prototype.childrenCreated.call(this),this.doTransition()},i.prototype.doTransition=function(){switch(this._showTransitionType){case 1:var e=this.y;this.alpha=0,this.y+=100,egret.Tween.get(this).to({alpha:1,y:e},600,egret.Ease.backInOut).call(this.onViewStay,this);break;case 0:this.onViewStay()}},i.prototype.onViewStay=function(){},i.prototype.showBgMask=function(){null==this._bgMask&&(this._bgMask=new e.Views.BgMask(this.parent,!0,.6),this._bgMask.show(this.parent.getChildIndex(this)))},i.prototype.hideBgMask=function(){this._bgMask&&(this._bgMask.destroy(),this._bgMask=null)},i.prototype.onBtnCloseTap=function(t){App.MessageCenter.dispatch(e.AppMessageType.CLOSE_EUI_VIEW,this)},i.prototype.lockViewWithinWindow=function(){if(this.parent){var e=App.LayoutSyncManager.clientWidth,t=App.LayoutSyncManager.clientHeight;if(e<this.width||t<this.height){var i=Math.min(e/this.width,t/this.height);this.scaleX=this.scaleY=i,this.x=App.LayoutSyncManager.clientLeft+(e-this.width*i)/2,this.y=App.LayoutSyncManager.clientTop+(t-this.height*i)/2}}},Object.defineProperty(i.prototype,"visible",{get:function(){return this.visible},set:function(e){t.prototype.$setVisible.call(this,e),this._bgMask&&(this._bgMask.visible=e)},enumerable:!0,configurable:!0}),i}(e.BaseEuiView);e.BaseEuiWindow=t,__reflect(t.prototype,"Core.BaseEuiWindow")}(Core||(Core={}));var Core;!function(e){var t=function(){function t(){this._cache={},this._loadingCache=new Array}return t.prototype.dealSoundTimer=function(){for(var t=egret.getTimer(),i=Object.keys(this._cache),n=0,o=i.length;o>n;n++){var r=i[n];this.checkCanClear(r)&&t-this._cache[r]>=e.SoundManager.CLEAR_TIME&&(delete this._cache[r],RES.destroyRes(r))}},t.prototype.getSound=function(e){var t=RES.getRes(e);if(t)this._cache[e]&&(this._cache[e]=egret.getTimer());else{if(-1!=this._loadingCache.indexOf(e))return null;this._loadingCache.push(e),RES.getResAsync(e,this.onResourceLoadComplete,this)}return t},t.prototype.onResourceLoadComplete=function(e,t){var i=this._loadingCache.indexOf(t);-1!=i&&(this._loadingCache.splice(i,1),this._cache[t]=egret.getTimer(),this.loadedPlay(t))},t.prototype.loadedPlay=function(e){},t.prototype.checkCanClear=function(e){return!0},t}();e.BaseSound=t,__reflect(t.prototype,"Core.BaseSound")}(Core||(Core={}));var Core;!function(e){var t=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._active=!1,e}return __extends(i,t),i.prototype.beginProc=function(t,i,n){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=!1),this._active=!0,this._bindingViewClass=t,this._viewResGroup=i,this._autoEndProcWithViewDestroy=n,this._bindingViewClass&&(this._bindingView&&this.closeView(),App.CallbackMappingCenter.register(this.doCallbackProcessor,this,this._bindingViewClass),App.MessageCenter.addListener(e.AppMessageType.EUI_VIEW_READY,this.onViewReady,this),App.MessageCenter.addListener(e.AppMessageType.EUI_VIEW_DESTROY,this.onViewDestroy,this),this._bindingViewClass.prototype instanceof e.BaseEuiWindow?App.WindowViewManager.show(this._bindingViewClass,this._viewResGroup):App.SceneViewManager["switch"](this._bindingViewClass,this._viewResGroup))},i.prototype.endProc=function(){this.closeView(),this._bindingViewClass&&(App.CallbackMappingCenter.unRegisterByThisObj(this),this._bindingViewClass=null),this._bindingView=null,this._viewResGroup=null,this._active=!1},i.prototype.viewReady=function(){},i.prototype.doCallbackProcessor=function(e,t){},i.prototype.closeView=function(){this._bindingViewClass&&(App.MessageCenter.removeListener(e.AppMessageType.EUI_VIEW_READY,this.onViewReady,this),App.MessageCenter.removeListener(e.AppMessageType.EUI_VIEW_DESTROY,this.onViewDestroy,this)),this._bindingView&&(App.MessageCenter.dispatch(e.AppMessageType.CLOSE_EUI_VIEW,this._bindingView),this._bindingView=null)},i.prototype.onViewReady=function(t){t&&t instanceof this._bindingViewClass&&(App.MessageCenter.removeListener(e.AppMessageType.EUI_VIEW_READY,this.onViewReady,this),this._bindingView=t,this.viewReady())},i.prototype.onViewDestroy=function(e){e&&this._bindingView==e&&this._autoEndProcWithViewDestroy&&this.endProc()},Object.defineProperty(i.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),i}(e.BaseSingleton);e.BaseProc=t,__reflect(t.prototype,"Core.BaseProc")}(Core||(Core={}));var Core;!function(e){var t=function(){function e(){this._bmpPool={},this._bmpList=[],this._occupiedBmpList=[]}return e.prototype.pickUp=function(e,t){void 0===t&&(t=!0);var i=null;if(this._bmpPool.hasOwnProperty(e)||(this._bmpPool[e]=new Utility.HandyArray(50,!0)),i=this._bmpPool[e],i.length>0)return i.dequeue();var n=App.Display.createBitmap(e,t);return n?n:(console.log("bmp is NOT exists: "+e),null)},e.prototype.putDown=function(t){var i=null;this._bmpPool.hasOwnProperty(t.name)||(this._bmpPool[t.name]=new Utility.HandyArray(e.MAX_COUNT,!0)),i=this._bmpPool[t.name],i.enqueue(t)},e.prototype.cleanUp=function(){Log.trace("BitmapPool开始整理");for(var t in this._bmpPool){var i=this._bmpPool[t];if(i.length>0){Log.trace("Bitmap "+t+"数量："+i.length);var n=i.length-e.MAX_COUNT;for(n>0&&Log.trace("  删除 Bitmap "+n);i.length>e.MAX_COUNT;){var o=i.dequeue();o.texture=null}i.reset()}}Log.trace("BitmapPool整理完毕")},e.prototype.clear=function(){for(var e=0,t=this._bmpList;e<t.length;e++){var i=t[e];i.texture=null,i.name=void 0}App.Tool.clearArray(this._bmpList),this._bmpList=null,App.Tool.clearArray(this._occupiedBmpList),this._occupiedBmpList=null},e.MAX_COUNT=200,e}();e.BitmapPool=t,__reflect(t.prototype,"Core.BitmapPool")}(Core||(Core={}));var Core;!function(e){var t=function(){function e(){this._objList=[],this._occupiedList=[]}return e.prototype.pickUp=function(e){for(var t=null,i=0,n=this._objList;i<n.length;i++){var o=n[i];if(o instanceof e&&this._occupiedList.indexOf(o)<0){t=o,this._occupiedList.push(o);break}}return null==t&&(t=new e,this._objList.push(t),this._occupiedList.push(t)),t},e.prototype.putDown=function(e){var t=this._occupiedList.indexOf(e);t>=0&&this._occupiedList.splice(t,1)},e.prototype.clear=function(){App.Tool.clearArray(this._objList),this._objList=null,App.Tool.clearArray(this._occupiedList),this._occupiedList=null},e}();e.ObjectPool=t,__reflect(t.prototype,"Core.ObjectPool")}(Core||(Core={}));var FrameListPlayerPool=function(){function e(){this._playerList=[],this._occupiedPlayerList=[]}return e.prototype.pickUp=function(e){for(var t=null,i=0,n=this._playerList;i<n.length;i++){var o=n[i];if(o.name==e&&this._occupiedPlayerList.indexOf(o)<0){t=o,this._occupiedPlayerList.push(o);break}}return null==t&&(t=this.createPlayer(e),this._playerList.push(t),this._occupiedPlayerList.push(t)),t},e.prototype.putDown=function(e){var t=this._occupiedPlayerList.indexOf(e);t>=0&&this._occupiedPlayerList.splice(t,1)},e.prototype.createPlayer=function(e){var t=new FrameListPlayer;switch(t.name=e,e){case"StoneLineRemove":t.addFrameList(["TCS_XC_0000_png","TCS_XC_0001_png","TCS_XC_0002_png","TCS_XC_0003_png","TCS_XC_0004_png","TCS_XC_0005_png","TCS_XC_0006_png","TCS_XC_0007_png"],0,-78),t.scaleX=t.scaleY=2;break;case"BodyNodeRemove":t.addFrameList(["TCS_BD_0000_png","TCS_BD_0001_png","TCS_BD_0002_png","TCS_BD_0003_png","TCS_BD_0004_png","TCS_BD_0005_png"],-128,-128);break;case"EatBonus":t.addFrameList(["chibaoshi_0000_png","chibaoshi_0001_png","chibaoshi_0002_png","chibaoshi_0003_png","chibaoshi_0004_png","chibaoshi_0005_png"],-64,-64),t.scaleX=t.scaleY=2;break;case"BattleAttack":t.addFrameList(["baoleixiaochu_0000_png","baoleixiaochu_0001_png","baoleixiaochu_0002_png","baoleixiaochu_0003_png","baoleixiaochu_0004_png"]),t.scaleX=t.scaleY=4;break;case"BattleInjure":t.addFrameList(["shouji_0000_png","shouji_0001_png","shouji_0002_png","shouji_0003_png"]),t.scaleX=t.scaleY=4}return t},e}();__reflect(FrameListPlayerPool.prototype,"FrameListPlayerPool");var Utility;!function(e){var t=function(){function e(e,t){this.init(e,t)}return e.prototype.init=function(e,t){this._delegateMethod=e,this._theObj=t},e.prototype.run=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._delegateMethod&&(e?this._delegateMethod.apply(this._theObj,e):this._delegateMethod.apply(this._theObj))},e}();e.Delegate=t,__reflect(t.prototype,"Utility.Delegate");var i=function(){function t(){this._listeners={}}return t.prototype.addListener=function(t,i,n){var o=null;if(t&&i){var r=this._listeners[t];if(r){if(o=this._getDelegate(t,i,n,r))return}else r=[],this._listeners[t]=r;o=new e.Delegate(i,n),r.push(o)}},t.prototype._getDelegate=function(e,t,i,n){if(void 0===n&&(n=null),n||(n=this._listeners[e]),n)for(var o=0,r=n.length;r>o;o++)if(n[o]._theObj==i&&n[o]._delegateMethod==t)return n[o];return null},t.prototype.removeListener=function(e,t,i){if(e){var n=this._listeners[e];if(!n)return;for(var o=0,r=n.length;r>o;o++)if(n[o]._theObj==i&&n[o]._delegateMethod==t){n.splice(o,1);break}n.length<=0&&delete this._listeners[e]}},t.prototype.removeByType=function(e){if(e){var t=this._listeners[e];if(!t)return;App.Tool.clearArray(t),delete this._listeners[e]}},t.prototype.removeByThisObj=function(e){if(e)for(var t in this._listeners){var i=this._listeners[t];if(i&&!(i.length<=0)){for(var n=0;n<i.length;n++)i[n]._theObj==e&&(i.splice(n,1),n--);i.length<=0&&delete this._listeners[t]}}},t.prototype.dispatch=function(e,t){if(void 0===t&&(t=null),e){var i=[],n=this._listeners[e];if(n&&!(n.length<=0)){for(var o=0,r=n.length;r>o;o++)i.push(n[o]);if(i.length>0){for(o=0,r=i.length;r>o;o++)i[o].run(t);App.Tool.clearArray(i)}}}},t}();e.Observable=i,__reflect(i.prototype,"Utility.Observable")}(Utility||(Utility={}));var Core;!function(e){var t;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.skinName=e.AppConst.SKIN_PATH+"assets/ConfirmSkin.exml",i.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onBtn1Tap,i),i.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onBtn2Tap,i),i}return __extends(i,t),i.prototype.destroy=function(){this.btn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn1Tap,this),this.btn2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn2Tap,this),this._bgMask&&(this._bgMask.destroy(),this._bgMask=null),this.skinName=null,this.txt1.text="",this._callBackFunc=null,this._thisObj=null},i.prototype.show=function(t,i,n,o,r,s,a){void 0===a&&(a=!0),null==t&&(t=""),this.txt1.text=t,this._callBackFunc=i,this._thisObj=n,this.btn1.label=o,this.btn2.label=r,s.addChild(this),a&&App.Display.moveToStageCenter(this),this._bgMask=new e.Views.BgMask(this,!0),this._bgMask.show(0),this.alpha=0,egret.Tween.get(this).to({alpha:1},200)},i.prototype.hide=function(){var e=this;egret.Tween.get(this).to({alpha:0},300).call(function(){App.Display.removeFromParent(e),e.destroy()},this)},i.prototype.onBtn1Tap=function(e){this._callBackFunc&&this._callBackFunc.apply(this._thisObj,[0]),this.hide()},i.prototype.onBtn2Tap=function(e){this._callBackFunc&&this._callBackFunc.apply(this._thisObj,[1]),this.hide()},i}(eui.Component);t.ConfirmView=i,__reflect(i.prototype,"Core.Views.ConfirmView")}(t=e.Views||(e.Views={}))}(Core||(Core={}));var AppConfig=function(){function e(){}return e.isDebug=!1,e.traceHttp=!1,e.traceHttpUrl=!1,e.timeLimit=90,e.isRelease=!0,e.textGuide=!1,e.uploadStat=!1,e.ver="0.1.0",e}();__reflect(AppConfig.prototype,"AppConfig");var Core;!function(e){var t=function(){function e(){}return e.SKIN_PATH="resource/skins/",e}();e.AppConst=t,__reflect(t.prototype,"Core.AppConst")}(Core||(Core={}));var Core;!function(e){var t=function(){function e(){}return e.APP_START="app_start",e.CLIENT_RESIZE="app_client_resize",e.EUI_VIEW_READY="app_eui_view_ready",e.EUI_VIEW_DESTROY="app_eui_view_destroy",e.CLOSE_EUI_VIEW="app_close_eui_view",e.SOCKET_DISCONNECT="app_socket_disconnect",e.EUI_VIEW_ADDED="eui_view_added",e.EUI_VIEW_REMOVED="eui_view_removed",e}();e.AppMessageType=t,__reflect(t.prototype,"Core.AppMessageType")}(Core||(Core={}));var Core;!function(e){var t=function(){function e(){}return e.NUM="0123456789",e.NUM_LETTER="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e}();e.FilterCharsType=t,__reflect(t.prototype,"Core.FilterCharsType")}(Core||(Core={}));var Core;!function(e){var t=function(){function e(){}return e.LEFT=37,e.RIGHT=39,e.UP=38,e.DOWN=40,e.W=87,e.A=65,e.S=83,e.D=68,e.J=74,e.K=75,e.L=76,e.U=85,e.I=73,e.O=79,e.P=80,e.SPACE=32,e}();e.KeyboardConst=t,__reflect(t.prototype,"Core.KeyboardConst")}(Core||(Core={}));var Core;!function(e){var t=function(){function e(){}return e.LOGIN_NAME="login_name",e.LOGIN_PASSWORD="login_password",e.LOGIN_CRYPT="login_crypt",e.SOUND_FX_ENABLE="sound_fx_enable",e.SOUND_BG_ENABLE="sound_bg_enable",e.SOUND_FX_VOLUME="sound_fx_volume",e.SOUND_BG_VOLUME="sound_bg_volume",e.SHOW_SYS_MESSAGE="show_sys_message",e.DEFAULT_VALUE={sound_fx_enable:"true",sound_bg_enable:"true",sound_fx_volume:"50",sound_bg_volume:"50",mobile_bound:"false",show_sys_message:"true"},e}();e.LocalStorageType=t,__reflect(t.prototype,"Core.LocalStorageType")}(Core||(Core={}));var Core;!function(e){var t=function(){function e(){}return e.SOCKET_OPEN="SOCKET_OPEN",e.SOCKET_RECONNECT="SOCKET_RECONNECT",e.SOCKET_CLOSE="SOCKET_CLOSE",e.SOCKET_DATA="SOCKET_DATA",e.SOCKET_IOERROR="SOCKET_IOERROR",e.SOCKET_DEBUG_INFO="SOCKET_DEBUG_INFO",e}();e.SocketEventType=t,__reflect(t.prototype,"Core.SocketEventType")}(Core||(Core={}));var Core;!function(e){var t=function(){function e(){this._traceHttp=AppConfig.traceHttp,this._traceHttpUrl=AppConfig.traceHttpUrl,this._requestCache=[],this._request=new egret.URLRequest,this._request.method=egret.URLRequestMethod.POST,this._urlLoader=new egret.URLLoader,this._urlLoader.addEventListener(egret.Event.COMPLETE,this.onLoaderComplete,this),this._urlLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoaderError,this)}return e.prototype.destroy=function(){this._urlLoader.removeEventListener(egret.Event.COMPLETE,this.onLoaderComplete,this),this._urlLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoaderError,this),this._urlLoader=null,this._request=null,this._requestCache=null,this._requestData=null},e.prototype.send=function(e,t,i){this._requestCache.push({key:e,url:t,showloading:i}),this.request()},e.prototype.request=function(){if(!this._isRequesting&&0!=this._requestCache.length){this._requestData=this._requestCache.shift();var e=this._requestData.url;this._request.url=e,this._traceHttp&&Log.trace(" >>发送Http数据, key = "+this._requestData.key+", urlLen = "+e.length),this._urlLoader.load(this._request),this._isRequesting=!0,this._requestData.showloading&&App.LoopLoading.show(null),this._traceHttpUrl&&Log.trace(e)}},e.prototype.onLoaderComplete=function(e){this._requestData.showloading&&App.LoopLoading.hide();var t=e.target,i=t.data,n=this._requestData.key;this._traceHttp&&Log.trace("<<收到Http数据, key = "+n+", len = "+i.length);var o=JSON.parse(i);o["Http-Message-Key"]=n,App.MessageCenter.dispatch(n,o),this.nextPost()},e.prototype.onLoaderError=function(){this._requestData.showloading&&App.LoopLoading.hide();var e=this._requestData.key;Log.trace("<<收到Http数据, key = "+e+" IO_ERROR"),App.MessageCenter.dispatch(e,null),this.nextPost()},e.prototype.nextPost=function(){this._isRequesting=!1,this.request()},e}();e.HttpComm=t,__reflect(t.prototype,"Core.HttpComm")}(Core||(Core={}));var Core;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.setup=function(e){this._host=e,this._token=null},t.prototype.request=function(e,t,i){function n(e){var n=e.currentTarget;Log.trace("<<HTTP Response: "+n.response);var o=JSON.parse(n.response);void 0!=o.token&&(this._token=o.token),t.call(i,o)}function o(e){Log.trace("<<HTTP Response: IO_ERROR"),t.call(i,{result:"IO_ERROR"})}void 0===t&&(t=null),void 0===i&&(i=null);var r;r=0==e.toLowerCase().indexOf("https://")?e:this._host+e;var s=new egret.HttpRequest;s.responseType=egret.HttpResponseType.TEXT,null!=t&&(s.addEventListener(egret.Event.COMPLETE,n,this),s.addEventListener(egret.IOErrorEvent.IO_ERROR,o,this)),s.open(r,egret.HttpMethod.GET),this._token&&s.setRequestHeader("Token",this._token),Log.trace("  >>HTTP Request: "+r),s.send()},t}(e.BaseSingleton);e.HttpMod=t,__reflect(t.prototype,"Core.HttpMod")}(Core||(Core={}));var DebugPlatform=function(){function e(){}return e.prototype.platformRuntime=function(){return""},e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.request=function(e,t,i){if(XMLHttpRequest){var n=new XMLHttpRequest;n.open(t,e,!0);var o=!0;i&&o?n.setRequestHeader("Content-Type","application/json"):n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),Log.trace("Ajax",e);var r=new Promise(function(e,t){n.onreadystatechange=function(){if(4==n.readyState)if(n.status>=200)if("application/json"===n.getResponseHeader("content-type")){var t=JSON.parse(n.responseText);e({data:t,errMsg:"request:ok"})}else e({data:n.responseText,errMsg:"request:ok"});else e({errMsg:"request:fail-"})}});if(i)if(o)Log.trace("Ajax",i),n.send(JSON.stringify(i));else{var s=[];for(var a in i)s.push(a+"="+i[a]);if(s.length){var h=s.join("&");Log.trace("Ajax",h),n.send(h)}else n.send(null)}else n.send(null);return r}},e.prototype.showModal=function(e,t){},e.prototype.onShow=function(e){},e.prototype.onHide=function(e){},e.prototype.getLaunchOptionsSync=function(){return{}},e.prototype.getSystemInfoSync=function(){return{}},e.prototype.triggerGC=function(){},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Core;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t._currBg="",t}return __extends(t,e),t.prototype.stop=function(){this._currSoundChannel&&0!=this._currSoundChannel.position&&this._currSoundChannel.stop(),this._currSoundChannel=null,this._currSound=null,this._currBg=""},t.prototype.play=function(e){if(this._currBg!=e){this.stop(),this._currBg=e;var t=this.getSound(e);t&&this.playSound(t)}},t.prototype.playSound=function(e){this._currSound=e,this._currSoundChannel=this._currSound.play(0,999999),this._currSoundChannel.volume=this._volume},t.prototype.setVolume=function(e){this._volume=e,this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},t.prototype.loadedPlay=function(e){this._currBg==e&&this.playSound(RES.getRes(e))},t.prototype.checkCanClear=function(e){return this._currBg!=e},t}(e.BaseSound);e.SoundBg=t,__reflect(t.prototype,"Core.SoundBg")}(Core||(Core={}));var Core;!function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.play=function(e,t){var i=this.getSound(e);i&&this.playSound(i,t)},i.prototype.stop=function(){this._channel&&(this._channel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onSoundPlayComplete,this),this._channel.stop(),this._channel=null),this._sound=null,this._loopCount=0},i.prototype.updateVolume=function(){this._channel&&0!=this._channel.position&&(this._channel.volume=e.SoundEffect.volume)},i.prototype.playSound=function(t,i){this._channel&&0!=this._channel.position&&(this._channel.position=0),this._sound=t,this._channel=this._sound.play(0,1),this._channel.volume=e.SoundEffect.volume,i>1&&(this._loopCount=i,this._channel.addEventListener(egret.Event.SOUND_COMPLETE,this.onSoundPlayComplete,this))},i.prototype.onSoundPlayComplete=function(t){this._channel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onSoundPlayComplete,this),this._loopCount--,this._loopCount>0?(this._channel=this._sound.play(0,1),this._channel.volume=e.SoundEffect.volume,this._channel.addEventListener(egret.Event.SOUND_COMPLETE,this.onSoundPlayComplete,this)):this.stop()},i}(e.BaseSound);e.SoundEffect=t,__reflect(t.prototype,"Core.SoundEffect")}(Core||(Core={}));var Core;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i._bgOn=!0,i._bgVolume=1,i._effectVolume=1,i._bg=new e.SoundBg,i._bg.setVolume(i._bgVolume),i._effect=new e.SoundEffect,e.SoundEffect.volume=i._effectVolume,i}return __extends(i,t),i.prototype.playEffect=function(e,t){void 0===t&&(t=1),this._effect.play(e,t)},i.prototype.stopEffect=function(){this._effect.stop()},i.prototype.playBg=function(e){this._currBg=e,this._bgOn&&this._bg.play(e)},i.prototype.stopBg=function(){this._bg.stop()},i.prototype.setEffectOn=function(t){t?e.SoundEffect.volume=this._effectVolume:e.SoundEffect.volume=0,this._effect.updateVolume()},i.prototype.setBgOn=function(e){this._bgOn=e,this._bgOn?this._currBg&&this.playBg(this._currBg):this.stopBg()},i.prototype.setBgVolume=function(e){e/=100,e=Math.min(e,1),e=Math.max(e,0),this._bgVolume=e,this._bg.setVolume(this._bgVolume)},i.prototype.getBgVolume=function(){return this._bgVolume},i.prototype.setEffectVolume=function(t){t/=100,t=Math.min(t,1),t=Math.max(t,0),this._effectVolume=t,e.SoundEffect.volume=this._effectVolume,this._effect.updateVolume()},i.prototype.getEffectVolume=function(){return this._effectVolume},i.CLEAR_TIME=18e4,i}(e.BaseSingleton);e.SoundManager=t,__reflect(t.prototype,"Core.SoundManager")}(Core||(Core={}));var Core;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._callbackFunctionList=[],t._callbackThisList=[],t._vClassList=[],t}return __extends(t,e),t.prototype.register=function(e,t,i){this._callbackFunctionList.push(e),this._callbackThisList.push(t),this._vClassList.push(i)},t.prototype.unRegister=function(e){for(var t=this._callbackFunctionList.length-1;t>=0;t--)this._callbackFunctionList[t]==e&&(this._callbackFunctionList.splice(t,1),this._callbackThisList.splice(t,1),this._vClassList.splice(t,1))},t.prototype.unRegisterByThisObj=function(e){for(var t=this._callbackThisList.length-1;t>=0;t--)this._callbackThisList[t]==e&&(this._callbackFunctionList.splice(t,1),this._callbackThisList.splice(t,1),this._vClassList.splice(t,1))},t.prototype.doCallback=function(e,t,i){void 0===i&&(i=null);var n=App.CallbackMappingCenter.getCallFunctionList(e);if(n.length>0)for(var o,r,s=0;s<n.length;s++)o=n[s],r=App.CallbackMappingCenter.getCallFunctionThis(e,o),null!=o&&null!=r&&o.call(r,t,i)},t.prototype.getCallFunctionList=function(e){for(var t=[],i=0;i<this._vClassList.length;i++)e instanceof this._vClassList[i]&&t.push(this._callbackFunctionList[i]);return t},t.prototype.getCallFunctionThis=function(e,t){for(var i=0;i<this._vClassList.length;i++)if(this._callbackFunctionList[i]==t&&e instanceof this._vClassList[i])return this._callbackThisList[i];return null},t}(e.BaseSingleton);e.CallbackMappingCenter=t,__reflect(t.prototype,"Core.CallbackMappingCenter")}(Core||(Core={}));var Core;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.startSoundCompatible=function(){var e=function(t){App.LayerManager.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,e,this),App.SoundManager.playEffect("dt_base_sound_mp3")};App.LayerManager.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,e,this)},t}(e.BaseSingleton);e.CompatibleMod=t,__reflect(t.prototype,"Core.CompatibleMod")}(Core||(Core={}));var Core;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"isWeiXin",{get:function(){return navigator.userAgent.toLowerCase().indexOf("micromessenger")>=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsHtml5",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsMobile",{get:function(){return egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsPC",{get:function(){return!egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsQQBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsIEBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsFirefoxBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsChromeBrowser",{get:function(){return this.IsHtml5&&navigator.userAgent.indexOf("Chrome")>=0&&navigator.userAgent.indexOf("Safari")<0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsSafariBrowser",{get:function(){return this.IsHtml5&&navigator.userAgent.indexOf("Safari")>=0&&navigator.userAgent.indexOf("Chrome")<0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsOperaBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")},enumerable:!0,configurable:!0}),t}(e.BaseSingleton);e.DeviceMod=t,__reflect(t.prototype,"Core.DeviceMod")
}(Core||(Core={}));var Core;!function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.removeFromParent=function(e,t){void 0===t&&(t=!1),e&&e.parent&&(e.parent&&e.parent.removeChild(e),t&&(e.scaleX=e.scaleY=e.rotation=e.skewY=e.skewY=0,e.alpha=1))},i.prototype.clearDisplayContainer=function(e,t,i,n){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===n&&(n=!1);for(var o,r=e.numChildren-1;r>=0;r--)o=e.removeChildAt(r),t&&o.destroy&&o.destroy(),i&&(o.texture&&(o.texture=null),o.source&&(o.source=null),o.text&&(o.text=null)),n&&o.numChildren&&this.clearDisplayContainer(o,i,n)},i.prototype.createBitmap=function(e,t,i,n){void 0===t&&(t=!1),void 0===i&&(i=0),void 0===n&&(n=0);var o=new egret.Bitmap;return o.texture=RES.getRes(e),o.name=e,t&&(o.anchorOffsetX=o.texture.textureWidth/2,o.anchorOffsetY=o.texture.textureHeight/2),0!=i&&(o.x=i),0!=n&&(o.y=n),o},i.prototype.loadBitmapTexture=function(e,t){RES.getResAsync(t,function(t){e.texture=t},null)},i.prototype.loadImageSource=function(e,t){RES.getResAsync(t,function(t){e.source=t},null)},i.prototype.loadImageByUrl=function(e,t){var i=new egret.ImageLoader;i.addEventListener(egret.Event.COMPLETE,function(t){var i=new egret.Texture;i._setBitmapData(t.currentTarget.data),e.texture&&e.texture.dispose(),e.texture=i},this),i.load(t)},i.prototype.addLableStroke=function(e,t,i){e.strokeColor=t,e.stroke=i},i.prototype.addGrayFlilter=function(t){t.filters=[e.DisplayUtilMod.GrayMatrixFilter]},i.prototype.removeGrayFlilter=function(e){e.filters=[]},i.prototype.moveToStageCenter=function(e){if(e&&e.stage){var t=e.localToGlobal(e.x,e.y),i=(App.LayerManager.stage.stageWidth-t.x-t.x-e.width)/2,n=(App.LayerManager.stage.stageHeight-t.y-t.y-e.height)/2;e.x+=i,e.y+=n}},i.prototype.pushTop=function(e){if(e){var t=e.parent;t&&t.setChildIndex(e,t.numChildren)}},i.prototype.localToLocal=function(e,t,i,n){for(void 0===n&&(n=!1);e&&e.parent;)n?(i.x+=e.x,i.y+=e.y):(i.x+=e.x/e.scaleX,i.y+=e.y/e.scaleY),e=e.parent;for(;t&&t.parent;)n?(i.x-=t.x,i.y-=t.y):(i.x-=t.x/t.scaleX,i.y-=t.y/t.scaleY),t=t.parent;n&&(i.x-=App.LayoutSyncManager.clientLeft,i.y-=App.LayoutSyncManager.clientTop)},i.prototype.isChildOf=function(e,t){for(;e;){if(e==t)return!0;e=e.parent}return!1},i.prototype.addAutoScaleEffect=function(e,t){void 0===t&&(t=.01),e&&(e.ssSpeed=t,e.scaleX=e.scaleY=1,App.GlobalRepeatTigger.addTime(30,this.updateAutoScale,e))},i.prototype.removeAutoScaleEffect=function(e){e&&(App.GlobalRepeatTigger.removeTime(this.updateAutoScale,e),e.scaleX=e.scaleY=1,delete e.ssSpeed)},i.prototype.updateAutoScale=function(){this.scaleX+=this.ssSpeed,this.scaleY+=this.ssSpeed,(this.scaleX>1.1||this.scaleX<.9)&&(this.ssSpeed=-this.ssSpeed)},i.prototype.addAutoFlashEffect=function(e,t){void 0===t&&(t=.05),e&&(e.sfSpeed=t,e.alpha=1,App.GlobalRepeatTigger.addTime(30,this.updateAutoFlash,e))},i.prototype.removeAutoFlashEffect=function(e){e&&(App.GlobalRepeatTigger.removeTime(this.updateAutoFlash,e),e.alpha=1,delete e.sfSpeed)},i.prototype.updateAutoFlash=function(){this.alpha+=this.sfSpeed,(this.alpha>1.1||this.alpha<-.1)&&(this.sfSpeed=-this.sfSpeed)},i.prototype.tweenLabelNumber=function(e,t,i,n,o){if(void 0===i&&(i=.2),void 0===n&&(n=""),void 0===o&&(o=""),i>1&&(i=1),.01>i&&(i=.01),1==i)return void(e.text=n+t+o);var r=parseInt(e.text);isNaN(r)&&(r=0);var s=function(){r+=(t-r)*i,e.text=n+Math.round(r)+o,Math.abs(t-r)<=1&&(App.GlobalRepeatTigger.removeFrame(s,e),e.text=n+t+o)};App.GlobalRepeatTigger.addFrame(s,e)},i.prototype.addButtonPushEffect=function(e,t,i){void 0===i&&(i=null),null!=t&&(e.pushCallback=t),null!=i&&(e.pushCallbackThis=i),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnPush,this)},i.prototype.removeButtonPushEffect=function(e){delete e.pushCallback,delete e.pushCallbackThis,e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnPush,this)},i.prototype.onBtnPush=function(e){var t=e.currentTarget;t&&(Game.SoundManager.playSound("button"),egret.Tween.get(t).to({scaleX:.85,scaleY:.85},200,egret.Ease.quadIn).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut).call(function(){t&&t.pushCallback&&t.pushCallbackThis&&t.pushCallback.call(t.pushCallbackThis,t)},this))},i.prototype.playHeartBeatEffect=function(e,t,i){void 0===t&&(t=1.2),void 0===i&&(i=500),egret.Tween.get(e).to({scaleX:t,scaleY:t},.4*i,egret.Ease.quadIn).to({scaleX:1,scaleY:1},.6*i,egret.Ease.bounceOut)},i.GrayMatrixFilter=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),i}(e.BaseSingleton);e.DisplayUtilMod=t,__reflect(t.prototype,"Core.DisplayUtilMod")}(Core||(Core={}));var Core;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t._timeHandleList=[],t._frameHandleList=[],t._currTime=egret.getTimer(),t._count=0,egret.Ticker.getInstance().register(t.onEnterFrame,t),t}return __extends(t,e),t.prototype.onEnterFrame=function(){if(this._timeHandleList.length>0)for(var e,t=egret.getTimer(),i=0;i<this._timeHandleList.length;i++)e=this._timeHandleList[i],t-e.lastTime>=e.interval&&(e.lastTime=t,e.method.apply(e.thisObj));if(this._frameHandleList.length>0)for(var i=0;i<this._frameHandleList.length;i++)e=this._frameHandleList[i],e.method.apply(e.thisObj)},t.prototype.addTime=function(e,t,i,n){void 0===n&&(n=!1),this.removeTime(t,i);var o={interval:e,method:t,thisObj:i,lastTime:egret.getTimer()};this._timeHandleList.push(o),n&&t.apply(i)},t.prototype.removeTime=function(e,t){for(var i,n=this._timeHandleList.length-1;n>=0;n--)i=this._timeHandleList[n],i.method==e&&i.thisObj==t&&this._timeHandleList.splice(n,1)},t.prototype.addFrame=function(e,t,i){void 0===i&&(i=!1),this.removeFrame(e,t);var n={method:e,thisObj:t};this._frameHandleList.push(n),i&&e.apply(t)},t.prototype.removeFrame=function(e,t){for(var i,n=this._frameHandleList.length-1;n>=0;n--)i=this._frameHandleList[n],i.method==e&&i.thisObj==t&&this._frameHandleList.splice(n,1)},t}(e.BaseSingleton);e.GlobalRepeatTigger=t,__reflect(t.prototype,"Core.GlobalRepeatTigger")}(Core||(Core={}));var Core;!function(e){var t=function(e){function t(){var t=e.call(this)||this;if(t.key_ups=new Array,t.key_downs=new Array,App.Device.IsHtml5){var i=t;document.addEventListener("keyup",function(e){for(var t=0,n=i.key_ups.length;n>t;t++){var o=i.key_ups[t][0],r=i.key_ups[t][1];r?o.call(r,e.keyCode):o(e.keyCode)}}),document.addEventListener("keydown",function(e){for(var t=0,n=i.key_downs.length;n>t;t++){var o=i.key_downs[t][0],r=i.key_downs[t][1];r?o.call(r,e.keyCode):o(e.keyCode)}})}return t}return __extends(t,e),t.prototype.addKeyUp=function(e,t){this.key_ups.push([e,t])},t.prototype.addKeyDown=function(e,t){this.key_downs.push([e,t])},t.prototype.removeKeyUp=function(e,t){for(var i=0;i<this.key_ups.length;i++)this.key_ups[i][0]==e&&this.key_ups[i][1]==t&&(this.key_ups.splice(i,1),i--)},t.prototype.removeKeyDown=function(e,t){for(var i=0;i<this.key_downs.length;i++)this.key_downs[i][0]==e&&this.key_downs[i][1]==t&&(this.key_downs.splice(i,1),i--)},t}(e.BaseSingleton);e.KeyboardMod=t,__reflect(t.prototype,"Core.KeyboardMod")}(Core||(Core={}));var Core;!function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.load=function(t){var i=egret.localStorage.getItem(t);return null==i&&(i=e.LocalStorageType.DEFAULT_VALUE[t]),("undefined"==i||void 0==i)&&(i=null),i},i.prototype.save=function(e,t){egret.localStorage.setItem(e,t)},i}(e.BaseSingleton);e.LocalStorageData=t,__reflect(t.prototype,"Core.LocalStorageData")}(Core||(Core={}));var Core;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onceList=[],t}return __extends(t,e),t.prototype.load=function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=-100),-1==this._onceList.indexOf(e)&&(RES.loadGroup(e,i),t&&this._onceList.push(e))},t.prototype.free=function(e){RES.destroyRes(e);var t=this._onceList.indexOf(e);t>=0&&this._onceList.splice(t,1)},t}(e.BaseSingleton);e.PreLoadManager=t,__reflect(t.prototype,"Core.PreLoadManager")}(Core||(Core={}));var Core;!function(e){var t=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i._delayGroupMap=new e.HashMap,i}return __extends(i,t),i.prototype.delayApply=function(e,t,i,n,o,r){var s=this;if(void 0===n&&(n=null),void 0===o&&(o=!1),void 0===r&&(r=null),null!=i)if(o)i.apply(t,n);else{var a=egret.setTimeout(function(){(void 0==s.active||1==s.active)&&i.apply(s,n)},t,e,n);if(r){var h=this._delayGroupMap.getValue(r);null==h&&(h=[],this._delayGroupMap.add(r,h)),h.push(a)}}},i.prototype.clearDelayByGroup=function(e){if(e){var t=this._delayGroupMap.remove(e);if(t){for(var i=0;i<t.length;i++)clearTimeout(t[i]);App.Tool.clearArray(t)}}},i.prototype.convertAmount=function(e){if(void 0==e||0>e)return"0";for(var t=e.toString(),i="",n=0,o=t.length-1;o>=0;o--)i=t.charAt(o)+i,n++,3==n&&(o>0&&(i=","+i),n=0);return i},i.prototype.convertIntegerNum=function(e){var t;return t=e/1e8,t>=1&&Math.floor(t)==t?Math.floor(t)+"亿":(t=e/1e4,t>=1&&Math.floor(t)==t?Math.floor(t)+"万":(t=e/1e3,t>=1&&9>=t&&Math.floor(t)==t?Math.floor(t)+"千":App.Tool.convertAmountToWan(e)))},i.prototype.convertAmountToWan=function(e,t){if(void 0===t&&(t=1),void 0==e)return"0";var i,n,o,r,s=Math.pow(10,t);if(Math.abs(e)>=99999999){if(i=Math.floor(e/1e8),n=Math.floor(e/(1e8/s))-i*s,0==n||0>=t)return i+"亿";for(o=".",r=0;r<t-n.toString().length;r++)o+="0";return i+o+n+"亿"}if(Math.abs(e)>9999){if(i=Math.floor(e/1e4),n=Math.floor(e/(1e4/s))-i*s,0==n||0>=t)return i+"万";for(o=".",r=0;r<t-n.toString().length;r++)o+="0";return i+o+n+"万"}return e.toString()},i.prototype.addArrayItem=function(e,t){e&&e.indexOf(t)<0&&e.push(t)},i.prototype.deleteArrayItem=function(e,t){if(e){var i=e.indexOf(t);i>=0&&e.splice(i,1)}},i.prototype.clearArray=function(e){e&&e.splice(0,e.length)},i.prototype.megerResGroups=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i,n=[],o=0;o<e.length;o++)i=RES.getGroupByName(e[o]),i&&i.length>0&&(n=n.concat(i));return n},i.prototype.megerProtoFiles=function(){function e(e){for(var t=e.indexOf("//",0),i=e.indexOf("\n",t+1);t>=0&&i>t;){var n=e.slice(t,i);e=e.replace(n,""),t=e.indexOf("//",0),i=e.indexOf("\n",t+1)}return e}for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];for(var n,o,r,s="",a=0;a<t.length;a++){if(n=RES.getRes(t[a]),!n)throw Error("没有找到Proto文件："+t[a]);for(o=n.indexOf("\nenum",0),r=n.indexOf("}",o+6);o>=0&&r>o;)s+=e(n.slice(o,r+1))+"\n",o=n.indexOf("\nenum",r+2),r=n.indexOf("}",o+6);for(o=n.indexOf("\nmessage",0),r=n.indexOf("}",o+9);o>=0&&r>o;)s+=e(n.slice(o,r+1))+"\n",o=n.indexOf("\nmessage",r+2),r=n.indexOf("}",o+9)}return s},i.prototype.getUnixTime=function(){return Math.floor((new Date).getTime()/1e3)},i.prototype.getCurrentTime=function(){var e=new Date(1e3*App.Tool.getUnixTime()).toString();return e=e.substring(e.indexOf(":")-2),e=e.substring(0,e.lastIndexOf(":")+3)},i.prototype.convertResName=function(e){return e.replace(".","_")},i.prototype.initLabelPrompt=function(e,t){void 0===t&&(t=null),e&&(e.textColor=11184810,t&&(e.text=t))},i.prototype.doLabelPrompt=function(e,t,i,n){var o=this;void 0===i&&(i=null),void 0===n&&(n=0),this.delayApply(50,this,function(){if(e){var r,s=e.text;r=11184810==e.textColor?"":s,s=prompt(t,r),s&&s.length>0&&(n>0&&(s=s.substr(0,n)),e.textColor=0,i&&i.length>0?e.text=o.filterChars(s,i):e.text=s)}})},i.prototype.filterChars=function(e,t){for(var i,n="",o=0;o<e.length;o++)i=e.charAt(o),t.indexOf(i)>=0&&(n+=i);return n},i.prototype.getUrlParam=function(e,t){if(e&&t){var i=e.indexOf("?"+t+"=");if(-1==i&&(i=e.indexOf("&"+t+"=")),i>=0){i+=t.length+2;var n,o=e.indexOf("&",i);return n=0>o?e.substring(i):e.substring(i,o)}}return null},i.prototype.getHostAddress=function(e,t){var i=e.indexOf(t);return i>0?e.substring(0,i):e},i.prototype.getResPath=function(){var e,t=location.href;return e=t.indexOf("?"),e>0&&(t=t.substring(0,e)),e=t.indexOf("index."),e>0&&(t=t.substring(0,e)),"/"==t.substr(t.length-1,1)&&(t=t.substr(0,t.length-1)),t+="/resource/"},i.prototype.objectToStr=function(e){var t,i="[";for(var n in e)t=e[n],i+=t instanceof Object||t instanceof Array?this.objectToStr(t):n+"="+e[n]+" ";return i+="]"},i.prototype.trimStr=function(e,t,i){void 0===i&&(i=!1);var n=e;return n.length>t&&(n=n.substr(0,t),i&&(n+="...")),n},i}(e.BaseSingleton);e.ToolMod=t,__reflect(t.prototype,"Core.ToolMod")}(Core||(Core={}));var Core;!function(e){var t=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._dataList=[],e}return __extends(i,t),i.prototype.show=function(t,i){if(void 0===i&&(i=1),t&&t.length>0&&i>=1){this.getDataByGroup(t)&&this.hideGroup(t);var n=new AwaitHintData;n.group=t,n.hideNeedCount=i,n.loopView=new e.Views.LoopLoadingView,this._dataList.push(n),n.loopView.show()}},i.prototype.hideOne=function(e){var t=this.getDataByGroup(e);t&&(t.hideNeedCount--,t.hideNeedCount<=0&&this.hideGroup(e))},i.prototype.hideGroup=function(e){var t=this.getDataByGroup(e);t&&(t.loopView.hide(),t.destroy(),App.Tool.deleteArrayItem(this._dataList,t))},i.prototype.clearAll=function(){for(var e=0,t=this._dataList;e<t.length;e++){var i=t[e];i.loopView.hide(),i.destroy()}App.Tool.clearArray(this._dataList)},i.prototype.getDataByGroup=function(e){for(var t=0,i=this._dataList;t<i.length;t++){var n=i[t];if(n.group==e)return n}return null},i=__decorate([singleton],i)}(e.BaseSingleton);e.AwaitHintManager=t,__reflect(t.prototype,"Core.AwaitHintManager")}(Core||(Core={}));var AwaitHintData=function(){function e(){}return e.prototype.destroy=function(){this.group=null,this.hideNeedCount=0,this.loopView=null},e}();__reflect(AwaitHintData.prototype,"AwaitHintData"),!function(e,t,i,n,o,r,s,a,h){function u(e){var t,i=e.length,o=this,r=0,s=o.i=o.j=0,a=o.S=[];for(i||(e=[i++]);n>r;)a[r]=r++;for(r=0;n>r;r++)a[r]=a[s=m&s+e[r%i]+(t=a[r])],a[s]=t;(o.g=function(e){for(var t,i=0,r=o.i,s=o.j,a=o.S;e--;)t=a[r=m&r+1],i=i*n+a[m&(a[r]=a[s=m&s+t])+(a[s]=t)];return o.i=r,o.j=s,i})(n)}function p(e,t){var i,n=[],o=typeof e;if(t&&"object"==o)for(i in e)try{n.push(p(e[i],t-1))}catch(r){}return n.length?n:"string"==o?e:e+"\x00"}function c(e,t){for(var i,n=e+"",o=0;o<n.length;)t[m&o]=m&(i^=19*t[m&o])+n.charCodeAt(o++);return d(t)}function l(i){try{return _?d(_.randomBytes(n)):(e.crypto.getRandomValues(i=new Uint8Array(n)),d(i))}catch(o){return[+new Date,e,(i=e.navigator)&&i.plugins,e.screen,d(t)]}}function d(e){return String.fromCharCode.apply(0,e)}var _,f=i.pow(n,o),g=i.pow(2,r),y=2*g,m=n-1,v=i["seed"+h]=function(e,r,s){var a=[];r=1==r?{entropy:!0}:r||{};var _=c(p(r.entropy?[e,d(t)]:null==e?l():e,3),a),m=new u(a);return c(d(m.S),t),(r.pass||s||function(e,t,n){return n?(i[h]=e,t):e})(function(){for(var e=m.g(o),t=f,i=0;g>e;)e=(e+i)*n,t*=n,i=m.g(1);for(;e>=y;)e/=2,t/=2,i>>>=1;return(e+i)/t},_,"global"in r?r.global:this==i)};if(c(i[h](),t),s&&s.exports){s.exports=v;try{_=window.require("crypto")}catch(C){}}else a&&a.amd&&a(function(){return v})}(this,[],Math,256,6,52,"object"==typeof window.module&&window.module,"function"==typeof window.define&&window.define,"random");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function o(e){t.call(n,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(n,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var a=e.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(n,generateJSON.paths[e])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){t.call(n,generateJSON.paths[e])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Core;!function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.Pop=function(t){var i=new e.Views.PopView;i.show(t,App.LayerManager.tipLayer)},i.prototype.Alert=function(t,i,n,o){void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=!0);var r=new e.Views.AlertView(o);r.show(t,i,n,App.LayerManager.dialogLayer)},i.prototype.Confirm=function(t,i,n,o,r){void 0===o&&(o="取 消"),void 0===r&&(r="确 定");var s=new e.Views.ConfirmView;s.show(t,i,n,o,r,App.LayerManager.dialogLayer)},i.prototype.Prompt=function(t,i,n,o,r,s){void 0===o&&(o=null),void 0===r&&(r=null),void 0===s&&(s=!0);var a=new e.Views.PromptView;a.show(t,i,n,o,r,App.LayerManager.dialogLayer)},i}(e.BaseSingleton);e.DialogMod=t,__reflect(t.prototype,"Core.DialogMod")}(Core||(Core={}));var Core;!function(e){var t=function(){function t(t,i,n,o,r,s,a){this._euiComponentClass=t,this._resGroupName=i,this._isModal=n,this._hideScene=o,this._hideOtherView=r,this._freeRes=s,this._initData=a,e.EuiViewData.idSeed++,this._id=e.EuiViewData.idSeed}return t.prototype.destroy=function(){this._euiComponentClass=null,this._view=null,this._resGroupName="",this._initData=null},t.prototype.setView=function(e){this._view=e},Object.defineProperty(t.prototype,"euiComponentClass",{get:function(){return this._euiComponentClass},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resGroupName",{get:function(){return this._resGroupName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isModal",{get:function(){return this._isModal},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hideScene",{get:function(){return this._hideScene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hideOtherView",{get:function(){return this._hideOtherView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"freeRes",{get:function(){return this._freeRes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initData",{get:function(){return this._initData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ID",{get:function(){return this._id},enumerable:!0,configurable:!0}),t.idSeed=0,t}();e.EuiViewData=t,__reflect(t.prototype,"Core.EuiViewData")}(Core||(Core={}));var Views;!function(e){function t(e){var t=function(e){function t(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=e.apply(this,t)||this;return n.onDataChanges=[],n}return __extends(t,e),t.prototype.addListener=function(e,t){for(var i=0;i<this.onDataChanges.length;i++){var n=this.onDataChanges[i];if(n._delegateMethod==e&&n._theObj==t)return}var o=new Utility.Delegate(e,t);this.onDataChanges.push(o)},t.prototype.removeListener=function(e,t){for(var i=0;i<this.onDataChanges.length;i++){var n=this.onDataChanges[i];if(n._delegateMethod==e&&n._theObj==t){this.onDataChanges.splice(i,1);break}}},t.prototype.onDataChanged=function(){for(var e=0;e<this.onDataChanges.length;e++){var t=this.onDataChanges[e];t.run()}},t}(e);return t}var i=function(){function e(){this.itemIndex=-1,this.selected=!1}return Object.defineProperty(e.prototype,"data",{get:function(){return this._itemData},set:function(e){this._itemData&&this.unbindData(),void 0!==e&&(this._itemData=e,this.bindData())},enumerable:!0,configurable:!0}),e.prototype.unbindData=function(){},e}();e.ComponentRenderer=i,__reflect(i.prototype,"Views.ComponentRenderer");var n=function(e){function t(){var t=e.call(this)||this;return t.itemIndex=-1,t.selected=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAdded,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoved,t),t}return __extends(t,e),t.prototype.onAdded=function(){this.onAddToUI(),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this)},t.prototype.onRemoved=function(){this.onRemovedFromUI(),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoved,this)},Object.defineProperty(t.prototype,"data",{get:function(){return this._itemData},set:function(e){this._itemData&&this.unbindData(),this._itemData=e,this.bindData()},enumerable:!0,configurable:!0}),t.prototype.onAddToUI=function(){},t.prototype.unbindData=function(){},t}(eui.Component);e.ItemRendererBase=n,__reflect(n.prototype,"Views.ItemRendererBase",["eui.IItemRenderer","eui.UIComponent","egret.DisplayObject"]);var o=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.onDataChanges=[]}return e.prototype.addListener=function(e,t){for(var i=0;i<this.onDataChanges.length;i++){var n=this.onDataChanges[i];if(n._delegateMethod==e&&n._theObj==t)return}var o=new Utility.Delegate(e,t);this.onDataChanges.push(o)},e.prototype.removeListener=function(e,t){for(var i=0;i<this.onDataChanges.length;i++){var n=this.onDataChanges[i];if(n._delegateMethod==e&&n._theObj==t){this.onDataChanges.splice(i,1);break}}},e.prototype.onDataChanged=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=0;i<this.onDataChanges.length;i++){var n=this.onDataChanges[i];n.run.apply(n,e)}},e}();e.UpdatableScrollItem=o,__reflect(o.prototype,"Views.UpdatableScrollItem",["Views.IUpdatableScrollItem"]),e.UpdatableScrollItemMixin=t}(Views||(Views={}));var Core;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this.stage=e,this.container=new eui.UILayer,this.setTouch(this.container,!1,!0),this.sceneLayer=new egret.DisplayObjectContainer,this.setTouch(this.sceneLayer,!0,!0),this.textLineSliderLayer=new egret.DisplayObjectContainer,this.setTouch(this.textLineSliderLayer,!1,!0),this.animationLayer=new egret.DisplayObjectContainer,this.setTouch(this.animationLayer,!1,!1),this.uiLayer=new egret.DisplayObjectContainer,this.setTouch(this.uiLayer,!1,!0),this.tipLayer=new egret.DisplayObjectContainer,this.setTouch(this.tipLayer,!1,!1),this.dialogLayer=new egret.DisplayObjectContainer,this.setTouch(this.dialogLayer,!1,!0),this.debugLayer=new egret.DisplayObjectContainer,this.setTouch(this.debugLayer,!1,!0),this.stage.addChild(this.container),this.uiLayer.width=this.sceneLayer.width=this.container.width=this.stage.stageWidth,this.uiLayer.height=this.sceneLayer.height=this.container.height=this.stage.stageHeight,this.container.addChild(this.sceneLayer),this.container.addChild(this.uiLayer),this.container.addChild(this.tipLayer),this.container.addChild(this.dialogLayer)},e.prototype.setTouch=function(e,t,i){e.touchEnabled=t,e.touchChildren=i},e=__decorate([singleton],e)}();e.LayerManager=t,__reflect(t.prototype,"Core.LayerManager")}(Core||(Core={}));var Core;!function(e){var t=function(){function t(){i.self=this,this._clientSizeSyncList=[],this._autoLayoutMap=new e.AssociativeMap,this._childScaleRatio=1,this._autoScaleDisplayContainerMap=new e.AssociativeMap}return i=t,t.prototype.init=function(e){void 0===e&&(e=!1),this.onClientWindowResize(),window.addEventListener("resize",this.onClientWindowResize),e&&setInterval(this.updateScrollTop,1e3),this._stageW=App.LayerManager.stage.stageWidth,this._stageH=App.LayerManager.stage.stageHeight,this._isLandscape=this._stageW>this._stageH},t.prototype.register=function(e,t){void 0===t&&(t=null),this.registAutoLayout(e,t),this.registSyncToClientSize(e)},t.prototype.unRegister=function(e){this.unRegistSyncToClientSize(e),this.unRegistAutoLayout(e)},t.prototype.addLayoutItemToDc=function(t,i){if(t&&i&&i.parent==t){var n=this._autoLayoutMap.getValue(t);null==n&&(n=new e.AssociativeMap,this._autoLayoutMap.add(t,n)),n.add(i,[i.x,i.y])}},t.prototype.removeLayoutItemFromDc=function(e,t){if(e&&t){var i=this._autoLayoutMap.getValue(e);i&&(i.remove(t),0==i.keyList.length&&this._autoLayoutMap.remove(e))}},t.prototype.updateLayoutItemLoc=function(e,t,i,n){if(void 0===i&&(i=0/0),void 0===n&&(n=0/0),e&&t){var o=this._autoLayoutMap.getValue(e);if(o){var r=o.getValue(t);r&&2==r.length&&(0/0!=i?r[0]=i:r[0]=t.x,0/0!=n?r[1]=n:r[1]=t.y)}}},t.prototype.addAutoScaleDisplayContainer=function(e,t){void 0===t&&(t=1.5),this._autoScaleDisplayContainerMap.add(e,t)},t.prototype.removeAutoScaleDisplayContainer=function(e){this._autoScaleDisplayContainerMap.remove(e)},t.prototype.registSyncToClientSize=function(e){e&&this._clientSizeSyncList.indexOf(e)<0&&(this._clientSizeSyncList.push(e),this.syncToClientSize())},t.prototype.unRegistSyncToClientSize=function(e){if(e){var t=this._clientSizeSyncList.indexOf(e);t>=0&&this._clientSizeSyncList.splice(t,1)}},t.prototype.registAutoLayout=function(t,i){if(t){var n=this._autoLayoutMap.getValue(t);n&&this.unRegistAutoLayout(t),n=new e.AssociativeMap;var o,r;if(i)for(r=0;r<i.length;r++)o=i[r],o.parent==t&&n.add(o,[o.x,o.y]);else for(r=0;r<t.numChildren;r++)o=t.getChildAt(r),n.add(o,[o.x,o.y]);this._autoLayoutMap.add(t,n)}},t.prototype.unRegistAutoLayout=function(e){if(e){var t=this._autoLayoutMap.remove(e);t&&t.clear()}},t.prototype.onClientWindowResize=function(){i.self.update(),App.MessageCenter.dispatch(e.AppMessageType.CLIENT_RESIZE)},t.prototype.updateScrollTop=function(){var e=Math.round((document.body.clientHeight-window.innerHeight)/2);document.body.scrollTop!=e&&(document.body.scrollTop=e,this.update())},t.prototype.update=function(){i.self.getClientWindowSize(),i.self._clientSizeSyncList.length>0&&i.self.syncToClientSize(),i.self._autoScaleDisplayContainerMap.length>0&&i.self.autoScaleDisplayContainer()},t.prototype.getClientWindowSize=function(){if(this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,(null==this.windowWidth||null==this.windowHeight)&&(document.body&&(this.windowWidth=document.body.clientWidth,this.windowHeight=document.body.clientHeight),(null==this.windowWidth||null==this.windowHeight)&&document.documentElement&&(this.windowWidth=document.documentElement.clientWidth,this.windowHeight=document.documentElement.clientHeight)),this.windowHeight>this.windowWidth){var e=this.windowWidth;this.windowWidth=this.windowHeight,this.windowHeight=e}this.scaleX=this.windowWidth/this._stageW,this.scaleY=this.windowHeight/this._stageH,this.displayScale=Math.max(this.scaleX,this.scaleY),this.scaleX=this.scaleX/this.displayScale,this.scaleY=this.scaleY/this.displayScale,this.clientWidth=Math.round(this.windowWidth/this.displayScale),this.clientHeight=Math.round(this.windowHeight/this.displayScale),this.clientLeft=Math.round((this._stageW-this.windowWidth/this.displayScale)/2),this.clientTop=Math.round((this._stageH-this.windowHeight/this.displayScale)/2);var t=this.windowWidth/this.windowHeight;t<i.aspectRatioLimitLow?this._childScaleRatio=t/i.aspectRatioLimitLow:t>i.aspectRatioLimitHigh?this._childScaleRatio=i.aspectRatioLimitHigh/t:this._childScaleRatio=1},t.prototype.syncToClientSize=function(){for(var e,t=0;t<this._clientSizeSyncList.length;t++)e=this._clientSizeSyncList[t],e.width=this.clientWidth,e.height=this.clientHeight,e.x=this.clientLeft,e.y=this.clientTop,this._autoLayoutMap.has(e)&&this.autoLayoutChildren(e)},t.prototype.autoLayoutChildren=function(e){var t=this._autoLayoutMap.getValue(e);if(t)for(var i,n,o=this._isLandscape?this.scaleY:this.scaleX,r=0;r<t.keyList.length;r++)i=t.keyList[r],n=t.getValue(i),i.x=n[0]*this.scaleX,i.y=n[1]*this.scaleY,i.scaleX=i.scaleY=o},t.prototype.autoScaleDisplayContainer=function(){for(var e,t,i=App.LayoutSyncManager.windowWidth/App.LayoutSyncManager.windowHeight,n=0;n<this._autoScaleDisplayContainerMap.length;n++)e=this._autoScaleDisplayContainerMap.keyList[n],t=this._autoScaleDisplayContainerMap.valueList[n],t>i?e.scaleX=e.scaleY=i/t:e.scaleX=e.scaleY=1},Object.defineProperty(t.prototype,"stageCenterX",{get:function(){return this._stageW/2-this.clientLeft},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageCenterY",{get:function(){return this._stageH/2-this.clientTop},enumerable:!0,configurable:!0}),t.aspectRatioLimitLow=1.5,t.aspectRatioLimitHigh=2,t=i=__decorate([singleton],t);var i}();e.LayoutSyncManager=t,__reflect(t.prototype,"Core.LayoutSyncManager")}(Core||(Core={}));var Core;!function(e){var t=function(){function t(){}return t.prototype.init=function(e){this._layer=e},t.prototype["switch"]=function(e,t,i,n,o){void 0===t&&(t=null),void 0===i&&(i=!0),void 0===n&&(n=!1),void 0===o&&(o=!1),this._curEuiComponentClass=e,this._resGroupName=t,this._autoSyncToClient=i,this._freeRes=n,""==t&&(t=null),null==t||RES.isGroupLoaded(t)?this.doSwitch():(RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),0==o&&(this._loading=Loading.Instance.showLoading(t)),RES.loadGroup(t))},t.prototype.release=function(){this._curSceneView&&(this._curSceneView.freeRes&&this._curSceneView.skinResName&&RES.destroyRes(this._curSceneView.skinResName),this._curSceneView.destroy(),delete this._curSceneView.autoSyncToClient,delete this._curSceneView.freeRes,App.Display.removeFromParent(this._curSceneView),App.MessageCenter.dispatch(e.AppMessageType.CLOSE_EUI_VIEW,this._curSceneView),this._curSceneView=null)},t.prototype.lockCurrentScene=function(){this._curSceneView&&(this._curSceneView.touchEnabled=this._curSceneView.touchChildren=!1)},t.prototype.unLockCurrentScene=function(){this._curSceneView&&(this._curSceneView.touchEnabled=this._curSceneView.touchChildren=!0)},t.prototype.onResourceLoadComplete=function(e){this._curEuiComponentClass&&this._resGroupName==e.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),this._loading&&this._loading.close(),this.doSwitch(),this._curEuiComponentClass=null,this._resGroupName=null)},t.prototype.onResourceLoadError=function(e){this._curEuiComponentClass&&this._resGroupName==e.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),this._loading&&this._loading.close(),this._curEuiComponentClass=null,this._resGroupName=null)},t.prototype.doSwitch=function(){var t=this._curSceneView;this._curSceneView=new this._curEuiComponentClass,this._curSceneView.autoSyncToClient=this._autoSyncToClient,this._curSceneView.freeRes=this._freeRes,t&&(t.freeRes&&t.skinResName&&RES.destroyRes(t.skinResName),t.destroy(),delete t.autoSyncToClient,delete t.freeRes,App.Display.removeFromParent(t),App.MessageCenter.dispatch(e.AppMessageType.CLOSE_EUI_VIEW,t)),this._layer.addChild(this._curSceneView),this._curSceneView.autoSyncToClient},Object.defineProperty(t.prototype,"curSceneView",{get:function(){return this._curSceneView},enumerable:!0,configurable:!0}),t=__decorate([singleton],t)}();e.SceneViewManager=t,__reflect(t.prototype,"Core.SceneViewManager")}(Core||(Core={}));var Core;!function(e){var t=function(){function t(){this._viewDataMap=new e.AssociativeMap,this._autoHideViewMap=new e.AssociativeMap,this._windowList=[],this._showZOrders=new Utility.HandyArray(10,!0)}return t.prototype.init=function(e,t){this._uiLayer=e,this._sceneLayer=t},Object.defineProperty(t.prototype,"isIphonXLike",{get:function(){var e=this._uiLayer.width/this._uiLayer.height;return.5>e},enumerable:!0,configurable:!0}),t.prototype.fixedUI=function(e){var t=(e.height,e.width),i=this._uiLayer.width/t;e.height=this._uiLayer.height*i,e.y=ViewPort.uiOffsetTop,e.height-=ViewPort.uiOffsetBottom+ViewPort.uiOffsetTop},t.prototype.bringInToView=function(e){if(!e.isNoInWinZ){if(this._showZOrders.length>0){var t=this._showZOrders.get_at(this._showZOrders.length-1);t&&t!=e&&t.onDropFromTop(e)}for(var i=0,n=this._showZOrders.length;n>i;i++){var o=this._showZOrders.get_at(i);if(o==e){this._showZOrders.dequeueAt(i);
break}o.onWinOpened(e)}this._showZOrders.push(e),e.onBringToTop()}this._uiLayer.addChild(e),this.fixedUI(e)},t.prototype.removeFromView=function(e){if(!e.isNoInWinZ&&this._showZOrders.length>0){var t=this._showZOrders.get_at(this._showZOrders.length-1);if(t==e)e.onDropFromTop(),this._showZOrders.pop(),this._showZOrders.length>0&&(t=this._showZOrders.get_at(this._showZOrders.length-1),t.onBringToTop(e));else for(var i=0,n=this._showZOrders.length;n>i;i++){var o=this._showZOrders.get_at(i);if(o==e){this._showZOrders.dequeueAt(i);break}}}App.Tool.deleteArrayItem(this._windowList,e),App.Display.removeFromParent(e),e.destroy()},t.prototype.showWin=function(e,t){t=t||{resGroupName:null,initData:null,isModal:!1,hideScene:!1,hideOtherView:!1,freeRes:!1,hideLoadProgress:!1},this.show(e,t.resGroupName,t.initData,t.isModal,t.hideScene,t.hideOtherView,t.freeRes,t.hideLoadProgress)},t.prototype.show=function(t,i,n,o,r,s,a,h){void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=!0),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),void 0===h&&(h=!1);var u=this.getData(t);if(u){var p=u.view;this.bringInToView(p)}else""==i&&(i=null),u=new e.EuiViewData(t,i,o,r,s,a,n),null==i||RES.isGroupLoaded(i)?this.createView(u):(this._curData=u,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),0==h&&(this._loading=Loading.Instance.showLoading("加载资源...")),RES.loadGroup(i),Log.trace("WindowViewManager开始加载资源包 "+i))},t.prototype.showAsync=function(t,i,n,o,r,s,a,h){var u=this;void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=!0),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),void 0===h&&(h=!1);var p=this.getData(t);if(p){var c=p.view;this._uiLayer.addChild(c)}else{if(""==i&&(i=null),p=new e.EuiViewData(t,i,o,r,s,a,n),null!=i&&!RES.isGroupLoaded(i))return new Promise(function(e,t){p.asyncCtx=e,u._curData=p,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,u.onResourceLoadComplete,u),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,u.onResourceLoadError,u),0==h&&App.LoopLoading.show(i),RES.loadGroup(i),Log.trace("WindowViewManager 开始加载资源包 (async)["+i+"]")});this.createView(p)}return new Promise(function(e,t){e(p.view)})},t.prototype.onResourceLoadComplete=function(e){if(this._curData&&this._curData.resGroupName==e.groupName){Log.trace("WindowViewManager加载资源包完成 "+e.groupName),App.LoopLoading.hide(),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),this._loading&&this._loading.close(),this.createView(this._curData);var t=this._curData.asyncCtx;t&&t(this._curData.view),this._curData=null}},t.prototype.onResourceLoadError=function(e){this._curData&&this._curData.resGroupName==e.groupName&&(App.LoopLoading.hide(),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),this._loading&&this._loading.close(),this._curData=null)},t.prototype.createView=function(t){var i=t.euiComponentClass;this._viewDataMap.add(i,t);var n=new i(t.isModal);t.setView(n),t.hideScene&&this._sceneLayer.visible&&(this._sceneLayer.visible=!1),this.bringInToView(n),n.init&&n.init(t.initData),t.hideOtherView&&this.addToAutoHideViews(t),App.MessageCenter.dispatch(e.AppMessageType.EUI_VIEW_ADDED,t.view),this._windowList.push(n)},t.prototype.close=function(t){var i=this.getData(t);i&&(this.removeFromView(i.view),App.MessageCenter.dispatch(e.AppMessageType.EUI_VIEW_REMOVED,i.view),this._viewDataMap.remove(i.euiComponentClass),i.hideScene&&0==this._sceneLayer.visible&&(this._sceneLayer.visible=!0),i.freeRes&&i.resGroupName&&RES.destroyRes(i.resGroupName),i.hideOtherView&&this.removeFromAutoHideViews(i),i.destroy())},t.prototype.closeAll=function(e){Log.trace(">>>>>>>>>>>>> close all windows but one <<<<<<<<<<<<<<<< ");for(var t=this._viewDataMap.keyList,i=null,n=null;t.length>0;){var o=t[0];e&&e==o?(i=o,n=this._viewDataMap.getValue(o),this._viewDataMap.remove(o)):this.close(o)}i&&this._viewDataMap.add(i,n)},t.prototype.hide=function(e){var t=this.getData(e);t&&App.Display.removeFromParent(t.view)},t.prototype.addToAutoHideViews=function(e){for(var t,i=[],n=0;n<this._viewDataMap.valueList.length;n++)t=this._viewDataMap.valueList[n],t.view&&t.view.visible&&t.euiComponentClass!=e.euiComponentClass&&(i.push(t),t.view.visible=!1);i.length>0&&this._autoHideViewMap.add(e,i)},t.prototype.removeFromAutoHideViews=function(e){var t=this._autoHideViewMap.remove(e);if(t){for(var i,n=0;n<t.length;n++)i=t[n],i&&i.view&&(i.view.visible=!0);t.splice(0,t.length)}},t.prototype.getData=function(e){var t=this._viewDataMap.getValue(e);if(t)return t;for(var i=0;i<this._viewDataMap.valueList.length;i++)if(t=this._viewDataMap.valueList[i],t.view==e)return t;return null},t.prototype.showGameFlash=function(e){this._flashLayer||(this._flashLayer=new egret.DisplayObjectContainer,App.LayerManager.dialogLayer.addChild(this._flashLayer)),this._flashLayer.parent||App.LayerManager.dialogLayer.addChild(this._flashLayer);var t=new e(!0);this._flashLayer.addChild(t)},t.prototype.closeGameFlash=function(){this._flashLayer&&this._flashLayer.parent&&this._flashLayer.parent.removeChild(this._flashLayer)},t=__decorate([singleton],t)}();e.WindowViewManager=t,__reflect(t.prototype,"Core.WindowViewManager")}(Core||(Core={}));var ViewPort=function(){function e(){}return e._getViewPortDimensions=function(){if(egret.MainContext){if(this._isCalled=!0,this._width=0,this._height=0,this._stageWidth=egret.MainContext.instance.stage.stageWidth,this._stageHeight=egret.MainContext.instance.stage.stageHeight,window&&window.innerWidth)return this._width=window.innerWidth,void(this._height=window.innerHeight);if("undefined"!=typeof document){if(document.body)return this._width=document.body.clientWidth,void(this._height=document.body.clientHeight);if(document.documentElement)return this._width=document.documentElement.clientWidth,void(this._height=document.documentElement.clientHeight)}Log.trace("ViewPort: can not fetch size")}},e.setUIDimension=function(t,i){this._uiWidth=t,this._uiHeight=i,egret.MainContext&&egret.MainContext.instance&&egret.MainContext.instance.stage&&egret.MainContext.instance.stage.setContentSize(t,i);egret.MainContext.instance.stage.stageWidth/egret.MainContext.instance.stage.stageHeight;this.stageBondBox.x=0,this.stageBondBox.y=e.uiOffsetTop,this.stageBondBox.width=egret.MainContext.instance.stage.stageWidth,this.stageBondBox.height=egret.MainContext.instance.stage.stageHeight-e.uiOffsetTop-e.uiOffsetBottom},Object.defineProperty(e,"width",{get:function(){return this._isCalled||this._getViewPortDimensions(),this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e,"height",{get:function(){return this._isCalled||this._getViewPortDimensions(),this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e,"stageWidth",{get:function(){return this._isCalled||this._getViewPortDimensions(),this._stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e,"stageHeight",{get:function(){return this._isCalled||this._getViewPortDimensions(),this._stageHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e,"uiWidth",{get:function(){return this._uiWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e,"uiHeight",{get:function(){return this._uiHeight},enumerable:!0,configurable:!0}),e._isCalled=!1,e._width=0,e._height=0,e._stageWidth=0,e._stageHeight=0,e._uiWidth=0,e._uiHeight=0,e.uiOffsetTop=0,e.uiOffsetBottom=0,e.stageBondBox={x:0,y:0,width:800,height:1423},e}();__reflect(ViewPort.prototype,"ViewPort");var Core;!function(e){var t;!function(e){var t=function(){function e(e,t){this._content=new egret.DisplayObjectContainer,this._width=e,this._height=t,this._content.touchEnabled=!1,this._content.touchChildren=!1}return e.prototype.destroy=function(){this.removeResLoadEvents(),this.clear(),this._content=null},e.prototype.loadFromResGroup=function(t,i,n){void 0===n&&(n=e.NONE),this._resGroupName=t,this._textureName=i,this._displayType=n,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResLoadError,this),RES.loadGroup(t)},e.prototype.loadFromTexture=function(t,i){void 0===i&&(i=e.NONE),this._textureName=t,this._displayType=i,this.loadTexture()},e.prototype.loadTexture=function(){this.clear();var t;this._displayType==e.STRETCH?(t=new egret.Bitmap(RES.getRes(this._textureName)),t.width=App.LayerManager.stage.stageWidth,t.height=App.LayerManager.stage.stageHeight,t.fillMode=egret.BitmapFillMode.SCALE,this._content.addChild(t)):this._displayType==e.TILED?(t=new egret.Bitmap(RES.getRes(this._textureName)),t.width=App.LayerManager.stage.stageWidth,t.height=App.LayerManager.stage.stageHeight,t.fillMode=egret.BitmapFillMode.REPEAT,this._content.addChild(t),this._content.cacheAsBitmap=!0):(t=new egret.Bitmap(RES.getRes(this._textureName)),this._content.addChild(t))},e.prototype.onResLoadComplete=function(e){e.groupName==this._resGroupName&&(this.removeResLoadEvents(),this.loadTexture())},e.prototype.onResLoadError=function(e){e.groupName==this._resGroupName&&this.removeResLoadEvents()},e.prototype.removeResLoadEvents=function(){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResLoadError,this)},e.prototype.clear=function(){this._content.cacheAsBitmap=!1;for(var e,t=this._content.numChildren-1;t>=0;t--)e=this._content.removeChildAt(t),e&&(e.texture=null)},Object.defineProperty(e.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.NONE="none",e.TILED="tiled",e.STRETCH="stretch",e}();e.Background=t,__reflect(t.prototype,"Core.Views.Background")}(t=e.Views||(e.Views={}))}(Core||(Core={}));var Core;!function(e){var t;!function(t){var i=function(e){function t(){var t=e.call(this,"BaseLoadingSkin.exml",!0)||this;return t._layer=App.LayerManager.tipLayer,t.imgProgressBar.scrollRect=new egret.Rectangle(0,0,t.imgProgressBar.width,t.imgProgressBar.height),t}return __extends(t,e),t.prototype.destroy=function(){this._active&&(this.hide(),this.imgProgressBar.scrollRect=null,this._layer=null,this._groupName=null,e.prototype.destroy.call(this))},t.prototype.show=function(e){this.setProgress(0),this._layer.addChild(this),this.showBgMask(),e&&e.length>0&&(this._groupName=e,RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this))},t.prototype.hide=function(){RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),App.Display.removeFromParent(this),this.hideBgMask(),this._groupName=null},t.prototype.setProgress=function(e){0>e&&(e=0),e>100&&(e=100);var t=this.imgProgressBar.scrollRect;t.x=this.imgProgressBar.width*(100-e)/100,this.imgProgressBar.scrollRect=t},t.prototype.onResourceProgress=function(e){if(this._groupName==e.groupName){var t=Math.floor(100*e.itemsLoaded/e.itemsTotal);this.setProgress(t)}},t}(e.BaseEuiWindow);t.BaseLoadingView=i,__reflect(i.prototype,"Core.Views.BaseLoadingView",["Core.IBaseLoading"])}(t=e.Views||(e.Views={}))}(Core||(Core={}));var Core;!function(e){var t;!function(e){var t=function(){function e(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=.5),this._dc=e,this._alpha=i,this._bgMaskShape=new egret.Shape,this._bgMaskShape.touchEnabled=t,this._showing=!1}return e.prototype.destroy=function(){this._bgMaskShape&&(this.hide(),this._bgMaskShape=null),this._dc=null,this._showing=!1},e.prototype.show=function(e){void 0===e&&(e=-1),this._showing=!0,this.drawGraphics(e)},e.prototype.drawGraphics=function(e){this._showing&&this._bgMaskShape&&(this._bgMaskShape.graphics.clear(),this._bgMaskShape.graphics.beginFill(0,this._alpha),this._bgMaskShape.graphics.drawRect(-this._dc.x,-this._dc.y,App.LayerManager.stage.stageWidth,App.LayerManager.stage.stageHeight),this._bgMaskShape.graphics.endFill(),e>=0?this._dc.addChildAt(this._bgMaskShape,e):this._dc.addChild(this._bgMaskShape))},e.prototype.hide=function(){this._showing=!1,this._bgMaskShape.graphics.clear(),App.Display.removeFromParent(this._bgMaskShape)},Object.defineProperty(e.prototype,"showing",{get:function(){return this._showing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._bgMaskShape.visible},set:function(e){this._bgMaskShape.visible=e},enumerable:!0,configurable:!0}),e}();e.BgMask=t,__reflect(t.prototype,"Core.Views.BgMask")}(t=e.Views||(e.Views={}))}(Core||(Core={}));var Core;!function(e){var t;!function(e){var t=function(e){function t(t,i){var n=e.call(this)||this;return n._width=t,n._height=i,n._drawDotList=[],n._drawDotList.push([n._width,0]),n._drawDotList.push([n._width,n._height]),n._drawDotList.push([0,n._height]),n._drawDotList.push([0,0]),n._drawDotList.push([n._width/2,0]),n._shape=new egret.Shape,n.addChild(n._shape),n.setStyle(),n}return __extends(t,e),t.prototype.destroy=function(){this.removeChild(this._shape),this._shape.graphics.clear(),this._shape=null,this._drawDotList=null,this._callBackData&&(this._callBackData.destroy(),this._callBackData=null)},t.prototype.setStyle=function(e,t,i,n,o){void 0===e&&(e=65280),void 0===t&&(t=.8),void 0===i&&(i=2),void 0===n&&(n=0),void 0===o&&(o=.5),this._lineColor=e,this._lineAlpha=t,this._lineThickness=i,this._fillColor=n,this._fillAlpha=o},t.prototype.start=function(e,t,n,o,r,s){void 0===e&&(e=2e3),void 0===t&&(t=0),void 0===n&&(n=100),void 0===o&&(o=null),void 0===r&&(r=null),void 0===s&&(s=null),this._curPercent=t,this._toPercent=n,o&&(this._callBackData=new i,this._callBackData.fun=o,this._callBackData.thisObj=r,this._callBackData.argList=s),this._speed=33*(n-t)/e,this.updatePercent(t),App.GlobalRepeatTigger.addTime(33,this.update,this)},t.prototype.end=function(e){void 0===e&&(e=!1),App.GlobalRepeatTigger.removeTime(this.update,this),this._callBackData&&e?this._callBackData.fun.apply(this._callBackData.thisObj,this._callBackData.argList):this._callBackData&&(this._callBackData.destroy(),this._callBackData=null)},t.prototype.update=function(){this._curPercent+=this._speed,this._speed>0&&this._curPercent>=this._toPercent||this._speed<0&&this._curPercent<=this._toPercent?(this.updatePercent(this._toPercent),this.end(!0)):this.updatePercent(this._curPercent)},t.prototype.updatePercent=function(e){e>100&&(e=100),0>e&&(e=0),this._shape.graphics.clear(),this._shape.graphics.beginFill(this._fillColor,this._fillAlpha),this._shape.graphics.moveTo(this._width/2,this._height/2);var t;12.5>e?(this._shape.graphics.lineTo(this._width/2*(1+e/12.5),0),t=0):37.5>e?(this._shape.graphics.lineTo(this._width,this._height*(e-12.5)/25),t=1):62.5>e?(this._shape.graphics.lineTo(this._width*(1-(e-37.5)/25),this._height),t=2):87.5>e?(this._shape.graphics.lineTo(0,this._height*(1-(e-62.5)/25)),t=3):(this._shape.graphics.lineTo(this._width*((e-87.5)/25),0),t=4);for(var i=t;i<this._drawDotList.length;i++)this._shape.graphics.lineStyle(this._lineThickness,this._lineColor,this._lineAlpha),this._shape.graphics.lineTo(this._drawDotList[i][0],this._drawDotList[i][1]);this._shape.graphics.lineStyle(0,0,0),this._shape.graphics.lineTo(this._width/2,this._height/2),this._shape.graphics.endFill()},t}(egret.DisplayObjectContainer);e.CdMask=t,__reflect(t.prototype,"Core.Views.CdMask");var i=function(){function e(){}return e.prototype.destroy=function(){this.fun=null,this.thisObj=null,this.argList=null},e}();__reflect(i.prototype,"CallBackData")}(t=e.Views||(e.Views={}))}(Core||(Core={}));var Core;!function(e){var t;!function(t){var i=function(){function t(){this._layer=App.LayerManager.tipLayer,this._bmpLoading=new egret.Bitmap,this._bmpLoading.texture=RES.getRes("dt_base_loading_png"),this._bmpLoading.anchorOffsetX=Math.ceil(this._bmpLoading.texture.textureWidth/2),this._bmpLoading.anchorOffsetY=Math.ceil(this._bmpLoading.texture.textureHeight/2),this._bmpLoading.x=App.LayerManager.stage.stageWidth/2,this._bmpLoading.y=App.LayerManager.stage.stageHeight/2,this._bgMask=new e.Views.BgMask(this._layer,!1),this._showTimes=0}return t.prototype.destroy=function(){this.hide(),this._bmpLoading.texture=null,this._bmpLoading=null,this._bgMask.destroy(),this._bgMask=null,this._layer=null},t.prototype.show=function(){0==this._showTimes&&(this._curAngle=this._bmpLoading.rotation,this._bgMask.show(),this._layer.addChild(this._bmpLoading),App.GlobalRepeatTigger.addTime(100,this.updateFrame,this)),this._showTimes++},t.prototype.hide=function(){this._showTimes--,this._showTimes<0&&(this._showTimes=0),0==this._showTimes&&(App.GlobalRepeatTigger.removeTime(this.updateFrame,this),App.Display.removeFromParent(this._bmpLoading),this._bgMask.hide())},t.prototype.setProgress=function(e){},t.prototype.updateFrame=function(){this._curAngle+=45,this._curAngle>=360&&(this._curAngle-=360),this._bmpLoading.rotation=this._curAngle},t}();t.LoopLoadingView=i,__reflect(i.prototype,"Core.Views.LoopLoadingView",["Core.IBaseLoading"])}(t=e.Views||(e.Views={}))}(Core||(Core={}));var App=function(){function e(){}return e.getConfig=function(e){return RES.getRes(e)},Object.defineProperty(e,"Http",{get:function(){return Core.HttpMod.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MessageCenter",{get:function(){return Core.MessageCenter.Instance},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CallbackMappingCenter",{get:function(){return Core.CallbackMappingCenter.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"GlobalRepeatTigger",{get:function(){return Core.GlobalRepeatTigger.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Display",{get:function(){return Core.DisplayUtilMod.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Dialog",{get:function(){return Core.DialogMod.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AwaitHint",{get:function(){return Core.AwaitHintManager.Instance},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LayerManager",{get:function(){return Core.LayerManager.Instance},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LayoutSyncManager",{get:function(){return Core.LayoutSyncManager.Instance},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SceneViewManager",{get:function(){return Core.SceneViewManager.Instance},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WindowViewManager",{get:function(){return Core.WindowViewManager.Instance},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SoundManager",{get:function(){return Core.SoundManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PreLoadManager",{get:function(){return Core.PreLoadManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Compatible",{get:function(){return Core.CompatibleMod.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Device",{get:function(){return Core.DeviceMod.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Keyboard",{get:function(){return Core.KeyboardMod.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Tool",{get:function(){return Core.ToolMod.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LoopLoading",{get:function(){return e._loopLoading},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FullLoading",{get:function(){return e._fullLoading},enumerable:!0,configurable:!0}),Object.defineProperty(e,"iFramePage",{get:function(){return Core.iframePage.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LocalStorageData",{get:function(){return Core.LocalStorageData.getInstance()},enumerable:!0,configurable:!0}),e.init=function(){e.SetupMessageProxy(),e.SceneViewManager.init(e.LayerManager.sceneLayer),e.WindowViewManager.init(e.LayerManager.uiLayer,e.LayerManager.sceneLayer),this._fullLoading||(this._fullLoading=new DefLoading),this._loopLoading||(this._loopLoading=new DefLoading)},e.SetupLoading=function(t,i){t&&(e._fullLoading&&e._fullLoading.destroy(),e._fullLoading=t),i&&(e._loopLoading&&e._loopLoading.destroy(),e._loopLoading=i)},e.SetupMessageProxy=function(){e.MessageCenter.addListener(Core.AppMessageType.CLOSE_EUI_VIEW,function(t){e.WindowViewManager.close(t)},this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,function(e){Log.trace("资源包加载完成 "+e.groupName)},this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,function(e){Log.trace("！资源包加载失败 "+e.groupName)},this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,function(e){Log.trace("！加载资源失败："+e.resItem.url)},this)},e}();__reflect(App.prototype,"App");var DefLoading=function(){function e(){}return e.prototype.show=function(){},e.prototype.hide=function(){},e.prototype.setProgress=function(e){},e.prototype.destroy=function(){},e}();__reflect(DefLoading.prototype,"DefLoading",["Core.IBaseLoading"]);var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?n(o):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Core;!function(e){var t;!function(t){var i=function(t){function i(i){void 0===i&&(i=!1);var n=t.call(this)||this;return n.skinName=e.AppConst.SKIN_PATH+"assets/AlertSkin.exml",n.btnOK.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onBtnOKTap,n),i?n.btnClose.visible=!1:n.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onBtnCloseTap,n),n}return __extends(i,t),i.prototype.destroy=function(){this.btnOK.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnOKTap,this),this.btnClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnCloseTap,this),this._bgMask&&(this._bgMask.destroy(),this._bgMask=null),this.skinName=null,this.txt1.text="",this._callBackFunc=null,this._thisObj=null},i.prototype.show=function(t,i,n,o,r){void 0===r&&(r=!0),null==t&&(t=""),this.txt1.text=t,this._callBackFunc=i,this._thisObj=n,o.addChild(this),r&&App.Display.moveToStageCenter(this),this._bgMask=new e.Views.BgMask(this,!0),this._bgMask.show(0),this.alpha=0,egret.Tween.get(this).to({alpha:1},200)},i.prototype.hide=function(){var e=this;egret.Tween.get(this).to({alpha:0},300).call(function(){App.Display.removeFromParent(e),e.destroy()},this)},i.prototype.onBtnOKTap=function(e){this._callBackFunc&&this._callBackFunc.apply(this._thisObj,[!0]),this.hide()},i.prototype.onBtnCloseTap=function(e){this._callBackFunc&&this._callBackFunc.apply(this._thisObj,[!1]),this.hide()},i}(eui.Component);t.AlertView=i,__reflect(i.prototype,"Core.Views.AlertView")}(t=e.Views||(e.Views={}))}(Core||(Core={}));var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Core;!function(e){var t;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.skinName=e.AppConst.SKIN_PATH+"assets/PopSkin.exml",i}return __extends(i,t),i.prototype.destroy=function(){this.txt1.text=""},i.prototype.show=function(e,t,n){void 0===n&&(n=!0),null==e&&(e=""),this.txt1.text=e;var o=Math.floor(e.length/30);o>0&&(this.height+=32*o),t.addChild(this),n&&App.Display.moveToStageCenter(this),this.alpha=0,egret.Tween.get(this).to({alpha:1},200),i.viewList.push(this),this.arrangeViews(),egret.setTimeout(function(){App.Display.removeFromParent(this),this.destroy(),App.Tool.deleteArrayItem(i.viewList,this)},this,2600)},i.prototype.hide=function(){var e=this;egret.Tween.get(this).to({alpha:0},500).call(function(){App.Display.removeFromParent(e),e.destroy(),App.Tool.deleteArrayItem(i.viewList,e)},this)},i.prototype.arrangeViews=function(){if(i.viewList.length>0){this.y-=i.viewList.length*(this.skin.height+5);for(var e=i.viewList[0].skin.height,t=6,n=(App.LayerManager.stage.stageHeight-((e+t)*i.viewList.length-t))/2,o=0;o<i.viewList.length;o++)i.viewList[o].y=n,n+=e+t}},i.viewList=[],i}(eui.Component);t.PopView=i,__reflect(i.prototype,"Core.Views.PopView")}(t=e.Views||(e.Views={}))}(Core||(Core={}));var Core;!function(e){var t;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.skinName=e.AppConst.SKIN_PATH+"assets/PromptSkin.exml",i.input1.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onInputTap,i),i.btnOK.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onBtnOKTap,i),i}return __extends(i,t),i.prototype.destroy=function(){this.input1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onInputTap,this),this.btnOK.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnOKTap,this),this._bgMask&&(this._bgMask.destroy(),this._bgMask=null),this.skinName=null,this.txt1.text="",this.input1.prompt="",this.input1.text="",this._callBackFunc=null,this._thisObj=null},i.prototype.show=function(t,i,n,o,r,s,a){void 0===a&&(a=!0),null==t&&(t=""),null==i&&(i=""),this.txt1.text=t,n&&n.length>0?this.input1.text=n:this.input1.prompt=i,this._callBackFunc=o,this._thisObj=r,s.addChild(this),a&&App.Display.moveToStageCenter(this),this._bgMask=new e.Views.BgMask(this,!0),this._bgMask.show(0),this.alpha=0,egret.Tween.get(this).to({alpha:1},200)},i.prototype.hide=function(){var e=this;egret.Tween.get(this).to({alpha:0},300).call(function(){App.Display.removeFromParent(e),e.destroy()},this)},i.prototype.onInputTap=function(e){this.input1.textDisplay.size=30,this.input1.textDisplay.height=30,this.input1.textDisplay.setFocus();var t=ViewPort.width,i=ViewPort.height;document&&document.body&&(document.body.style.width=t+"px",document.body.style.height=i+"px")},i.prototype.onBtnOKTap=function(e){this._callBackFunc&&this._callBackFunc.apply(this._thisObj,[this.input1.text]),this.hide()},i}(eui.Component);t.PromptView=i,__reflect(i.prototype,"Core.Views.PromptView")}(t=e.Views||(e.Views={}))}(Core||(Core={}));var Core;!function(e){var t=function(){function t(){}return t.init=function(){var e,i;for(t.alog[0]=1,e=1;256>e;e++)i=t.alog[e-1]<<1^t.alog[e-1],0!=(256&i)&&(i^=t.ROOT),t.alog[e]=i;for(e=1;255>e;e++)t.log[t.alog[e]]=e},t.getRounds=function(e){switch(e){case 16:return 10;case 24:return 12;default:return 14}},t.mul=function(e,i){return 0!=e&&0!=i?t.alog[(t.log[255&e]+t.log[255&i])%255]:0},t.encrypt=function(e){var i,n,o,r,s,a=new Uint8Array(t.BLOCK_SIZE),h=new Uint8Array(t.BLOCK_SIZE);if(null==e)throw Error("[AES] Empty plaintext");if(e.length!=t.BLOCK_SIZE)throw Error("[AES] Incorrect plaintext length");for(i=t.Ke[0],n=0;n<t.BLOCK_SIZE;n++)a[n]=e[n]^i[n];for(var u=1;u<t.numRounds;u++){for(i=t.Ke[u],n=0;n<t.BLOCK_SIZE;n++)h[n]=t.S[255&a[n]];for(n=0;n<t.BLOCK_SIZE;n++)r=n%t.COL_SIZE,o=(n+t.row_shift[r]*t.COL_SIZE)%t.BLOCK_SIZE,a[n]=h[o];for(s=0;s<t.NUM_COLS;s++)n=s*t.COL_SIZE,h[n]=t.mul(2,a[n])^t.mul(3,a[n+1])^a[n+2]^a[n+3],h[n+1]=a[n]^t.mul(2,a[n+1])^t.mul(3,a[n+2])^a[n+3],h[n+2]=a[n]^a[n+1]^t.mul(2,a[n+2])^t.mul(3,a[n+3]),h[n+3]=t.mul(3,a[n])^a[n+1]^a[n+2]^t.mul(2,a[n+3]);for(n=0;n<t.BLOCK_SIZE;n++)a[n]=h[n]^i[n]}for(i=t.Ke[t.numRounds],n=0;n<t.BLOCK_SIZE;n++)a[n]=t.S[255&a[n]];for(n=0;n<t.BLOCK_SIZE;n++)r=n%t.COL_SIZE,o=(n+t.row_shift[r]*t.COL_SIZE)%t.BLOCK_SIZE,h[n]=a[o];for(n=0;n<t.BLOCK_SIZE;n++)a[n]=h[n]^i[n];return a},t.setKey=function(e){var i,n,o,r=Math.floor(t.BLOCK_SIZE/4),s=e.length,a=Math.floor(s/4);if(16!=e.length&&24!=e.length&&32!=e.length)throw Error("[AES] Incorrect key length");t.numRounds=t.getRounds(s);var h=(t.numRounds+1)*r,u=new Uint8Array(h),p=new Uint8Array(h),c=new Uint8Array(h),l=new Uint8Array(h);for(t.Ke=new Array,i=0;i<t.numRounds+1;i++)t.Ke.push(new Uint8Array(t.BLOCK_SIZE));for(t.Kd=new Array,i=0;i<t.numRounds+1;i++)t.Kd.push(new Uint8Array(t.BLOCK_SIZE));for(n=0,i=0;a>i;i++)u[i]=e[n++],p[i]=e[n++],c[i]=e[n++],l[i]=e[n++];var d,_,f,g,y;for(i=a;h>i;i++)d=u[i-1],_=p[i-1],f=c[i-1],g=l[i-1],i%a==0?(y=d,d=255&(t.S[255&_]^t.rcon[i/a]),_=255&t.S[255&f],f=255&t.S[255&g],g=255&t.S[255&y]):a>6&&i%a==4&&(d=t.S[255&d],_=t.S[255&_],f=t.S[255&f],g=t.S[255&g]),u[i]=u[i-a]^d,p[i]=p[i-a]^_,c[i]=c[i-a]^f,l[i]=l[i-a]^g;for(i=0,o=0;o<t.numRounds+1;o++)for(n=0;r>n;n++)t.Ke[o][4*n]=u[i],t.Ke[o][4*n+1]=p[i],t.Ke[o][4*n+2]=c[i],t.Ke[o][4*n+3]=l[i],t.Kd[t.numRounds-o][4*n]=u[i],t.Kd[t.numRounds-o][4*n+1]=p[i],t.Kd[t.numRounds-o][4*n+2]=c[i],t.Kd[t.numRounds-o][4*n+3]=l[i],i++},t.blockData=function(e){var t=new egret.ByteArray;if(t.writeUTFBytes(e),t.length<16)for(var i=16-t.length,n=0;i>n;n++)t.position=t.length,t.writeByte(0);var o=t.buffer.byteLength;o>16&&(o=16);var r=new Uint8Array(t.buffer,0,o);return r},t.EncryptHex=function(e,i){t.init();for(var n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);t.setKey(n);var r="",s=i.length,a=Math.floor(s/16),h=0;h=s%16==0?a:a+1;for(var u=0,p=16,c=0;h>c;c++){var l=p*(c+1)>=s?s:p*(c+1),d=i.substring(u,l),_=t.encrypt(t.blockData(d));r+=t.toHEX(_),u=l+1}return r.toUpperCase()},t.toHEX=function(t){var i=new egret.ByteArray(t.buffer);return e.Hex.fromByteArray(i)},t.BLOCK_SIZE=16,t.S=new Uint8Array([99,124,119,123,-14,107,111,-59,48,1,103,43,-2,-41,-85,118,-54,-126,-55,125,-6,89,71,-16,-83,-44,-94,-81,-100,-92,114,-64,-73,-3,-109,38,54,63,-9,-52,52,-91,-27,-15,113,-40,49,21,4,-57,35,-61,24,-106,5,-102,7,18,-128,-30,-21,39,-78,117,9,-125,44,26,27,110,90,-96,82,59,-42,-77,41,-29,47,-124,83,-47,0,-19,32,-4,-79,91,106,-53,-66,57,74,76,88,-49,-48,-17,-86,-5,67,77,51,-123,69,-7,2,127,80,60,-97,-88,81,-93,64,-113,-110,-99,56,-11,-68,-74,-38,33,16,-1,-13,-46,-51,12,19,-20,95,-105,68,23,-60,-89,126,61,100,93,25,115,96,-127,79,-36,34,42,-112,-120,70,-18,-72,20,-34,94,11,-37,-32,50,58,10,73,6,36,92,-62,-45,-84,98,-111,-107,-28,121,-25,-56,55,109,-115,-43,78,-87,108,86,-12,-22,101,122,-82,8,-70,120,37,46,28,-90,-76,-58,-24,-35,116,31,75,-67,-117,-118,112,62,-75,102,72,3,-10,14,97,53,87,-71,-122,-63,29,-98,-31,-8,-104,17,105,-39,-114,-108,-101,30,-121,-23,-50,85,40,-33,-116,-95,-119,13,-65,-26,66,104,65,-103,45,15,-80,84,-69,22]),t.rcon=new Uint8Array([0,1,2,4,8,16,32,64,-128,27,54,108,-40,-85,77,-102,47,94,-68,99,-58,-105,53,106,-44,-77,125,-6,-17,-59,-111]),t.COL_SIZE=4,t.NUM_COLS=t.BLOCK_SIZE/t.COL_SIZE,t.ROOT=283,t.row_shift=new Int32Array([0,1,2,3]),t.alog=new Uint8Array(256),t.log=new Uint8Array(256),t}();e.AES=t,__reflect(t.prototype,"Core.AES")}(Core||(Core={}));var Core;!function(e){var t=function(){function e(){this._keyList=[],this._valueList=[]}return e.prototype.clear=function(){this._keyList.length>0&&this._keyList.splice(0,this._keyList.length),this._valueList.length>0&&this._valueList.splice(0,this._valueList.length)},e.prototype.foreach=function(e){for(var t=0,i=this._valueList.length;i>t;t++)e(this._keyList[t],this._valueList[t])},e.prototype.getValue=function(e){var t=this._keyList.indexOf(e);return t>=0?this._valueList[t]:null},e.prototype.getKey=function(e){var t=this._valueList.indexOf(e);return t>=0?this._keyList[t]:null},e.prototype.has=function(e){var t=this._keyList.indexOf(e);return t>=0?!0:!1},e.prototype.add=function(e,t,i){void 0===i&&(i=!1),null!=e&&(this.remove(e),i?(this._keyList.unshift(e),this._valueList.unshift(t)):(this._keyList.push(e),this._valueList.push(t)))},e.prototype.remove=function(e){var t=this._keyList.indexOf(e);if(t>=0){this._keyList.splice(t,1);var i=this._valueList.splice(t,1)[0];return i}return null
},Object.defineProperty(e.prototype,"length",{get:function(){return this._keyList.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyList",{get:function(){return this._keyList},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valueList",{get:function(){return this._valueList},enumerable:!0,configurable:!0}),e}();e.AssociativeMap=t,__reflect(t.prototype,"Core.AssociativeMap")}(Core||(Core={}));var Base64=function(){function e(){}return e.encode=function(t){return e.base64encode(e.utf16to8(t))},e.decode=function(t){return e.utf8to16(e.base64decode(t))},e.base64encode=function(t){for(var i,n,o,r=0,s=t.length,a="";s>r;){if(i=255&t.charCodeAt(r++),r==s){a+=e.base64EncodeChars.charAt(i>>2),a+=e.base64EncodeChars.charAt((3&i)<<4),a+="==";break}if(n=t.charCodeAt(r++),r==s){a+=e.base64EncodeChars.charAt(i>>2),a+=e.base64EncodeChars.charAt((3&i)<<4|(240&n)>>4),a+=e.base64EncodeChars.charAt((15&n)<<2),a+="=";break}o=t.charCodeAt(r++),a+=e.base64EncodeChars.charAt(i>>2),a+=e.base64EncodeChars.charAt((3&i)<<4|(240&n)>>4),a+=e.base64EncodeChars.charAt((15&n)<<2|(192&o)>>6),a+=e.base64EncodeChars.charAt(63&o)}return a},e.base64decode=function(t){for(var i,n,o,r,s=0,a=t.length,h="";a>s;){do i=e.base64DecodeChars[255&t.charCodeAt(s++)];while(a>s&&-1==i);if(-1==i)break;do n=e.base64DecodeChars[255&t.charCodeAt(s++)];while(a>s&&-1==n);if(-1==n)break;h+=String.fromCharCode(i<<2|(48&n)>>4);do{if(o=255&t.charCodeAt(s++),61==o)return h;o=e.base64DecodeChars[o]}while(a>s&&-1==o);if(-1==o)break;h+=String.fromCharCode((15&n)<<4|(60&o)>>2);do{if(r=255&t.charCodeAt(s++),61==r)return h;r=e.base64DecodeChars[r]}while(a>s&&-1==r);if(-1==r)break;h+=String.fromCharCode((3&o)<<6|r)}return h},e.utf16to8=function(e){var t,i,n=e.length,o="";for(t=0;n>t;t++)i=e.charCodeAt(t),i>=1&&127>=i?o+=e.charAt(t):i>2047?(o+=String.fromCharCode(224|i>>12&15),o+=String.fromCharCode(128|i>>6&63),o+=String.fromCharCode(128|i>>0&63)):(o+=String.fromCharCode(192|i>>6&31),o+=String.fromCharCode(128|i>>0&63));return o},e.utf8to16=function(e){for(var t,i,n,o=0,r=e.length,s="";r>o;)switch(t=e.charCodeAt(o++),t>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=e.charAt(o-1);break;case 12:case 13:i=e.charCodeAt(o++),s+=String.fromCharCode((31&t)<<6|63&i);break;case 14:i=e.charCodeAt(o++),n=e.charCodeAt(o++),s+=String.fromCharCode((15&t)<<12|(63&i)<<6|(63&n)<<0)}return s},e.base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e.base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1),e}();__reflect(Base64.prototype,"Base64");var Core;!function(e){var t=function(){function e(){}return e.getFormatBySecond=function(t,i){void 0===i&&(i=1);var n="";switch(i){case 1:n=e.getFormatBySecond1(t);break;case 2:n=e.getFormatBySecond2(t);break;case 3:n=e.getFormatBySecond3(t);break;case 4:n=e.getFormatBySecond4(t);break;case 5:n=e.getFormatBySecond5(t)}return n},e.getFormatBySecond1=function(e){void 0===e&&(e=0);var t,i=Math.floor(e/3600);t=0==i?"00":10>i?"0"+i:""+i;var n,o,r=Math.floor((e-3600*i)/60),s=Math.floor((e-3600*i)%60);return n=0==r?"00":10>r?"0"+r:""+r,o=0==s?"00":10>s?"0"+s:""+s,t+":"+n+":"+o},e.getFormatBySecond3=function(e){void 0===e&&(e=0);var t,i,n=Math.floor(e/3600),o=Math.floor((e-3600*n)/60),r=Math.floor((e-3600*n)%60);return t=0==o?"00":10>o?"0"+o:""+o,i=0==r?"00":10>r?"0"+r:""+r,t+":"+i},e.getFormatBySecond2=function(e){var t=new Date(e),i=t.getFullYear(),n=t.getMonth()+1,o=t.getDate(),r=t.getHours(),s=t.getMinutes(),a=t.getSeconds();return i+"-"+n+"-"+o+" "+r+":"+s+":"+a},e.getFormatBySecond4=function(e){var t=Math.floor(e/3600);return t>0?t>24?Math.floor(t/24)+"天前":t+"小时前":Math.floor(e/60)+"分钟前"},e.getFormatBySecond5=function(e){var t=86400,i=3600,n=60,o=Math.floor(e/t),r=Math.floor(e%t/i),s=Math.floor((e-r*i)/n),a=Math.floor((e-r*i)%n),h="",u="",p="",c="";return e>0?0==o?(h="",0==r?(u="",0==s?(p="",c=0==a?"":10>a?"0"+a+"秒":""+a+"秒"):(p=""+s+"分",c=0==a?"":10>a?"0"+a+"秒":""+a+"秒",p+c)):(u=r+"小时",0==s?(p="",c=0==a?"":10>a?"0"+a+"秒":""+a+"秒"):(p=10>s?"0"+s+"分":""+s+"分",u+p))):(h=o+"天",u=0==r?"":10>r?"0"+r+"小时":""+r+"小时",h+u):""},e}();e.DateFormat=t,__reflect(t.prototype,"Core.DateFormat")}(Core||(Core={}));var Core;!function(e){var t=function(){function e(){}return e}();__reflect(t.prototype,"KeyValuePair");var i=function(){function e(){this._keyList=[],this._valueList=[],this._dic=new Utility.Dictionary}return e.prototype._isListEntry=function(e){return void 0!==e.enqueue},e.prototype._getHashString=function(e){var t=e.toString(),i=MD5.hex_md5(t);return i},e.prototype.clear=function(){var e=this;this._keyList.length>0&&this._keyList.splice(0,this._keyList.length),this._valueList.length>0&&this._valueList.splice(0,this._valueList.length),this._dic.keys.forEach(function(t,i){e._dic.remove(t)})},e.prototype._kOfKey=function(e){var t=null;return t="string"==typeof e?e:this._getHashString(e)},e.prototype._getIdxOf=function(e,t){if(t||(t=this._kOfKey(e)),!this._dic.contains(t))return-1;var i=this._dic.get(t);if(!this._isListEntry(i))return i.key===e?i.value:-1;for(var n=i,o=0;o<n.length;o++){var r=n.get_at(o);if(r.key===e)return r.value}},e.prototype._setIdxOf=function(e,i,n){if(n||(n=this._kOfKey(e)),!this._dic.contains(n)){var o=new t;return o.key=e,o.value=i,void this._dic.add(n,o)}var r=this._dic.get(n);if(this._isListEntry(r)){for(var s=r,a=0;a<s.length;a++){var h=s.get_at(a);if(h.key===e)return void(h.value=i)}var o=new t;o.key=e,o.value=i,s.push(o)}else if(r.key===e)r.value=i;else{var s=new Utility.HandyArray;s.push(r);var o=new t;o.key=e,o.value=i,s.push(o),this._dic.add(n,s)}},e.prototype._removeIdx=function(e,t){if(t||(t=this._kOfKey(e)),this._dic.contains(t)){var i=this._dic.get(t);if(this._isListEntry(i))for(var n=i,o=0;o<n.length;o++){var r=n.get_at(o);if(r.key===e)return n.dequeueAt(o),void(n.length<=0&&this._dic.remove(t))}else this._dic.remove(t)}},e.prototype.getValue=function(e){var t=this._getIdxOf(e);return 0>t?null:this._valueList[t]},e.prototype.getKey=function(e){var t=this._valueList.indexOf(e);return t>=0?this._keyList[t]:null},e.prototype.has=function(e){var t=this._kOfKey(e);return this._dic.contains(t)},e.prototype.add=function(e,t){if(e){var i=this._kOfKey(e),n=this._getIdxOf(e,i);if(n>=0)return this._keyList[n]=e,void(this._valueList[n]=t);n=this._keyList.length,this._keyList.push(e),this._valueList.push(t),this._setIdxOf(e,n,i)}},e.prototype.remove=function(e){var t=this._kOfKey(e),i=this._getIdxOf(e,t);if(0>i)return null;this._removeIdx(e,t),this._keyList.splice(i,1);var n=this._valueList.splice(i,1)[0];return n},Object.defineProperty(e.prototype,"length",{get:function(){return this._keyList.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyList",{get:function(){return this._keyList},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valueList",{get:function(){return this._valueList},enumerable:!0,configurable:!0}),e}();e.HashMap=i,__reflect(i.prototype,"Core.HashMap")}(Core||(Core={}));var Core;!function(e){var t=function(){function e(){}return e.toByteArray=function(e){e=e.replace(/\s|:/gm,"");var t=new egret.ByteArray;1==(1&e.length)&&(e="0"+e);for(var i,n=0;n<e.length;n+=2)i=parseInt(e.substr(n,2),16),t.writeByte(0),t.dataView.setUint8(n/2,i);return t.position=0,t},e.fromByteArray=function(e,t){void 0===t&&(t=!1);for(var i,n="",o=0;o<e.length;o++)i=e.dataView.getUint8(o),n+=("0"+i.toString(16)).substr(-2,2),t&&o<e.length-1&&(n+=":");return n},e.toString=function(e){var t=this.toByteArray(e);return t.readUTFBytes(t.length)},e.fromString=function(e,t){void 0===t&&(t=!1);var i=new egret.ByteArray;return i.writeUTFBytes(e),this.fromByteArray(i,t)},e}();e.Hex=t,__reflect(t.prototype,"Core.Hex")}(Core||(Core={}));var Core;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t._iframePage=document.createElement("IFRAME"),t._iframePage.id="if_page",t._iframePage.width="100%",t._iframePage.height="100%",t._iframePage.style.left="0px",t._iframePage.style.top="0px",t._iframePage.style.border="0px",t._iframePage.style.padding="0px",t._iframePage.style.position="absolute",t._iframePage.style.zIndex="10000",t._iframeReturn=document.createElement("IFRAME"),t._iframeReturn.id="if_return",t._iframeReturn.width="147",t._iframeReturn.height="85",t._iframeReturn.style.top="0px",t._iframeReturn.style.left="0px",t._iframeReturn.style.border="0px",t._iframeReturn.style.padding="0px",t._iframeReturn.style.position="absolute",t._iframeReturn.style.zIndex="10001",t._iframeReturn.onload=function(){t._iframeReturn.contentWindow.onclick=function(){t.sendClosePageEvent()}},t}return __extends(t,e),t.prototype.open=function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i="#ffffff"),this._iframePage.style.backgroundColor=i,this._iframePage.src=e,document.body.appendChild(this._iframePage),t&&(this._iframeReturn.src="resource/css/return.png",document.body.appendChild(this._iframeReturn)),this.show()},t.prototype.close=function(){this._iframePage.src="about:blank",this._iframeReturn.src="about:blank",this._iframePage.parentNode&&document.body.removeChild(this._iframePage),this._iframeReturn.parentNode&&document.body.removeChild(this._iframeReturn),this.hide()},t.prototype.show=function(){this._iframePage.style.display="block",this._iframeReturn.style.display="block"},t.prototype.hide=function(){this._iframePage.style.display="none",this._iframeReturn.style.display="none"},t.prototype.sendClosePageEvent=function(){egret.MainContext.instance.stage.dispatchEventWith("close_iframe_page")},t}(e.BaseSingleton);e.iframePage=t,__reflect(t.prototype,"Core.iframePage")}(Core||(Core={}));var Log=function(){function e(){}return e.skipTags=function(e){for(var t=0,i=e;t<i.length;t++){var n=i[t];this._skipTags.indexOf(n)<0&&this._skipTags.push(n)}},e.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.unshift("Log"),this.traceTag.apply(this,e)},e.traceTag=function(t,i){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];t||(t=""),e.logLevel>0||this._skipTags.indexOf(t)>=0||(i&&"object"==typeof i?console.log.apply(console,["["+t+"]> ",i].concat(n)):console.log.apply(console,["["+t+"]> "+i].concat(n)))},e.error=function(t,i){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];t||(t=""),e.logLevel<0||(i&&"object"==typeof i?console.log.apply(console,["["+t+"]> ",i].concat(n)):console.log.apply(console,["["+t+"]> "+i].concat(n)))},e._skipTags=[],e.logLevel=0,e}();__reflect(Log.prototype,"Log");var MD5=function(){function e(){}return e.hex_md5=function(e){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(e))).toUpperCase()},e.b64_md5=function(e){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(e)))},e.any_md5=function(e,t){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(e)),t)},e.hex_hmac_md5=function(e,t){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)))},e.b64_hmac_md5=function(e,t){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)))},e.any_hmac_md5=function(e,t,i){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)),i)},e.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},e.rstr_md5=function(e){return this.binl2rstr(this.binl_md5(this.rstr2binl(e),8*e.length))},e.rstr_hmac_md5=function(e,t){var i=this.rstr2binl(e);i.length>16&&(i=this.binl_md5(i,8*e.length));for(var n=Array(16),o=Array(16),r=0;16>r;r++)n[r]=909522486^i[r],o[r]=1549556828^i[r];var s=this.binl_md5(n.concat(this.rstr2binl(t)),512+8*t.length);return this.binl2rstr(this.binl_md5(o.concat(s),640))},e.rstr2hex=function(e){try{this.hexcase}catch(t){this.hexcase=0}for(var i,n=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",o="",r=0;r<e.length;r++)i=e.charCodeAt(r),o+=n.charAt(i>>>4&15)+n.charAt(15&i);return o},e.rstr2b64=function(e){try{this.b64pad}catch(t){this.b64pad=""}for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",o=e.length,r=0;o>r;r+=3)for(var s=e.charCodeAt(r)<<16|(o>r+1?e.charCodeAt(r+1)<<8:0)|(o>r+2?e.charCodeAt(r+2):0),a=0;4>a;a++)n+=8*r+6*a>8*e.length?this.b64pad:i.charAt(s>>>6*(3-a)&63);return n},e.rstr2any=function(e,t){var i,n,o,r,s,a=t.length,h=Array(Math.ceil(e.length/2));for(i=0;i<h.length;i++)h[i]=e.charCodeAt(2*i)<<8|e.charCodeAt(2*i+1);var u=Math.ceil(8*e.length/(Math.log(t.length)/Math.log(2))),p=Array(u);for(n=0;u>n;n++){for(s=Array(),r=0,i=0;i<h.length;i++)r=(r<<16)+h[i],o=Math.floor(r/a),r-=o*a,(s.length>0||o>0)&&(s[s.length]=o);p[n]=r,h=s}var c="";for(i=p.length-1;i>=0;i--)c+=t.charAt(p[i]);return c},e.str2rstr_utf8=function(e){for(var t,i,n="",o=-1;++o<e.length;)t=e.charCodeAt(o),i=o+1<e.length?e.charCodeAt(o+1):0,t>=55296&&56319>=t&&i>=56320&&57343>=i&&(t=65536+((1023&t)<<10)+(1023&i),o++),127>=t?n+=String.fromCharCode(t):2047>=t?n+=String.fromCharCode(192|t>>>6&31,128|63&t):65535>=t?n+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):2097151>=t&&(n+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return n},e.str2rstr_utf16le=function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(255&e.charCodeAt(i),e.charCodeAt(i)>>>8&255);return t},e.str2rstr_utf16be=function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(e.charCodeAt(i)>>>8&255,255&e.charCodeAt(i));return t},e.rstr2binl=function(e){for(var t=Array(e.length>>2),i=0;i<t.length;i++)t[i]=0;for(var i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t},e.binl2rstr=function(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t},e.binl_md5=function(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var i=1732584193,n=-271733879,o=-1732584194,r=271733878,s=0;s<e.length;s+=16){var a=i,h=n,u=o,p=r;i=this.md5_ff(i,n,o,r,e[s+0],7,-680876936),r=this.md5_ff(r,i,n,o,e[s+1],12,-389564586),o=this.md5_ff(o,r,i,n,e[s+2],17,606105819),n=this.md5_ff(n,o,r,i,e[s+3],22,-1044525330),i=this.md5_ff(i,n,o,r,e[s+4],7,-176418897),r=this.md5_ff(r,i,n,o,e[s+5],12,1200080426),o=this.md5_ff(o,r,i,n,e[s+6],17,-1473231341),n=this.md5_ff(n,o,r,i,e[s+7],22,-45705983),i=this.md5_ff(i,n,o,r,e[s+8],7,1770035416),r=this.md5_ff(r,i,n,o,e[s+9],12,-1958414417),o=this.md5_ff(o,r,i,n,e[s+10],17,-42063),n=this.md5_ff(n,o,r,i,e[s+11],22,-1990404162),i=this.md5_ff(i,n,o,r,e[s+12],7,1804603682),r=this.md5_ff(r,i,n,o,e[s+13],12,-40341101),o=this.md5_ff(o,r,i,n,e[s+14],17,-1502002290),n=this.md5_ff(n,o,r,i,e[s+15],22,1236535329),i=this.md5_gg(i,n,o,r,e[s+1],5,-165796510),r=this.md5_gg(r,i,n,o,e[s+6],9,-1069501632),o=this.md5_gg(o,r,i,n,e[s+11],14,643717713),n=this.md5_gg(n,o,r,i,e[s+0],20,-373897302),i=this.md5_gg(i,n,o,r,e[s+5],5,-701558691),r=this.md5_gg(r,i,n,o,e[s+10],9,38016083),o=this.md5_gg(o,r,i,n,e[s+15],14,-660478335),n=this.md5_gg(n,o,r,i,e[s+4],20,-405537848),i=this.md5_gg(i,n,o,r,e[s+9],5,568446438),r=this.md5_gg(r,i,n,o,e[s+14],9,-1019803690),o=this.md5_gg(o,r,i,n,e[s+3],14,-187363961),n=this.md5_gg(n,o,r,i,e[s+8],20,1163531501),i=this.md5_gg(i,n,o,r,e[s+13],5,-1444681467),r=this.md5_gg(r,i,n,o,e[s+2],9,-51403784),o=this.md5_gg(o,r,i,n,e[s+7],14,1735328473),n=this.md5_gg(n,o,r,i,e[s+12],20,-1926607734),i=this.md5_hh(i,n,o,r,e[s+5],4,-378558),r=this.md5_hh(r,i,n,o,e[s+8],11,-2022574463),o=this.md5_hh(o,r,i,n,e[s+11],16,1839030562),n=this.md5_hh(n,o,r,i,e[s+14],23,-35309556),i=this.md5_hh(i,n,o,r,e[s+1],4,-1530992060),r=this.md5_hh(r,i,n,o,e[s+4],11,1272893353),o=this.md5_hh(o,r,i,n,e[s+7],16,-155497632),n=this.md5_hh(n,o,r,i,e[s+10],23,-1094730640),i=this.md5_hh(i,n,o,r,e[s+13],4,681279174),r=this.md5_hh(r,i,n,o,e[s+0],11,-358537222),o=this.md5_hh(o,r,i,n,e[s+3],16,-722521979),n=this.md5_hh(n,o,r,i,e[s+6],23,76029189),i=this.md5_hh(i,n,o,r,e[s+9],4,-640364487),r=this.md5_hh(r,i,n,o,e[s+12],11,-421815835),o=this.md5_hh(o,r,i,n,e[s+15],16,530742520),n=this.md5_hh(n,o,r,i,e[s+2],23,-995338651),i=this.md5_ii(i,n,o,r,e[s+0],6,-198630844),r=this.md5_ii(r,i,n,o,e[s+7],10,1126891415),o=this.md5_ii(o,r,i,n,e[s+14],15,-1416354905),n=this.md5_ii(n,o,r,i,e[s+5],21,-57434055),i=this.md5_ii(i,n,o,r,e[s+12],6,1700485571),r=this.md5_ii(r,i,n,o,e[s+3],10,-1894986606),o=this.md5_ii(o,r,i,n,e[s+10],15,-1051523),n=this.md5_ii(n,o,r,i,e[s+1],21,-2054922799),i=this.md5_ii(i,n,o,r,e[s+8],6,1873313359),r=this.md5_ii(r,i,n,o,e[s+15],10,-30611744),o=this.md5_ii(o,r,i,n,e[s+6],15,-1560198380),n=this.md5_ii(n,o,r,i,e[s+13],21,1309151649),i=this.md5_ii(i,n,o,r,e[s+4],6,-145523070),r=this.md5_ii(r,i,n,o,e[s+11],10,-1120210379),o=this.md5_ii(o,r,i,n,e[s+2],15,718787259),n=this.md5_ii(n,o,r,i,e[s+9],21,-343485551),i=this.safe_add(i,a),n=this.safe_add(n,h),o=this.safe_add(o,u),r=this.safe_add(r,p)}return[i,n,o,r]},e.md5_cmn=function(e,t,i,n,o,r){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(n,r)),o),i)},e.md5_ff=function(e,t,i,n,o,r,s){return this.md5_cmn(t&i|~t&n,e,t,o,r,s)},e.md5_gg=function(e,t,i,n,o,r,s){return this.md5_cmn(t&n|i&~n,e,t,o,r,s)},e.md5_hh=function(e,t,i,n,o,r,s){return this.md5_cmn(t^i^n,e,t,o,r,s)},e.md5_ii=function(e,t,i,n,o,r,s){return this.md5_cmn(i^(t|~n),e,t,o,r,s)},e.safe_add=function(e,t){var i=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(i>>16);return n<<16|65535&i},e.bit_rol=function(e,t){return e<<t|e>>>32-t},e.hexcase=0,e.b64pad="",e}();__reflect(MD5.prototype,"MD5");var Core;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t=__decorate([singleton],t)}(Utility.Observable);e.MessageCenter=t,__reflect(t.prototype,"Core.MessageCenter")}(Core||(Core={}));var Core;!function(e){var t=function(){function t(){this._resMap=new e.HashMap}return t.prototype.getRes=function(e){var t=this._resMap.getValue(e);return null==t&&(t=RES.getRes(e),t&&this._resMap.add(e,t)),t},t.prototype.clear=function(){this._resMap.clear(),this._resMap=null},t}();e.ResPool=t,__reflect(t.prototype,"Core.ResPool")}(Core||(Core={})),String.isNullOrEmpty=function(e){return void 0==e||null==e?!0:""==e?!0:!1},String.toBase64=function(e){return String.isNullOrEmpty(e)?e:Base64.encode(e)},String.toUriFriendlyBase64=function(e){if(String.isNullOrEmpty(e))return e;var t=Base64.encode(e);return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},String.fromBase64=function(e){return String.isNullOrEmpty(e)?e:Base64.decode(e)},String.fromUriFriendlyBase64=function(e){if(String.isNullOrEmpty(e))return e;var t=(e+"===").slice(0,e.length+e.length%4);return t=t.replace(/-/g,"+").replace(/_/g,"/"),Base64.decode(t)},String.digestMD5=function(e){return String.isNullOrEmpty(e)?e:MD5.hex_md5(e)},String.prototype.formatUnicorn=String.prototype.formatUnicorn||function(){"use strict";var e=this.toString();if(arguments.length){var t,i=typeof arguments[0],n="string"===i||"number"===i?Array.prototype.slice.call(arguments):arguments[0];for(t in n)e=e.replace(new RegExp("\\{"+t+"\\}","gi"),n[t])}return e},String.prototype.digestMD5=String.prototype.digestMD5||function(){return String.digestMD5(this)};var Game=function(){function e(){}return Object.defineProperty(e,"DataCenter",{get:function(){return DataCenter.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Tool",{get:function(){return Tool.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SoundManager",{get:function(){return PlatformSoundManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SoundController",{get:function(){return SoundController.getInstance()},enumerable:!0,configurable:!0}),e.init=function(){TouchHelp.Touch.init(),StatLog.Instance.init("tanchishe ver-"+AppConfig.ver),MainProc.getInstance().beginProc()},e.BmpPool=new Core.BitmapPool,e.ObjPool=new Core.ObjectPool,e}();__reflect(Game.prototype,"Game");var GameMessageType=function(){function e(){}return e.NOTICE_OPEN_MODULE="notice_open_module",e.NOTICE_SOCKET_OPEN="notice_socket_open",e.NOTICE_SOCKET_CLOSE="notice_socket_close",e.NOTICE_SOCKET_DATA="notice_socket_data",e.NOTICE_UPDATE_TOKEN_REQ="notice_update_token_req",e.NOTICE_UPDATE_TOKEN_DONE="notice_update_token_done",e.NOTICE_ONDATA_CHANGED="notice_ondata_changed",e.SERVER_LOGINED="server_logined",e.WXAUTH_READY="wxauth_ready",e.PROCESS_STOP_MOVE="process_stop_move",e.PROCESS_CONTINUE_MOVE="process_continue_move",e.PROCESS_DO_BODY_REMOVE="process_do_body_remove",e.PROCESS_GAME_GUIDE="process_game_guide",e.PROCESS_GAME_START="process_game_start",e.PROCESS_GAME_RESET="process_game_reset",e.PROCESS_MATCH_OPEN="process_match_open",e.PROCESS_MATCH_START="process_match_start",e.PROCESS_MATCH_END="process_match_end",e.PROCESS_MATCH_CANCEL="process_match_cancel",e.PROCESS_MATCH_CLOSE="process_match_close",e.PROCESS_BATTLE_CANCEL="notice_battle_cancel",e.PROCESS_BATTLE_END="process_battle_end",e.PROCESS_BATTLE_SELF_OVER="process_battle_self_over",e.PROCESS_BATTLE_RESULT="process_battle_result",e.PROCESS_BATTLE_INJURE_SELF="process_battle_injure_self",e.PROCESS_BATTLE_STONES_CHANGE_SELF="process_battle_stones_change_self",e.PROCESS_BATTLE_STONES_CHANGE_OPPONENT="process_battle_stones_change_opponent",e.PROCESS_TRIGGER_GC="process_trigger_gc",e}();__reflect(GameMessageType.prototype,"GameMessageType");var AppMessageType=function(){function e(){}return e.APP_REWUMED="app_resumed",e.APP_SUSPEND="app_suspend",e}();__reflect(AppMessageType.prototype,"AppMessageType");var Data;!function(e){var t=function(){function e(){}return e.loadData=function(){this._sfxOn="true"==App.LocalStorageData.load(Core.LocalStorageType.SOUND_FX_ENABLE),this._bgOn="true"==App.LocalStorageData.load(Core.LocalStorageType.SOUND_BG_ENABLE),this._valueChanged=!1},e.saveData=function(){var e;e=this._sfxOn?"true":"false",App.LocalStorageData.save(Core.LocalStorageType.SOUND_FX_ENABLE,e),e=this._bgOn?"true":"false",App.LocalStorageData.save(Core.LocalStorageType.SOUND_BG_ENABLE,e)},Object.defineProperty(e,"sfxOn",{get:function(){return this._valueChanged&&this.loadData(),this._sfxOn},set:function(e){this._sfxOn!=e&&(this._sfxOn=e,this.saveData(),this._valueChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"bgOn",{get:function(){return this._valueChanged&&this.loadData(),this._bgOn},set:function(e){this._bgOn!=e&&(this._bgOn=e,this.saveData(),this._valueChanged=!0)},enumerable:!0,configurable:!0}),e._valueChanged=!0,e}();e.SoundControlData=t,__reflect(t.prototype,"Data.SoundControlData")}(Data||(Data={}));var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),AppConfig.isRelease&&(egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()});var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),Log.trace(">>> booting ... "),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return Log.trace("loading resource ... "),[4,this.loadResource()];case 1:return e.sent(),this.startGame(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),e=new LoadingUI,this.stage.addChild(e),Log.trace("loading default.res ... "),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),Log.trace("loading default.thm ... "),[4,this.loadTheme()];case 2:return i.sent(),[4,Utility.Async.Defer(300)];case 3:return i.sent(),Log.trace("loading preres ... "),[4,RES.loadGroup("preload",0,e)];case 4:return i.sent(),this.stage.removeChild(e),[3,6];case 5:return t=i.sent(),Log.error("boot","failed to load resource: ",t),[3,6];case 6:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var n=new eui.Theme("resource/default.thm.json",e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.startGame=function(){Log.trace("initializing game context ... "),StatLog.Instance.isUpload=!1,App.LayerManager.init(this.stage),ViewPort.setUIDimension(this.stage.stageWidth,this.stage.stageHeight),App.init(),Game.init(),Log.trace(">>> boot done"),App.MessageCenter.dispatch(Core.AppMessageType.APP_START)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var MainProc=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._tokenExpiryTime=12e5,t._lastUpdateTokenTime=0,t._loginTimes=0,t._battleCancelWhenHide=!1,t}return __extends(t,e),t.prototype.beginProc=function(){e.prototype.beginProc.call(this),App.MessageCenter.addListener(Core.AppMessageType.APP_START,this.onAppStart,this)},t.prototype.endProc=function(){this._active&&e.prototype.endProc.call(this)},t.prototype.onAppStart=function(){App.MessageCenter.removeListener(Core.AppMessageType.APP_START,this.onAppStart,this),Log.trace(">>>>>>>>>>>>>>> v "+GameVersion+" <<<<<<<<<<<<<<<<<<"),this.initPlatform()},t.prototype.doFirstLoginDone=function(e){App.LoopLoading.hide(),e?(t.firstLoginSuccess=!0,this.doCheckCanAcceptBattleAtLaunch()):(t.firstLoginSuccess=!1,platform.showModal(Game.DataCenter.appName,"登录失败")),platform.onShow(this.onShow),platform.onHide(this.onHide)},t.prototype.initPlatform=function(){Game.DataCenter.systemInfo=platform.getSystemInfoSync(),Game.DataCenter.systemInfo?Log.trace(JSON.stringify(Game.DataCenter.systemInfo)):Log.trace("getSystemInfoSync获取系统信息失败！"),Game.DataCenter.init(),App.MessageCenter.addListener(GameMessageType.PROCESS_MATCH_OPEN,this.onMatchOpen,this),App.MessageCenter.addListener(GameMessageType.PROCESS_MATCH_START,this.onMatchStart,this),App.MessageCenter.addListener(GameMessageType.PROCESS_MATCH_END,this.onMatchEnd,this),App.MessageCenter.addListener(GameMessageType.PROCESS_MATCH_CANCEL,this.onMatchCancel,this),App.MessageCenter.addListener(GameMessageType.PROCESS_MATCH_CLOSE,this.onMatchClose,this),App.MessageCenter.addListener(GameMessageType.PROCESS_BATTLE_CANCEL,this.onBattleCancel,this),App.MessageCenter.addListener(GameMessageType.PROCESS_BATTLE_END,this.onBattleEnd,this),App.MessageCenter.addListener(GameMessageType.PROCESS_TRIGGER_GC,this.onTriggerGC,this),App.MessageCenter.addListener(GameMessageType.WXAUTH_READY,this.onWxAuthOK,this),App.MessageCenter.addListener("ui.view_ready",this.onPlayViewReady,this),Game.SoundManager.initSound("chi","resource/sound/snake_chibaoshi1.mp3",!1),Game.SoundManager.initSound("xiao","resource/sound/snake_baoshixc1.mp3",!1),Game.SoundManager.initSound("over","resource/sound/snake_over1.mp3",!1),Game.SoundManager.initSound("button","resource/sound/snake_button1.mp3",!1),Game.SoundManager.initSound("countdown","resource/sound/snake_daojishi1.mp3",!1),Game.SoundManager.initSound("go","resource/sound/snake_go1.mp3",!1),Game.SoundManager.initSound("defeat","resource/sound/snake_defeat1.mp3",!1),Game.SoundManager.initSound("vswin","resource/sound/snake_vswin1.mp3",!1),Game.SoundManager.initSound("vslose","resource/sound/snake_vslose1.mp3",!1),Game.SoundManager.initSound("bg","resource/sound/snake_bgm1.mp3",!0),PlayProc.getInstance().beginProc(),celerSDK.onStart(function(){Log.trace("on sdk start"),App.MessageCenter.dispatch(GameMessageType.PROCESS_GAME_START,1)}),egret.setTimeout(function(){AppConfig.isRelease?(Log.trace("calling ready"),celerSDK.ready()):App.MessageCenter.dispatch(GameMessageType.PROCESS_GAME_START,1)},this,300)},t.prototype.doCheckCanAcceptBattleAtLaunch=function(){var e=platform.getLaunchOptionsSync();Log.trace(JSON.stringify(e)),t.getCanLaunchBattle(e)&&(App.WindowViewManager.closeAll(),Game.DataCenter.battleMode=0,Game.DataCenter.isFirstPlayerInBattle=!1)},t.prototype.onPlayViewReady=function(){},t.prototype.onShow=function(e){Log.trace("小程序激活"),Log.trace("onShow",JSON.stringify(e)),App.MessageCenter.dispatch(AppMessageType.APP_REWUMED),DataCenter.Instance.onShow(),App.MessageCenter.dispatch(GameMessageType.NOTICE_UPDATE_TOKEN_REQ,!1);var i=t.getInstance();i._battleCancelWhenHide=!1,t.getCanLaunchBattle(e)&&(App.WindowViewManager.closeAll(),App.MessageCenter.dispatch(GameMessageType.PROCESS_GAME_RESET),Game.DataCenter.battleMode=0,Game.DataCenter.isFirstPlayerInBattle=!1)},t.prototype.onHide=function(e){Log.trace("小程序搁置"),App.MessageCenter.dispatch(AppMessageType.APP_REWUMED);t.getInstance()},t.prototype.onBattleCancel=function(){Log.trace("MainProc.onBattleCancel")},t.prototype.onBattleEnd=function(){Log.trace("MainProc.onBattleEnd")},t.prototype.onMatchOpen=function(){Log.trace("MainProc.onMatchOpen"),this.showMatchWindow()},t.prototype.onMatchStart=function(){if(Log.trace("MainProc.onMatchStart"),DataCenter.Instance.gold<100)return void App.Dialog.Pop("当前金币不足，进入失败");Game.DataCenter.battleMode=1,Game.DataCenter.isFirstPlayerInBattle=!0;({avatar:Game.DataCenter.getAvatarPath(),nick:Game.DataCenter.getNick()})},t.prototype.onMatchEnd=function(){Log.trace("MainProc.onMatchEnd"),this.showMatchWindow()},t.prototype.onMatchCancel=function(){Log.trace("MainProc.onMatchCanceled"),this.showMatchWindow()},t.prototype.onMatchClose=function(){Log.trace("MainProc.onMatchClosed")},t.prototype.onTriggerGC=function(){Game.BmpPool.cleanUp(),platform.triggerGC()},t.prototype.onWxAuthOK=function(){Log.trace(">>>>>>>>>>>>>>>>>>>>> wx auth ok, start login server <<<<<<<<<<<<<<<< "),this.doLoginReq()},t.prototype.showMatchWindow=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},t.getCanLaunchBattle=function(e){return Log.trace("验证是否进入对战"),Log.trace("step 1"),!1},t.prototype.doLoginReq=function(e){return void 0===e&&(e=!1),__awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return Log.trace("doLoginReq called"),App.LoopLoading.show(null),e=Utility.STLock.Instance.getLock("doLoginReq"),[4,Utility.STLock.tryEnterWrite(e,!0)];case 1:return(t=i.sent())?(Log.trace("doLoginReq called at write"),this.doFirstLoginDone(!1),Utility.STLock.leaveWrite(e),Log.trace("doLoginReq return at write"),[2]):(Log.trace("doLoginReq called at read, return"),[2])}})})},t.firstLoginSuccess=!1,t}(Core.BaseProc);__reflect(MainProc.prototype,"MainProc");var Play_Battle=function(){function e(e,t,i){this._active=!0,this._view=e,this._stone=t,this._effect=i}return e.prototype.destroy=function(){this._active&&(this.finish(),this._view=null,this._stone=null,this._effect=null,this._active=!1)},e.prototype.reset=function(){Log.trace("Play_Battle.reset()"),this._stoneNum=0,App.MessageCenter.addListener(GameMessageType.PROCESS_DO_BODY_REMOVE,this.onProcessBodyRemove,this),App.MessageCenter.addListener(GameMessageType.PROCESS_BATTLE_INJURE_SELF,this.onBattleSelfInjure,this),App.MessageCenter.addListener(GameMessageType.PROCESS_BATTLE_STONES_CHANGE_OPPONENT,this.onBattleOpponentStonesChange,this),App.GlobalRepeatTigger.addTime(1e3,this.checkSelfStoneNum,this)},e.prototype.finish=function(){Log.trace("Play_Battle.finish()"),App.GlobalRepeatTigger.removeTime(this.checkSelfStoneNum,this),App.MessageCenter.removeByThisObj(this)},e.prototype.onProcessBodyRemove=function(e){this._effect&&(Game.DataCenter.isFirstPlayerInBattle?this._effect.playBattleInjure(this._view.groupTX0,this._view.groupTX1):this._effect.playBattleInjure(this._view.groupTX1,this._view.groupTX0))},e.prototype.onBattleSelfInjure=function(e){this._effect&&(Game.DataCenter.isFirstPlayerInBattle?this._effect.playBattleInjure(this._view.groupTX1,this._view.groupTX0):this._effect.playBattleInjure(this._view.groupTX0,this._view.groupTX1)),this._stone&&(2==e?this._stone.addStoneLineAtBottom(2):this._stone.addStones(5),this.checkSelfStoneNum())
},e.prototype.onBattleOpponentStonesChange=function(e){this._view.updateTXMask(!Game.DataCenter.isFirstPlayerInBattle,e)},e.prototype.checkSelfStoneNum=function(){this._stone&&this._stoneNum!=this._stone.stoneCount&&(this._stoneNum=this._stone.stoneCount,this._view.updateTXMask(Game.DataCenter.isFirstPlayerInBattle,this._stoneNum),App.MessageCenter.dispatch(GameMessageType.PROCESS_BATTLE_STONES_CHANGE_SELF,this._stoneNum))},Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),e}();__reflect(Play_Battle.prototype,"Play_Battle");var Play_Bonus=function(){function e(e){this._maxBonusNum=8,this._boomNum=0,this._bonusNum=0,this._active=!0,this._group=e}return e.prototype.destroy=function(){this._active&&(this.reset(),this._bonusList=null,this._specialBonusAddup=null,this._group=null,this._active=!1)},e.prototype.reset=function(){if(this._bonusList){for(var e,t=this._bonusList.length-1;t>=0;t--)e=this._bonusList[t],this.removeBonus(e);App.Tool.clearArray(this._bonusList)}this._bonusList=[],this._boomNum=0,this._bonusNum=0,this._specialBonusAddup=[0,0]},e.prototype.init=function(){1==Game.DataCenter.playMode&&(this._maxBonusNum=3,this.addBonus(5),this.addBonus(5),this.addBonus(5))},e.prototype.updateMove=function(){for(var e,t=this._bonusList.length-1;t>=0;t--)e=this._bonusList[t],e.y+=e.speed,e.type>0&&(e.rotation+=e.rotateSpeed),e.y>ViewPort.stageBondBox.y+ViewPort.stageBondBox.height&&this.removeBonus(e);if(this._bonusList.length<this._maxBonusNum){var i=0;this._specialBonusAddup[0]>=40&&(this._specialBonusAddup[0]=0,i=-1),this._specialBonusAddup[1]>=30&&(this._specialBonusAddup[1]=0,i=-(Math.floor(5*Math.random())+2)),0==i&&(i=Math.floor(6*Math.random())+1);for(var t=0;t<this._specialBonusAddup.length;t++)this._specialBonusAddup[t]++;8!=this._maxBonusNum&&(this._maxBonusNum=8),this.addBonus(i),this._bonusNum++}},e.prototype.drawAllBonusToSnakeLoc=function(e,t){for(var i,n,o,r,s,a=this._bonusList.length-1;a>=0;a--)i=this._bonusList[a],n=e-i.x,o=t-i.y,r=n*n+o*o,s=5e4>r?.2:3e5>r?.02:.002,i.x+=(e-i.x)*s,i.y+=(t-i.y)*s},e.prototype.checkCollision=function(e,t){for(var i,n=0,o=this._bonusList.length-1;o>=0;o--)if(i=this._bonusList[o],Math.abs(e-i.x)<40&&Math.abs(t-i.y)<40){n=i.type,this.removeBonus(i);break}return n},e.prototype.addBonus=function(e){var t=Game.BmpPool.pickUp("gem"+e+"_png");t.touchEnabled=!1,t.x=Math.floor(700*Math.random())+50,t.y=40,t.speed=this._baseSpeed*(1.25-.5*Math.random()),t.rotateSpeed=Math.round(3*Math.random()-5)/8,t.type=e,this._bonusList.push(t),this._group.addChild(t),-5==e&&this._boomNum++},e.prototype.removeBonus=function(e){-5==e.type&&this._boomNum--,delete e.speed,delete e.rotateSpeed,delete e.type,App.Display.removeFromParent(e),App.Tool.deleteArrayItem(this._bonusList,e),e.rotation=0,Game.BmpPool.putDown(e)},e.prototype.getFirstBoom=function(){if(this._boomNum<=0)return null;for(var e,t=null,i=this._bonusList.length-1;i>=0;i--)e=this._bonusList[i],-5==e.type&&(null==t||e.y>t.y)&&(t=e);return t},Object.defineProperty(e.prototype,"bonusList",{get:function(){return this._bonusList},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseSpeed",{get:function(){return this._baseSpeed},set:function(e){this._baseSpeed=e},enumerable:!0,configurable:!0}),e}();__reflect(Play_Bonus.prototype,"Play_Bonus");var Play_Effect=function(){function e(e){this._active=!0,this._group=e,this._bmpDacha=Game.BmpPool.pickUp("dacha_png",!0),this._targetDefeatGroupList=[]}return e.prototype.destroy=function(){this._active&&(this.reset(),this._group=null,this._targetDefeatGroupList=null,this._active=!1)},e.prototype.reset=function(){this.removeVsDefeated()},e.prototype.init=function(){},e.prototype.playFrameList=function(t,i,n,o){var r=e.playerPool.pickUp(t);r.addCompleteCallback(this.onPlayerComplete,this),r.x=n,r.y=o,this._group.addChild(r),r.play(i,0,!1)},e.prototype.onPlayerComplete=function(t){App.Display.removeFromParent(t),e.playerPool.putDown(t)},e.prototype.playComboRemoveTween=function(e,t,i){var n=Game.ObjPool.pickUp(eui.BitmapLabel);n.font="font2_fnt",n.width=400,n.height=85,n.letterSpacing=5,n.textAlign="center",n.anchorOffsetX=200,n.anchorOffsetY=42.5,n.x=t,n.y=i,n.scaleX=n.scaleY=0,n.alpha=0,n.text=e+"b",this._group.addChild(n),egret.Tween.get(n).to({scaleX:1,scaleY:1,alpha:1},300,egret.Ease.quadOut).wait(300).to({scaleX:5,scaleY:5,alpha:0},300,egret.Ease.quadIn).call(this.onTweenComplete,this,[n])},e.prototype.onTweenComplete=function(e){App.Display.removeFromParent(e),Game.ObjPool.putDown(e),e.text=""},e.prototype.playBattleStartCountDown=function(){function e(e){var t=Game.ObjPool.pickUp(eui.BitmapLabel);t.font="font3_fnt",t.width=226,t.height=160,t.textAlign="center",t.anchorOffsetX=113,t.anchorOffsetY=80,t.x=400,t.y=550,t.scaleX=t.scaleY=6,t.alpha=0,t.text=e,i._group.addChild(t),egret.Tween.get(t).to({scaleX:1,scaleY:1,alpha:1},800,egret.Ease.quadOut).call(function(){t.text="",App.Display.removeFromParent(t),Game.ObjPool.putDown(t)})}var t=this,i=this;return new Promise(function(i,n){e("3"),Game.SoundManager.playSound("countdown"),egret.setTimeout(function(){e("2"),Game.SoundManager.playSound("countdown")},t,750),egret.setTimeout(function(){e("1"),Game.SoundManager.playSound("countdown")},t,1500),egret.setTimeout(function(){e("g"),Game.SoundManager.playSound("go")},t,2250),egret.setTimeout(function(){i()},t,3e3)})},e.prototype.playBattleAddLine=function(){var t=e.playerPool.pickUp("BattleAttack");t.x=-100,t.y=1300,this._group.addChild(t),t.play(30,0,!0),egret.Tween.get(t).to({x:800},700,egret.Ease.quadInOut).call(function(){t.stop(),App.Display.removeFromParent(t),e.playerPool.putDown(t)})},e.prototype.playBattleInjure=function(t,i){var n=e.playerPool.pickUp("BattleInjure");n.x=i.x-138,n.y=i.y-138,n.scaleX=n.scaleY=4,this._group.addChild(n),n.play(60,0,!1),n.addCompleteCallback(function(){App.Display.removeFromParent(n),e.playerPool.putDown(n)},this),i.scaleX=i.scaleY=1.3,egret.Tween.get(i).to({scaleX:1,scaleY:1},500,egret.Ease.bounceOut)},e.prototype.playVsDefeated=function(t){var i=this;this._targetDefeatGroupList.indexOf(t)<0&&this._targetDefeatGroupList.push(t);var n=e.playerPool.pickUp("BattleInjure");n.x=t.x-138,n.y=t.y-138,n.scaleX=n.scaleY=4,this._group.addChild(n),n.play(80,0,!1),n.addCompleteCallback(function(){App.Display.removeFromParent(n),e.playerPool.putDown(n),App.Display.addGrayFlilter(t),i._bmpDacha.x=t.x-10,i._bmpDacha.y=t.y-16,i._bmpDacha.scaleX=i._bmpDacha.scaleY=8,i._group.addChild(i._bmpDacha),egret.Tween.get(i._bmpDacha).to({scaleX:2,scaleY:2},800,egret.Ease.quadIn),Game.SoundManager.playSound("defeat")},this),egret.setTimeout(function(){t.scaleX=t.scaleY=1.1,egret.Tween.get(t).to({scaleX:1,scaleY:1},350,egret.Ease.quadOut)},this,1100)},e.prototype.removeVsDefeated=function(){this._bmpDacha&&App.Display.removeFromParent(this._bmpDacha);for(var e=0,t=this._targetDefeatGroupList;e<t.length;e++){var i=t[e];App.Display.removeGrayFlilter(i),i.scaleX=i.scaleY=1}App.Tool.clearArray(this._targetDefeatGroupList)},e.playerPool=new FrameListPlayerPool,e}();__reflect(Play_Effect.prototype,"Play_Effect");var PLAY_GROUND_WIDTH=800,Play_Snake=function(){function e(e,t){this._pi=3.141615926535,this._headRotationAdjust=-90,this._active=!0,this._group=e,this._effect=t}return e.prototype.destroy=function(){this._active&&(this.reset(),this._shockedBodyNodeList=null,this._bmpBodyNodeList=null,this._group=null,this._effect=null,this._active=!1)},e.prototype.reset=function(){if(this.removeAllShockedBodyNodes(),this._bmpBodyNodeList)for(var e=this._bmpBodyNodeList.length-1;e>=0;e--)this.removeBodyNode(this._bmpBodyNodeList[e]);this._bmpBodyNodeList=[],this._headX=this._group.width/2,this._headY=this._group.height/2-300,this._angle=this._pi/2,this._speedAdjustPercent=100,this._speedAdjustTime=0},e.prototype.init=function(){this.initBody()},e.prototype.initBody=function(){App.Display.clearDisplayContainer(this._group);var e;e=Game.BmpPool.pickUp("head"+Game.DataCenter.snakeSkinID+"_png",!0),e.touchEnabled=!1,e.x=this._headX,e.y=this._headY,e._ground=0,e.rotation=this._angle,this._bmpBodyNodeList.push(e),this._group.addChild(e),e=Game.BmpPool.pickUp("tail"+Game.DataCenter.snakeSkinID+"_png",!0),e.touchEnabled=!1,e.x=this._headX,e.y=this._headY,e._ground=0,this._bmpBodyNodeList.push(e),this._group.addChildAt(e,0);for(var t=0;6>t;t++)this.addBodyNode(this._nextRandType())},e.prototype._nextRandType=function(){return Math.floor(6*Math.random())+1},e.prototype._moveStep=function(){var e=this._bmpBodyNodeList[0],t=this._speed*this._speedAdjustPercent/100,i=t*Math.cos(this._angle),n=t*Math.sin(this._angle);e.x+=i,e.y+=n,e._dx=i;for(var o,r,s=1;s<this._bmpBodyNodeList.length;s++){o=this._bmpBodyNodeList[s-1],r=this._bmpBodyNodeList[s],i=o.x-r.x,n=o.y-r.y;var a=r._ground||0,h=o._ground||0,u=h-a;u&&(i+=u*PLAY_GROUND_WIDTH);var p=i*this._bodyNodeGapRatio;r.x+=p,r.y+=n*this._bodyNodeGapRatio,r.rotation=180*Math.atan2(n,i)/this._pi+this._headRotationAdjust,r._dx=p}o=this._bmpBodyNodeList[1],i=e.x-o.x,n=e.y-o.y,e.rotation=180*Math.atan2(n,i)/this._pi+this._headRotationAdjust},e.prototype._updateGround=function(){for(var e=0;e<this._bmpBodyNodeList.length;e++){var t=this._bmpBodyNodeList[e],i=t._dx||0,n=t._ground||0;t.x>PLAY_GROUND_WIDTH&&i>0&&(t.x=0,n++),t.x<0&&0>i&&(t.x=PLAY_GROUND_WIDTH,n--),t._ground=n}},e.prototype.updateMove=function(){this._moveStep(),this._updateGround(),this.updateSpeedAdjustTime()},e.prototype.dash=function(e){var t=this._bmpBodyNodeList[0];this._speed*this._speedAdjustPercent/100;t.x=t.x+e*Math.cos(this._angle),t.y=t.y+e*Math.sin(this._angle)},e.prototype.addBodyNode=function(e){var t,i=this._bmpBodyNodeList[0];return t=Game.BmpPool.pickUp("gem"+e+"_png",!0),t.touchEnabled=!1,t.type=e,t.x=i.x,t.y=i.y,t._ground=i._ground,this._group.addChildAt(t,this._group.numChildren-1),this._bmpBodyNodeList.splice(1,0,t),t},e.prototype.changeBodyToSameType=function(){for(var e,t,i=Math.floor(6*Math.random())+1,n=[],o=1;o<this._bmpBodyNodeList.length-1;o++)e=this._bmpBodyNodeList[o],n.push(e);for(var o=0;o<n.length;o++)e=n[o],this.removeBodyNode(e);for(var o=0;o<n.length;o++)e=n[o],t=this.addBodyNode(i),t.x=e.x,t.y=e.y,t.rotation=e.rotation;App.Tool.clearArray(n)},e.prototype.checkRemoveBodyNodesByThreeSame=function(e){if(this._bmpBodyNodeList.length>=5&&this._bmpBodyNodeList[1].type==e&&this._bmpBodyNodeList[2].type==e&&this._bmpBodyNodeList[3].type==e){for(var t,i=[this._bmpBodyNodeList[1],this._bmpBodyNodeList[2],this._bmpBodyNodeList[3]],n=4;n<this._bmpBodyNodeList.length-1;n++)t=this._bmpBodyNodeList[n],t.type==e&&i.push(t);var o=i.length;if(o>=3){this._comboIndex=1,App.MessageCenter.dispatch(GameMessageType.PROCESS_STOP_MOVE);for(var r,s=0;o>s;s++)r=i[s],this._effect&&this._effect.playFrameList("BodyNodeRemove",80,r.x,r.y),this.removeBodyNode(r);Game.SoundManager.playSound("xiao"),egret.setTimeout(function(){App.MessageCenter.dispatch(GameMessageType.PROCESS_DO_BODY_REMOVE,o),this.checkRemoveBodyNodesByCombo(1)},this,380)}}},e.prototype.checkRemoveSameBodyNodesByFirst=function(){for(var e,t=this._bmpBodyNodeList[1].type,i=[],n=1;n<this._bmpBodyNodeList.length-1;n++)e=this._bmpBodyNodeList[n],e.type==t&&i.push(e);var o=i.length;if(o>0){this._comboIndex=1,App.MessageCenter.dispatch(GameMessageType.PROCESS_STOP_MOVE);for(var r,s=0;o>s;s++)r=i[s],this._effect&&this._effect.playFrameList("BodyNodeRemove",80,r.x,r.y),this.removeBodyNode(r);Game.SoundManager.playSound("xiao"),egret.setTimeout(function(){App.MessageCenter.dispatch(GameMessageType.PROCESS_DO_BODY_REMOVE,o),this.checkRemoveBodyNodesByCombo(1)},this,380)}},e.prototype.checkRemoveBodyNodesByCombo=function(e){for(var t,i=[],n=!1,o=e;o<this._bmpBodyNodeList.length-1;o++){t=this._bmpBodyNodeList[o].type,App.Tool.clearArray(i);for(var r=o+1;r<this._bmpBodyNodeList.length&&this._bmpBodyNodeList[r].type==t;r++)i.push(this._bmpBodyNodeList[r]);var s=i.length;if(s>=2){this._comboIndex++;for(var a,h=0;s>h;h++)a=i[h],this._effect&&this._effect.playFrameList("BodyNodeRemove",80,a.x,a.y),this.removeBodyNode(a);Game.SoundManager.playSound("xiao"),n=!0,egret.setTimeout(function(){App.MessageCenter.dispatch(GameMessageType.PROCESS_DO_BODY_REMOVE,s+1),this._effect&&this._effect.playComboRemoveTween(this.comboIndex,a.x,a.y)},this,380);break}}return e<=this._bmpBodyNodeList.length-3?n?egret.setTimeout(function(){this.checkRemoveBodyNodesByCombo(e+1)},this,Math.min(100,450-150*e)):this.checkRemoveBodyNodesByCombo(e+1):App.MessageCenter.dispatch(GameMessageType.PROCESS_CONTINUE_MOVE),0},e.prototype.removeBodyNode=function(e){if(this._active){var t=this._bmpBodyNodeList.indexOf(e);t>=0&&(delete e.type,delete e._ground,delete e._dx,delete e._dy,this._bmpBodyNodeList.splice(t,1),App.Display.removeFromParent(e),e.scaleX=e.scaleY=1,e.alpha=1,e.visible=!0,Game.BmpPool.putDown(e))}},e.prototype.playHeadEatAction=function(){var e=this._bmpBodyNodeList[0];egret.Tween.removeTweens(e),e.scaleX=e.scaleY=1.2,egret.Tween.get(e).to({scaleX:1,scaleY:1},300,egret.Ease.backInOut);var t=this._bmpBodyNodeList[1];egret.Tween.removeTweens(t),t.scaleX=t.scaleY=1.2,egret.Tween.get(t).wait(200).to({scaleX:1,scaleY:1},500,egret.Ease.backInOut)},e.prototype.playEatBonusEffect=function(){var e=this._bmpBodyNodeList[0];this._effect&&this._effect.playFrameList("EatBonus",50,e.x,e.y)},e.prototype.playElectricShockAction=function(){function e(){var t;if(this._bmpBodyNodeList[0].visible){for(t=0;t<this._bmpBodyNodeList.length;t++)this._bmpBodyNodeList[t].visible=!1;for(t=0;t<this._shockedBodyNodeList.length;t++)this._shockedBodyNodeList[t].visible=!0}else{for(t=0;t<this._bmpBodyNodeList.length;t++)this._bmpBodyNodeList[t].visible=!0;for(t=0;t<this._shockedBodyNodeList.length;t++)this._shockedBodyNodeList[t].visible=!1}r++,r>6&&App.GlobalRepeatTigger.removeTime(e,this)}this.removeAllShockedBodyNodes(),this._shockedBodyNodeList=[];var t,i,n=this._bmpBodyNodeList.length;i=Game.BmpPool.pickUp("tail-1_png",!0),i.touchEnabled=!1,t=this._bmpBodyNodeList[n-1],t.alpha=.2,i.x=t.x,i.y=t.y,i.rotation=t.rotation,this._shockedBodyNodeList.push(i),this._group.addChild(i);for(var o=n-2;o>=1;o--)t=this._bmpBodyNodeList[o],t.alpha=.2,i=Game.BmpPool.pickUp("body-1_png",!0),i.touchEnabled=!1,i.x=t.x,i.y=t.y,i.rotation=t.rotation,this._shockedBodyNodeList.push(i),this._group.addChild(i);i=Game.BmpPool.pickUp("head-1_png",!0),i.touchEnabled=!1,t=this._bmpBodyNodeList[0],t.alpha=.2,i.x=t.x,i.y=t.y,i.rotation=t.rotation,this._shockedBodyNodeList.push(i),this._group.addChild(i);var r=0;App.GlobalRepeatTigger.addTime(80,e,this,!0)},e.prototype.removeAllShockedBodyNodes=function(){if(this._active&&this._shockedBodyNodeList){for(var e,t=0;t<this._shockedBodyNodeList.length;t++)e=this._shockedBodyNodeList[t],App.Display.removeFromParent(e),e.alpha=1,e.visible=!0,delete e.type,delete e._ground,delete e._dx,delete e._dy,Game.BmpPool.putDown(e);App.Tool.clearArray(this._shockedBodyNodeList)}},e.prototype.timeLimitedSpeedAdjust=function(e){this._speedAdjustPercent+=e,this._speedAdjustTime=300},e.prototype.updateSpeedAdjustTime=function(){this._speedAdjustTime>0&&(this._speedAdjustTime--,this._speedAdjustTime<=0&&(this._speedAdjustPercent=100))},Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(e){1>e&&(e=1),this._speed=e,this._bodyNodeGapRatio=.005*e+.16},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._bmpBodyNodeList[0].x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._bmpBodyNodeList[0].y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"comboIndex",{get:function(){return this._comboIndex},enumerable:!0,configurable:!0}),e}();__reflect(Play_Snake.prototype,"Play_Snake");var STONE_HIGHT=72,STONE_WIDTH=80,STONE_COLUM=10,Play_Stone=function(){function e(e,t){this._stonesBottom=1380,this._active=!0,this._group=e,this._effect=t,this._stonesBottom=ViewPort.stageBondBox.height-45}return e.prototype.destroy=function(){this._active&&(this.reset(),this._stoneList=null,this._group=null,this._effect=null,this._active=!1)},e.prototype.reset=function(){if(this._group.cacheAsBitmap=!1,this._stoneList)for(var e,t=this._stoneList.length-1;t>=0;t--)e=this._stoneList[t],this.removeStone(e);this._stoneList=[]},e.prototype.init=function(){},e.prototype.checkCollision=function(e,t){var i=this.baseLines,n=this._stonesBottom-i*STONE_HIGHT;if(t>n)return!0;if(n-STONE_HIGHT>t)return!1;var o=this.stoneCount,r=o%STONE_COLUM,s=r*STONE_WIDTH;return s>e?!0:!1},e.prototype.addStone=function(e){void 0===e&&(e=1);var t=Game.BmpPool.pickUp("stone"+e+"_png");t.touchEnabled=!1;var i=this._stoneList.length,n=Math.floor(i/STONE_COLUM),o=i%STONE_COLUM;t.x=o*STONE_WIDTH+STONE_WIDTH/2,t.y=this._stonesBottom-n*STONE_HIGHT-0,this._stoneList.push(t),this._group.addChild(t)},e.prototype.removeStoneLineAtTop=function(){if(this._stoneList.length>0){this._group.cacheAsBitmap=!1;var e=this._stoneList[this._stoneList.length-1];this._effect&&this._effect.playFrameList("StoneLineRemove",80,0,e.y);for(var t=this._stoneList.length,i=Math.ceil(t/STONE_COLUM),n=(i-1)*STONE_COLUM;t>n;n++)e=this._stoneList.pop(),e&&this.removeStone(e);this._group.cacheAsBitmap=!0}},e.prototype.removeStoneLineAtBottom=function(){if(this._stoneList.length>0){this._group.cacheAsBitmap=!1;var e=this._stoneList[0];this._effect&&this._effect.playFrameList("StoneLineRemove",80,0,e.y);for(var t=0;STONE_COLUM>t;t++)e=this._stoneList.shift(),e&&this.removeStone(e);var i=this._stoneList.length;if(i>0)for(var t=0;i>t;t++)e=this._stoneList[t],e.y+=STONE_HIGHT;this._group.cacheAsBitmap=!0}},e.prototype.removeStone=function(e){e&&(App.Display.removeFromParent(e),e.alpha=1,e.scaleX=e.scaleY=1,Game.BmpPool.putDown(e))},e.prototype.addStones=function(e){for(var t=0;e>t;t++)this.addStone(2)},e.prototype.addStoneLineAtBottom=function(e){void 0===e&&(e=1);for(var t,i=0;STONE_COLUM>i;i++){t=Game.BmpPool.pickUp("stone"+e+"_png"),t.touchEnabled=!1;var n=-1,o=i;t.x=o*STONE_WIDTH+STONE_WIDTH/2,t.y=this._stonesBottom-n*STONE_HIGHT-0,this._stoneList.unshift(t),this._group.addChildAt(t,0)}for(var r=this._stoneList.length,i=0;r>i;i++)t=this._stoneList[i],t.y-=STONE_HIGHT},Object.defineProperty(e.prototype,"stoneCount",{get:function(){return this._stoneList.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseLines",{get:function(){return Math.floor(this._stoneList.length/STONE_COLUM)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stoneBaseY",{get:function(){var e=Math.floor(this._stoneList.length/STONE_COLUM);return this._stonesBottom-e*STONE_HIGHT},enumerable:!0,configurable:!0}),e}();__reflect(Play_Stone.prototype,"Play_Stone");var FRAME_INTERVAL=16,PlayProc=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._baseTouchX=400,t._baseTouchY=712,t._curTouchX=400,t._curTouchY=712,t._snakeSpeedInitial=5,t._bonusSpeedInitial=3,t._multiRemoveBase=10,t._crazyEatModeTime=0,t._curFrame=0,t._startTime=0,t._isTimeOver=!1,t._isGameBGStarted=!1,t._isCanShareRelive=!0,t}return __extends(t,e),t.prototype.beginProc=function(){e.prototype.beginProc.call(this,Views.PlaySceneView),this._effect=new Play_Effect(this._view.groupEffect),this._bonus=new Play_Bonus(this._view.groupBonus),this._snake=new Play_Snake(this._view.groupSnake,this._effect),this._stone=new Play_Stone(this._view.groupStone,this._effect),this._battle=new Play_Battle(this._view,this._stone,this._effect),App.LayerManager.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageTouch,this),App.LayerManager.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageTouch,this),App.MessageCenter.addListener(GameMessageType.PROCESS_STOP_MOVE,this.onProcessStopMove,this),App.MessageCenter.addListener(GameMessageType.PROCESS_CONTINUE_MOVE,this.onProcessContinueMove,this),App.MessageCenter.addListener(GameMessageType.PROCESS_DO_BODY_REMOVE,this.onProcessBodyRemove,this),App.MessageCenter.addListener(GameMessageType.PROCESS_GAME_START,this.doStartGame,this),App.MessageCenter.addListener(GameMessageType.PROCESS_GAME_RESET,this.doResetGame,this),App.MessageCenter.addListener(GameMessageType.PROCESS_BATTLE_RESULT,this.doBattleResult,this),App.MessageCenter.addListener(GameMessageType.PROCESS_BATTLE_CANCEL,this.doBattleEnd,this),this._inGame=!1},t.prototype.endProc=function(){this._active&&(App.GlobalRepeatTigger.removeTime(this.onSnakeAndBonusSpeedUp,this),App.GlobalRepeatTigger.removeTime(this.onCountDown,this),this.stopUpdateMove(),Game.SoundManager.stopSound("bg"),App.MessageCenter.removeByThisObj(this),App.CallbackMappingCenter.unRegisterByThisObj(this),App.LayerManager.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageTouch,this),App.LayerManager.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageTouch,this),App.LayerManager.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouch,this),App.MessageCenter.removeListener(GameMessageType.PROCESS_STOP_MOVE,this.onProcessStopMove,this),App.MessageCenter.removeListener(GameMessageType.PROCESS_CONTINUE_MOVE,this.onProcessContinueMove,this),App.MessageCenter.removeListener(GameMessageType.PROCESS_DO_BODY_REMOVE,this.onProcessBodyRemove,this),App.MessageCenter.removeListener(GameMessageType.PROCESS_GAME_START,this.doStartGame,this),App.MessageCenter.removeListener(GameMessageType.PROCESS_GAME_RESET,this.doResetGame,this),App.MessageCenter.removeListener(GameMessageType.PROCESS_BATTLE_RESULT,this.doBattleResult,this),App.MessageCenter.removeListener(GameMessageType.PROCESS_BATTLE_CANCEL,this.doBattleEnd,this),this._battle&&this._battle.destroy(),this._battle=null,this._stone&&this._stone.destroy(),this._stone=null,this._bonus&&this._bonus.destroy(),this._bonus=null,this._snake&&this._snake.destroy(),this._snake=null,this._effect&&this._effect.destroy(),this._effect=null,this._view=null,e.prototype.endProc.call(this))},t.prototype.viewReady=function(){this._view=this._bindingView},t.prototype._provideScore=function(){return this._inGame?this._score:0},t.prototype.doStartGame=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,r=this;return __generator(this,function(s){switch(s.label){case 0:return App.LoopLoading.hide(),App.WindowViewManager.closeAll(),App.MessageCenter.dispatch(GameMessageType.PROCESS_TRIGGER_GC),Game.DataCenter.playMode=e,0==Game.DataCenter.continueGame?(this._snake.speed=this._snakeSpeedInitial,this._bonus.baseSpeed=this._bonusSpeedInitial,this._score=0,this._isCanShareRelive=!0):this._isCanShareRelive=!1,this.doResetGame(),celerSDK.provideScore(this._provideScore.bind(this)),Math.seedrandom(12),t=AppConfig.textGuide,i="def",AppConfig.isRelease&&(n=celerSDK.getMatch(),n&&(i=n.matchId,Math.seedrandom(n.sharedRandomSeed),n.shouldLaunchTutorial&&(t=!0))),t?(o=new Promise(function(e,t){var i=function(){App.MessageCenter.removeListener(GameMessageType.PROCESS_GAME_GUIDE,i,r),e()};App.MessageCenter.addListener(GameMessageType.PROCESS_GAME_GUIDE,i,r)}),App.WindowViewManager.show(Views.GuideWindowView),[4,o]):[3,2];case 1:s.sent(),s.label=2;case 2:return this.doInit(),this._view&&this._view.updateCountDown(0),StatLog.Instance.write("tcs_start",i),2!=Game.DataCenter.playMode?[3,4]:(this._view.setBattleMode(),this._battle.reset(),[4,this._effect.playBattleStartCountDown()]);case 3:return s.sent(),[3,6];case 4:return this._view.setNormalMode(),this._view.updateScore(this._score,!0),Game.DataCenter.continueGame?[4,this._effect.playBattleStartCountDown()]:[3,6];case 5:s.sent(),s.label=6;case 6:return AppConfig.timeLimit>0&&(this._view&&this._view.updateCountDown(AppConfig.timeLimit),App.GlobalRepeatTigger.addTime(1e3,this.onCountDown,this)),this.startUpdateMove(),3==DataCenter.Instance.snakeSkinID&&this.startCrazyEatMode(450),App.GlobalRepeatTigger.addTime(1e4,this.onSnakeAndBonusSpeedUp,this),[2]}})})},t.prototype.doResetGame=function(){this.stopUpdateMove(),this._effect.reset(),this._bonus.reset(),this._snake.reset(),this._stone.reset(),this._inGame=!1,this._curFrame=0,this._startTime=0},t.prototype.doInit=function(){this._inGame=!0,this._crazyEatModeTime=0,this._stopMoveCount=0,this._curFrame=0,this._startTime=Utility.Time.Ticks,this._isTimeOver=!1,this._isGameBGStarted=!1,this._effect.init(),this._bonus.init(),this._snake.init(),this._stone.init(),Game.DataCenter.score=0,this._score=0},Object.defineProperty(t.prototype,"curTime",{get:function(){return this._curFrame*FRAME_INTERVAL},enumerable:!0,configurable:!0}),t.prototype.onCountDown=function(){var e=Math.floor(.001*this.curTime),t=Math.max(0,AppConfig.timeLimit-e);this._view&&this._view.updateCountDown(t),0>=t&&(this._isTimeOver=!0,this.doGameOver(!0))},t.prototype.onProcessStopMove=function(){this._stopMoveCount++,this.stopUpdateMove()},t.prototype.onProcessContinueMove=function(){this._stopMoveCount--,this._stopMoveCount<=0&&(this._stopMoveCount=0,this._baseTouchX=this._curTouchX,this._baseTouchY=this._curTouchY,this.startUpdateMove())},t.prototype.onProcessBodyRemove=function(e){var t;e>0&&(t=10*e),e>=this._multiRemoveBase&&(this._stone.removeStoneLineAtBottom(),t=20*e),t*=this._snake.comboIndex,this._score+=t,1==Game.DataCenter.playMode&&this._view.updateScore(this._score)},t.prototype.startUpdateMove=function(){this._updateMoving=!0,App.GlobalRepeatTigger.addFrame(this.updateMove,this,!0)},t.prototype.stopUpdateMove=function(){App.GlobalRepeatTigger.removeFrame(this.updateMove,this),this._updateMoving=!1},t.prototype.updateMove=function(){if(this._curFrame++,this._curTouchX!=this._baseTouchX||this._curTouchY!=this._baseTouchY){var e=this._curTouchX-this._baseTouchX,t=this._curTouchY-this._baseTouchY,i=e*e+t*t;i>16&&(this._snake.angle=Math.atan2(t,e),i=.5*Math.sqrt(i),i>150&&(i=150),this._snake.dash(i)),this._baseTouchX=this._curTouchX,this._baseTouchY=this._curTouchY}this._bonus.updateMove(),this._snake.updateMove(),this._crazyEatModeTime>0&&this._bonus.drawAllBonusToSnakeLoc(this._snake.x,this._snake.y);for(var n,o=this._stone.stoneBaseY,r=this._bonus.bonusList.length-1;r>=0;r--)n=this._bonus.bonusList[r],n.y>o&&(this._bonus.removeBonus(n),this._stone.addStone());var s=this._snake.x,a=this._snake.y,h=this._bonus.checkCollision(s,a);if(0!=h)if(Game.SoundManager.playSound("chi"),this._snake.playHeadEatAction(),this._score++,this._crazyEatModeTime>0)h>0&&this._snake.addBodyNode(h);else switch(0>h&&this._snake.playEatBonusEffect(),h){case-1:this._snake.checkRemoveSameBodyNodesByFirst();break;case-2:this._snake.changeBodyToSameType();break;case-3:this._snake.timeLimitedSpeedAdjust(60);break;case-4:this._snake.timeLimitedSpeedAdjust(-60);break;case-5:this.doGameOver(!0);break;case-6:this.startCrazyEatMode();break;default:this._snake.addBodyNode(h),this._snake.checkRemoveBodyNodesByThreeSame(h)}1==Game.DataCenter.playMode&&this._view.updateScore(this._score);var u=this._stone.checkCollision(s,a),p=this._bonus.getFirstBoom();if(p){var c=this._stone.checkCollision(p.x,p.y+p.height);c&&(this._bonus.removeBonus(p),this._stone.removeStoneLineAtTop())}var l=ViewPort.stageBondBox;(u||s<l.x||s>l.x+l.width||a<l.y||a>l.y+l.height)&&this.doGameOver(!0),this._crazyEatModeTime>0&&(this._crazyEatModeTime--,this._crazyEatModeTime<=0&&this.endCrazyEatMode())},t.prototype.startCrazyEatMode=function(e){void 0===e&&(e=300),this._crazyEatModeTime=e},t.prototype.endCrazyEatMode=function(){this._crazyEatModeTime=0},t.prototype.doGameOver=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return this._inGame=!1,App.GlobalRepeatTigger.removeTime(this.onSnakeAndBonusSpeedUp,this),App.GlobalRepeatTigger.removeTime(this.onCountDown,this),this.stopUpdateMove(),Game.SoundManager.stopSound("bg"),Game.SoundManager.playSound("over"),e&&this._snake.playElectricShockAction(),2!=Game.DataCenter.playMode?[3,1]:(e&&(this._battle&&this._battle.finish(),App.MessageCenter.dispatch(GameMessageType.PROCESS_BATTLE_SELF_OVER)),[3,4]);case 1:return Game.DataCenter.updateScore(this._score)?[4,Game.DataCenter.saveUserCloudStorage()]:[3,3];case 2:i.sent(),i.label=3;case 3:t=this._score,egret.setTimeout(function(){App.WindowViewManager.show(Views.ResultWindowView);var e=this._isTimeOver?500:2e4;egret.setTimeout(function(){Log.trace("submit score "+t),StatLog.Instance.write("tcs_end",Game.DataCenter.matchId),celerSDK.submitScore(t)},this,e)},this,1e3),i.label=4;case 4:return[2]}})})},t.prototype.onSnakeAndBonusSpeedUp=function(){this._snake.speed+=.65,this._bonus.baseSpeed+=.26,this._snake.speed>40&&(this._snake.speed=40),this._bonus.baseSpeed>9&&(this._snake.speed=9)},t.prototype.onStageTouch=function(e){if(this._isGameBGStarted||(Game.SoundManager.playSound("bg"),this._isGameBGStarted=!0),this._updateMoving)switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:this._curTouchX=e.stageX,this._curTouchY=e.stageY,this._baseTouchX=this._curTouchX,this._baseTouchY=this._curTouchY;break;case egret.TouchEvent.TOUCH_MOVE:this._curTouchX=e.stageX,this._curTouchY=e.stageY}},t.prototype.doBattleEnd=function(){2==Game.DataCenter.playMode&&this._battle&&(this._battle.finish(),App.GlobalRepeatTigger.removeTime(this.onSnakeAndBonusSpeedUp,this),App.GlobalRepeatTigger.removeTime(this.onCountDown,this),this.stopUpdateMove(),Game.SoundManager.stopSound("bg"),this._inGame=!1)},t.prototype.doBattleResult=function(e){if(2==Game.DataCenter.playMode&&this._battle){var t;t=e?Game.DataCenter.isFirstPlayerInBattle?this._view.groupTX0:this._view.groupTX1:Game.DataCenter.isFirstPlayerInBattle?this._view.groupTX1:this._view.groupTX0,this._effect.playVsDefeated(t),0==e&&this.doBattleEnd()}},Object.defineProperty(t.prototype,"inGame",{get:function(){return this._inGame},enumerable:!0,configurable:!0}),t}(Core.BaseProc);__reflect(PlayProc.prototype,"PlayProc");var CountDownClock=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(e,t,i,n){void 0===i&&(i=null),void 0===n&&(n=null),this._txtTime=e,this._remainedSeconds=t,this._completeCallFunc=i,this._completeCallThis=n,this._paused=!1,App.GlobalRepeatTigger.addTime(1e3,this.onTimerHandle,this,!0)},t.prototype.pause=function(){this.pause?(App.GlobalRepeatTigger.addTime(1e3,this.onTimerHandle,this,!1),this._paused=!1):(App.GlobalRepeatTigger.removeTime(this.onTimerHandle,this),this._paused=!0)},t.prototype.end=function(){App.GlobalRepeatTigger.removeTime(this.onTimerHandle,this),this._paused=!1,this._txtTime=null,this._completeCallFunc=null,this._completeCallThis=null},t.prototype.onTimerHandle=function(){this._txtTime&&(this._txtTime.text=String(this._remainedSeconds),0==this._remainedSeconds?this._completeCallFunc&&this._completeCallFunc.apply(this._completeCallThis):this._remainedSeconds--)},t}(Core.BaseSingleton);__reflect(CountDownClock.prototype,"CountDownClock");var FakeShare=function(){function e(){this.startTick=0,this.endTick=0,this.waiter=null,this.isRandomed=!1}return e}();__reflect(FakeShare.prototype,"FakeShare");var GameVersion="1.5.0",DataCenter=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.appName="贪吃蛇三消",t.cfgHost="www.chiji-h5.com",t.authHost="www.chiji-h5.com/auth",t.host1="www.chiji-h5.com/app/tanchishe/",t.host2="www.chiji-h5.com/rank/tanchishe/",t.cdnHost="chiji-h5.com",t.adUnitId="adunit-b1f1bfa1cc3350cd",t.gameCfgUri="tanchishe/config.json",t.hiScore=0,t.score=0,t.gold=0,t.skins=0,t.qualifyingInfo=null,t.battleMode=0,t.isFirstPlayerInBattle=!1,t.continueGame=!1,t.lastGameIsContinued=!1,t._curSnakeSkinID=0,t.lastGameAdIdx=-1,t._dataMask={},t}return __extends(t,e),Object.defineProperty(t,"Instance",{get:function(){return t.getInstance()},enumerable:!0,configurable:!0}),t.prototype.init=function(){this._doShareInfo=new FakeShare,this.loadSnakeSkinID(),this.markData("gold")
},t.prototype.markData=function(e){this._dataMask[e]=!0},t.prototype.isDataMarked=function(e){return this._dataMask.hasOwnProperty(e)?this._dataMask[e]:!1},t.prototype.clearMark=function(e){return this._dataMask.hasOwnProperty(e)?this._dataMask[e]=!1:void 0},t.prototype.haveSkin=function(e){return e>0&&(this.skins&1<<e-1)>0},t.prototype.updateScore=function(e){return this.score=e,this.hiScore=parseInt(App.LocalStorageData.load("snake01_high_score")),isNaN(this.hiScore)&&(this.hiScore=0),this.score>this.hiScore?(this.hiScore=this.score,App.LocalStorageData.save("snake01_high_score",String(this.hiScore)),!0):!1},t.prototype.submitScore=function(e){},t.prototype.saveUserCloudStorage=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},t.prototype.loadSnakeSkinID=function(){this._curSnakeSkinID=parseInt(App.LocalStorageData.load("snake01_skinID")),isNaN(this._curSnakeSkinID)&&(this._curSnakeSkinID=0)},t.prototype.setSnakeSkinID=function(e){this._curSnakeSkinID=e,App.LocalStorageData.save("snake01_skinID",String(e))},Object.defineProperty(t.prototype,"snakeSkinID",{get:function(){return this._curSnakeSkinID},enumerable:!0,configurable:!0}),t.prototype.getAvatarID=function(){if(!this.loginData)return"";var e=this.loginData.userInfo.avatarUrl;if(e&&e.length>8){var t=e.split("/");if(t.length>=5)return e.split("/")[5]}return""},t.prototype.getAvatarPath=function(){if(!this.loginData)return"";var e=this.loginData.userInfo.avatarUrl;return e&&e.length>8?e.substring(8):""},t.prototype.getNick=function(){return this.loginData?this.loginData.userInfo.nickName:""},t.prototype.getAvatark=function(){return this.loginData?this.loginData.userInfo.avatarUrl:""},Object.defineProperty(t.prototype,"storeKey",{get:function(){return""},enumerable:!0,configurable:!0}),t.prototype.isInNewDay=function(){var e=App.LocalStorageData.load(this.storeKey+"_daily");if(!e)return!0;var t=new Date,i=new Date,n=i.getTime();try{n=parseInt(e),i.setTime(n),Log.trace("daily time stamp: ["+e+"]: "+i.toString())}catch(o){}var r=i.getFullYear()<t.getFullYear(),s=i.getMonth()<t.getMonth(),a=i.getDate()<t.getDate();return r||s||a?!0:!1},t.prototype.SaveDailyTimeStamp=function(){var e=new Date;Log.trace("daily time stamp: save to ["+e.getTime()+"]: "+e.toString()),App.LocalStorageData.save(this.storeKey+"_daily",e.getTime().toString())},t.prototype.acceptShareSkin=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.haveSkin(3)?[2]:[2]})})},t.prototype.buySkin4=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},t.prototype.toShareImgePath=function(e){return"resource/ui/system/"+e},t.prototype.onShow=function(){this._doShareInfo.endTick=Utility.Time.Ticks,this._doShareInfo.waiter&&this._doShareInfo.waiter.resolve()},t.prototype.queryAssets=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},t.prototype.uploadInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},t.prototype.showDailyGold=function(e){},t.prototype.requestGameCfg=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return e=this.cfgHost+"/"+this.gameCfgUri+"?v="+Math.floor(1e4*Math.random()),[4,HttpNet.request(e)];case 1:return t=i.sent(),t?Log.trace("game config: ",t):Log.trace("game config: Not found!"),[2]}})})},t}(Core.BaseSingleton);__reflect(DataCenter.prototype,"DataCenter");var HttpNet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.request=function(e,t,i,n){return void 0===i&&(i="GET"),void 0===n&&(n=!1),__awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(o){switch(o.label){case 0:return e.indexOf("http")<0&&(e="https://"+e),Log.trace('[http request]: "'+e+'"'),[4,platform.request(e,i,t)];case 1:return(n=o.sent())?[2,n.data]:(Log.trace("net work not usable"),[2,null])}})})},t.rawRequest=function(e,t,i,n){return void 0===i&&(i="GET"),void 0===n&&(n=0),__awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(r){switch(r.label){case 0:return e.indexOf("http")<0&&(e="https://"+e),[4,platform.request(e,i,t)];case 1:return o=r.sent(),Log.trace("Net","resp",o),o&&o.data?[2,o.data]:[3,2];case 2:return o?"request:ok"==o.errMsg?[2,null]:"request:fail"==o.errMsg&&10>n?[4,Utility.Async.Defer(1e3)]:[3,5]:[3,5];case 3:return r.sent(),[4,this.rawRequest(e,t,i,n+1)];case 4:return[2,r.sent()];case 5:return Log.trace("net work not usable"),[2,null]}})})},t}(Core.BaseSingleton);__reflect(HttpNet.prototype,"HttpNet");var PlatformSoundManager=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._innerAudioContextMap=new Core.HashMap,t._soundRes=Object.create(null),t}return __extends(t,e),t.prototype.initSound=function(e,t,i){t=t.replace("\\","/");var n=t.substr(t.lastIndexOf("/")+1);this._soundRes[e]={res:n.replace(".","_"),loop:i,bg:i};this._soundRes[e],platform.platformRuntime()},t.prototype.playSound=function(e){var t=this._soundRes[e];t&&(t.bg?Core.SoundManager.getInstance().playBg(t.res):Core.SoundManager.getInstance().playEffect(t.res,1))},t.prototype.stopSound=function(e){var t=this._soundRes[e];t&&t.bg&&Core.SoundManager.getInstance().stopBg()},t}(Core.BaseSingleton);__reflect(PlatformSoundManager.prototype,"PlatformSoundManager");var SoundController=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._soundEffectOn=!0,t._fangyanOn=!0,t}return __extends(t,e),t.prototype.init=function(){var e=App.LocalStorageData.load(t.KEY1);this._soundEffectOn="true"==e||null==e;var i=App.LocalStorageData.load(t.KEY2);this._fangyanOn="true"==i||null==i,App.SoundManager.setEffectOn(this._soundEffectOn)},Object.defineProperty(t.prototype,"soundEffectOn",{get:function(){return this._soundEffectOn},set:function(e){this._soundEffectOn=e,App.SoundManager.setEffectOn(this._soundEffectOn),e?App.LocalStorageData.save(t.KEY1,"true"):App.LocalStorageData.save(t.KEY1,"false")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fangYanOn",{get:function(){return this._fangyanOn},set:function(e){this._fangyanOn=e,e?App.LocalStorageData.save(t.KEY2,"true"):App.LocalStorageData.save(t.KEY2,"false")},enumerable:!0,configurable:!0}),t.KEY1="pdsmj_soundeffect_enable",t.KEY2="pdsmj_fangyan",t}(Core.BaseSingleton);__reflect(SoundController.prototype,"SoundController");var StatLogItem=function(){function e(){}return e}();__reflect(StatLogItem.prototype,"StatLogItem");var StatLog=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._logUrl="https://sdkpoint.chiji-h5.com/record-receive/api/game",t._appId="wx393e2a11aa8f47fa",t}return __extends(t,e),Object.defineProperty(t,"Instance",{get:function(){return t.getInstance()},enumerable:!0,configurable:!0}),t.prototype.init=function(e,t){void 0===t&&(t=!0),this._evtDic=new Utility.Dictionary,this._statUnit=e,this.isUpload=t,AppConfig.uploadStat&&App.GlobalRepeatTigger.addTime(200,this.onUpdate,this)},t.prototype.write=function(e,t){if(AppConfig.uploadStat){this._evtDic.contains(e)||this._evtDic.add(e,new Utility.HandyArray(100,!0));var i=this._evtDic.get(e),n=new StatLogItem;n.localTimeStamp=Utility.Time.Ticks,n.statData=t,i.enqueue(n)}},t.prototype.onUpdate=function(){var e=this;this._evtDic.keys.forEach(function(t,i){var n=e._evtDic.get(t);if(n&&!(n.length<=0)){var o=n.dequeue();if(Log.trace("[StatLog]: <"+t+"> ==> ["+JSON.stringify(o)+"]"),e.isUpload){var r={ak:e._appId,tp:t,appid:e._appId,event:t,channel:"celerx",evp:o.statData,matchId:o.statData},s=e._logUrl;HttpNet.rawRequest(s,r,"POST")}}})},t}(Core.BaseSingleton);__reflect(StatLog.prototype,"StatLog");var Tool=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.converTimeFormat=function(e,t){var i,n=Math.floor(e/3600),o=Math.floor((e-3600*n)/60),r=Math.floor(e-3600*n-60*o);return i=String(r),1==i.length&&(i="0"+i),i=":"+i,i=String(o)+i,4==i.length&&(i="0"+i),(n>0||0==t)&&(i=":"+i,i=String(n)+i,7==i.length&&(i="0"+i)),i},t}(Core.BaseSingleton);__reflect(Tool.prototype,"Tool");var FrameListPlayer=function(e){function t(){var t=e.call(this)||this;return t._sourceDataList=[],t._curFrameIdx=0,t._bmp=new egret.Bitmap,t.addChild(t._bmp),t}return __extends(t,e),t.prototype.destroy=function(){this.stop(),App.Tool.clearArray(this._sourceDataList),this._sourceDataList=null,this._completeCallFunc=null,this._completeCallthisObj=null,App.Display.removeFromParent(this._bmp),this._bmp.texture=null,this._bmp=null},t.prototype.addFrame=function(e,t,i){var n={source:e,offsetX:t,offsetY:i};this._sourceDataList.push(n)},t.prototype.addFrameList=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0);for(var n=0;n<e.length;n++)this.addFrame(e[n],t,i)},t.prototype.addCompleteCallback=function(e,t){void 0===t&&(t=null),this._completeCallFunc=e,this._completeCallthisObj=t},t.prototype.play=function(e,t,i){void 0===t&&(t=-1),void 0===i&&(i=!1),t>=0&&(this._curFrameIdx=t),this._loop=i,17>=e?App.GlobalRepeatTigger.addFrame(this.updateFrame,this,!0):App.GlobalRepeatTigger.addTime(e,this.updateFrame,this,!0)},t.prototype.stop=function(e){void 0===e&&(e=!1),App.GlobalRepeatTigger.removeTime(this.updateFrame,this),App.GlobalRepeatTigger.removeFrame(this.updateFrame,this),e&&(this._bmp.texture=null),this._completeCallFunc=null,this._completeCallthisObj=null},t.prototype.updateFrame=function(){if(this._curFrameIdx<0&&(this._curFrameIdx=0),this._curFrameIdx>=this._sourceDataList.length){if(!this._loop)return App.GlobalRepeatTigger.removeTime(this.updateFrame,this),void(this._completeCallFunc&&this._completeCallFunc.call(this._completeCallthisObj,this));this._curFrameIdx=0}var e=this._sourceDataList[this._curFrameIdx];this._bmp.texture=RES.getRes(e.source),this._bmp.x=e.offsetX,this._bmp.y=e.offsetY,this._curFrameIdx++},t}(egret.DisplayObjectContainer);__reflect(FrameListPlayer.prototype,"FrameListPlayer");var ParticlesPlayer=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.create=function(){return null},t.prototype.play=function(){},t.prototype.stop=function(){},t.prototype.destroy=function(){},t}(egret.DisplayObjectContainer);__reflect(ParticlesPlayer.prototype,"ParticlesPlayer");var ParticleDot=function(){function e(){}return e.prototype.update=function(e){},e}();__reflect(ParticleDot.prototype,"ParticleDot");var Views;!function(e){var t=function(e){function t(){var t=e.call(this,PlaySceneSkin)||this;return t.touchEnabled=t.touchChildren=!1,t._scoreValue=0,t.groupTitle0.visible=!0,t.groupTitle1.visible=!1,t.txtScore.text="0",t.txtCountdown.text="",t}return __extends(t,e),t.prototype.onViewReady=function(){this.width=ViewPort.stageBondBox.width,this.height=ViewPort.stageBondBox.height,this.y=ViewPort.stageBondBox.y,App.MessageCenter.dispatch("ui.view_ready")},t.prototype.updateScore=function(e,t){void 0===t&&(t=!1),(this._scoreValue!=e||t)&&(t?this.txtScore.text=String(e):App.Display.tweenLabelNumber(this.txtScore,e),this._scoreValue=e,egret.Tween.removeTweens(this.txtScore),this.txtScore.scaleX=this.txtScore.scaleY=1.3,egret.Tween.get(this.txtScore).to({scaleX:1,scaleY:1},500,egret.Ease.quadOut))},t.prototype.setNormalMode=function(){this.groupTitle0.visible=!0,this.groupTitle1.visible=!1,this.clearImageTX(),this.txtScore.text="0"},t.prototype.updateCountDown=function(e){var t=e%60,i=Math.round((e-t)/60)%60;this.txtCountdown.text=(i>9?i.toString():"0"+i.toString())+":"+(t>9?t.toString():"0"+t.toString())},t.prototype.setBattleMode=function(){this.groupTitle0.visible=!1,this.groupTitle1.visible=!0,this.clearImageTX();var e;e=Game.DataCenter.firstPlayerDataInBattle.avatar,e&&(e.indexOf("https://")<0&&(e="https://"+e),App.Display.loadImageByUrl(this.imgTX0,e)),e=Game.DataCenter.secondPlayerDataInBattle.avatar,e&&(e.indexOf("https://")<0&&(e="https://"+e),App.Display.loadImageByUrl(this.imgTX1,e)),this.imgMask0.height=this.imgMask1.height=0,this.imgMask0.y=this.imgMask1.y=123},t.prototype.updateTXMask=function(e,t){var i;i=e?this.imgMask0:this.imgMask1;var n=t/170;n>1&&(n=1),0>n&&(n=0),i.height=108*n,i.y=123-i.height},t.prototype.clearImageTX=function(){this.imgTX0.texture&&(this.imgTX0.texture.dispose(),this.imgTX0.texture=null),this.imgTX1.texture&&(this.imgTX1.texture.dispose(),this.imgTX1.texture=null)},t}(Core.BaseEuiView);e.PlaySceneView=t,__reflect(t.prototype,"Views.PlaySceneView")}(Views||(Views={}));var Views;!function(e){var t=function(e){function t(){var t=e.call(this,GuideSkin,!0)||this;return t._currentIdx=0,t._lastTick=0,t._currentIdx=0,t}return __extends(t,e),t.prototype.init=function(){this.btnNext.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnNext,this),this.btnPre.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnPre,this),this.btnClose0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnClose,this),this.btnClose1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnClose,this),this.btnClose2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnClose,this),this.btnClose3.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnClose,this),this.grp_guides.x=0,this._currentIdx=0,this.btnPre.visible=!1,this.btnNext.visible=!0,App.GlobalRepeatTigger.addTime(6180,this._onTimeOver,this)},t.prototype.destroy=function(){this._active&&(this.btnNext.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnNext,this),this.btnPre.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnPre,this),this.btnClose0.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnClose,this),this.btnClose1.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnClose,this),this.btnClose2.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnClose,this),this.btnClose3.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnClose,this),App.GlobalRepeatTigger.removeTime(this._onTimeOver,this)),App.MessageCenter.dispatch(GameMessageType.PROCESS_GAME_GUIDE),e.prototype.destroy.call(this)},t.prototype.onBtnNext=function(){if(this._lastTick){var e=Utility.Time.Ticks,t=e-this._lastTick;if(1e3>t)return}this._lastTick=0,this._checkShowNext()},t.prototype.onBtnPre=function(){if(this._lastTick){var e=Utility.Time.Ticks,t=e-this._lastTick;if(1e3>t)return}this._lastTick=0,this._checkShowPre()},t.prototype.onBtnClose=function(){App.WindowViewManager.close(this)},t.prototype._checkShowNext=function(){this._currentIdx>=3?App.WindowViewManager.close(this):(this._showNext(),App.GlobalRepeatTigger.removeTime(this._onTimeOver,this),App.GlobalRepeatTigger.addTime(6180,this._onTimeOver,this))},t.prototype._checkShowPre=function(){this._currentIdx<=0||(this._showPre(),App.GlobalRepeatTigger.removeTime(this._onTimeOver,this),App.GlobalRepeatTigger.addTime(6180,this._onTimeOver,this))},t.prototype._onTimeOver=function(){this._lastTick=Utility.Time.Ticks,App.GlobalRepeatTigger.removeTime(this._onTimeOver,this),this._checkShowNext()},t.prototype._showNext=function(){this._currentIdx++;var e=this.grp_guides.$children,t=e.length,i=this._currentIdx%t;this.btnPre.visible=this._currentIdx>=1,this.btnNext.visible=this._currentIdx<t-1;var n=0-i*this.width;egret.Tween.removeTweens(this.grp_guides),egret.Tween.get(this.grp_guides).to({x:n},600,egret.Ease.quartOut)},t.prototype._showPre=function(){this.btnPre.visible=this._currentIdx>1,this._currentIdx--;var e=this.grp_guides.$children,t=e.length;this.btnNext.visible=this._currentIdx<t-1;var i=this._currentIdx%t,n=0-i*this.width;egret.Tween.removeTweens(this.grp_guides),egret.Tween.get(this.grp_guides).to({x:n},600,egret.Ease.quartOut)},t}(Core.BaseEuiWindow);e.GuideWindowView=t,__reflect(t.prototype,"Views.GuideWindowView")}(Views||(Views={}));var Views;!function(e){var t=function(e){function t(){var t=e.call(this,ResultWindowSkin,!0)||this;t._onTop=!1,App.Display.addButtonPushEffect(t.btnContinue,t.onBtnPush,t);egret.Tween.get(t.img_glow,{loop:!0}).to({rotation:360},5e3);return t}return __extends(t,e),t.prototype.destroy=function(){this._active&&(Game.DataCenter.lastGameIsContinued=!1,App.Display.removeButtonPushEffect(this.btnContinue)),e.prototype.destroy.call(this)},t.prototype.init=function(){Game.DataCenter.submitScore(Game.DataCenter.score),this.txtScore.text=String(Game.DataCenter.score),DataCenter.Instance.markData("gold")},t.prototype.whenToTop=function(e){Log.trace("Result window to top"),this._onTop=!0},t.prototype.whenDropFromTop=function(e){this._onTop=!1,Log.trace("Result window drop from top")},t.prototype.whenOpenedNewWin=function(e){},t.prototype.onBtnPush=function(e){switch(e){case this.btnContinue:Log.trace("submit score "+Game.DataCenter.score),StatLog.Instance.write("tcs_end",Game.DataCenter.matchId),celerSDK.submitScore(Game.DataCenter.score),AppConfig.isRelease||App.MessageCenter.dispatch(GameMessageType.PROCESS_GAME_START,1)}},t}(Core.BaseEuiWindow);e.ResultWindowView=t,__reflect(t.prototype,"Views.ResultWindowView")}(Views||(Views={}));var Utility;!function(e){var t=function(){function e(){}return e.From=function(e){return Promise.resolve(e)},e.Defer=function(e,t){return void 0===t&&(t=!1),new Promise(function(i,n){setTimeout(function(){t?n():i()},e)})},e.NextFrame=function(e,t){return void 0===t&&(t=!1),new Promise(function(i,n){var o=function(r){return t?n():i(),e.stopTick(o,null),!1};e.startTick(o,null)})},e.Frames=function(e,t,i){void 0===i&&(i=!1);var n=0;return new Promise(function(o,r){var s=function(a){return n++,n>=t&&(i?r():o(),e.stopTick(s,null)),!1};e.startTick(s,null)})},e.FromEvent=function(e,t,i,n,o){return new Promise(function(r,s){var a=function(n){e.removeEventListener(t,a,null,i),r({evt:n,target:n.currentTarget})};if(e.addEventListener(t,a,null,i,n),o){var h=function(t){e.removeEventListener(o,h,null,i),s({evt:t,target:t.currentTarget})};e.addEventListener(o,h,null,i,n)}})},e.FromEventEx=function(e){return new Promise(function(t,i){var n=function(i){e.obj.removeEventListener(e.evtName,n,null),t({evt:i,target:i.currentTarget})};if(e.obj.addEventListener(e.evtName,n,null,e.useCapture,e.priority),e.errEvtName){var o=function(t){e.obj.removeEventListener(e.errEvtName,o,null),i({evt:t,target:t.currentTarget})};e.obj.addEventListener(e.errEvtName,o,null,e.useCapture,e.priority)}})},e.FromSFCAsync=function(e){return new Promise(function(t,i){e.success=function(e){t(e)},e.fail=function(e){i(e)},e.complete=function(e){t(e)}})},e.createAsync=function(){var e={resolve:null,reject:null},t=new Promise(function(t,i){e.resolve=t,e.reject=i}),i={future:t,completion:e,canceled:!1,cancele:function(){return i.canceled=!0}};return i},e}();e.Async=t,__reflect(t.prototype,"Utility.Async")}(Utility||(Utility={}));var AsyncOperation=function(){function e(){}return e}();__reflect(AsyncOperation.prototype,"AsyncOperation");var AsyncEx=function(){function e(){this._asyncOps=new Utility.Dictionary}return e.prototype.isInProgress=function(e){var t=this._asyncOps.get(e);return void 0!=t&&null!=t},e.prototype.delegateAsyncResolve=function(e,t){var i=this;return function(n){if(i._asyncOps.remove(e.opName),t(n),e.asyncOps){for(var o=0,r=e.asyncOps.length;r>o;o++){var s=e.asyncOps[o];s.completion.resolve(n)}e.asyncOps=null}}},e.prototype.delegateAsyncReject=function(e,t){var i=this;return function(n){if(i._asyncOps.remove(e.opName),t(n),e.asyncOps){for(var o=0,r=e.asyncOps.length;r>o;o++){var s=e.asyncOps[o];s.completion.reject(n)}e.asyncOps=null}}},e.prototype.tryAsyncOperation=function(e,t){void 0===t&&(t=!0);var i=this._asyncOps.get(e);if(i){if(t){var n=Utility.Async.createAsync();return i.asyncOps||(i.asyncOps=[]),i.asyncOps.push(n),{isMain:!1,future:n.future}}return null}i=Utility.ObjectPool.Instance.pickUp(AsyncOperation),i.opName=e;var o=Utility.Async.createAsync();return i.mainAsyncOp=o,this._asyncOps.set(e,i),o.completion.resolve=this.delegateAsyncResolve(i,o.completion.resolve),o.completion.reject=this.delegateAsyncReject(i,o.completion.resolve),{isMain:!0,completion:o.completion}},e=__decorate([singleton],e)}();__reflect(AsyncEx.prototype,"AsyncEx");var Core;!function(e){var t=function(){function e(e){this._skin=e,this._active=!0;for(var t in this._skin)egret.DisplayObject.prototype.isPrototypeOf(this._skin[t])&&"hostComponent"!=t&&"_hostComponent"!=t&&(this[t]=this._skin[t])}return e.prototype.destroy=function(){for(var e in this._skin)egret.DisplayObject.prototype.isPrototypeOf(this._skin[e])&&"hostComponent"!=e&&"_hostComponent"!=e&&delete this[e];this._skin=null,this._active=!1},e.prototype.getChild=function(e){return this._skin[e]},e.prototype.callbackProccessor=function(e,t){void 0===t&&(t=null),App.CallbackMappingCenter.doCallback(this,e,t)},e.prototype.bindingCallbackProccessWith=function(e){App.CallbackMappingCenter.register(this.callbackProccessor,this,e)},e}();e.BaseUnitView=t,__reflect(t.prototype,"Core.BaseUnitView")}(Core||(Core={}));var Utility;!function(e){var t=function(){function e(){this._dic={}}return e.prototype.contains=function(e){return this._dic.hasOwnProperty(e)},e.prototype.add=function(e,t){this.set(e,t)},e.prototype.remove=function(e){this._dic.hasOwnProperty(e)&&delete this._dic[e]},e.prototype.reset=function(){var e=Object.keys(this._dic);if(e&&e.length>0)for(var t=0;t<e.length;t++){var i=e[t];delete this._dic[i]}},e.prototype.get=function(e){return this._dic.hasOwnProperty(e)?this._dic[e]:void 0},e.prototype.set=function(e,t){if(this._dic.hasOwnProperty(e)){var i=this._dic[e];if(i==t)return}this._dic[e]=t},Object.defineProperty(e.prototype,"keys",{get:function(){return Object.keys(this._dic)},enumerable:!0,configurable:!0}),e}();e.Dictionary=t,__reflect(t.prototype,"Utility.Dictionary");var i=function(){function e(){this._idxMap=new t,this._arr=[],this._lastEmptyIdx=0}return e.prototype.contains=function(e){return this._idxMap.contains(e)},e.prototype.add=function(e,t){return this.set(e,t)},e.prototype.remove=function(e){var t=this._idxMap.get(e);if(this._idxMap.remove(e),void 0!=t){this._lastEmptyIdx=t;var i=this._arr[t];return this._arr[t]=void 0,i}},e.prototype.reset=function(){this._idxMap.reset(),this._arr=[],this._lastEmptyIdx=0},e.prototype.get=function(e){var t=this._idxMap.get(e);if(void 0!=t){var i=this._arr[t];return i}},e.prototype.set=function(e,t){var i=this._idxMap.get(e);if(void 0!=i)return this._arr[i]=t,i;for(var n=this._lastEmptyIdx,o=this._arr.length;o>n;n++){var r=this._arr[n];if(void 0==r){this._lastEmptyIdx=n;break}}return this._arr[this._lastEmptyIdx]=t,this._idxMap.set(e,this._lastEmptyIdx),this._lastEmptyIdx++,this._lastEmptyIdx-1},Object.defineProperty(e.prototype,"arrar",{get:function(){return this._arr},enumerable:!0,configurable:!0}),e}();e.AccociatedArray=i,__reflect(i.prototype,"Utility.AccociatedArray")}(Utility||(Utility={}));var Utility;!function(e){var t=function(){function e(e,t){var i=null==e?20:e,n=null==t?!1:t;this.init(i),this.IsAutoAdaptive=n}return e.prototype.clone=function(t){t<this.length&&(t=this.length);for(var i=new e(t),n=0;n<this.length;n++){var o=this.get_at(n);i.push(o)}return i.IsAutoAdaptive=this.IsAutoAdaptive,i},e.prototype.reset=function(){for(var e=0;e<this.mCapacity;e++)delete this.mItemList[e],this.mItemList[e]=void 0;this.mYinYang=-1,this.mNIndex=this.mNFreeIndex=0,this.mMIndex=this.mMFreeIndex=0},e.prototype.init=function(e){this.mItemList=new Array(e),this.mCapacity=e,this.mYinYang=-1,this.mNIndex=this.mNFreeIndex=0,this.mMIndex=this.mMFreeIndex=0,this.IsAutoAdaptive=!1},e.prototype.moveClockwise=function(e,t){return e=(e+t)%this.mCapacity},e.prototype.moveReverseClockwise=function(e,t){return e+=this.mCapacity-t,e%=this.mCapacity},e.prototype.reAdaptCapacity=function(e){var t=this.length,i=this.mItemList;if(t>e&&(e=t),this.mItemList=new Array(e),t>0){var n=0;this.mItemList[n++]=i[this.mNIndex];var o=this.mNIndex;for(o=this.moveClockwise(o,1);o!=this.mMIndex;o=this.moveClockwise(o,1))this.mItemList[n++]=i[o]}this.mNIndex=0,this.mNFreeIndex=0,this.mMIndex=t,this.mMFreeIndex=this.mMIndex,this.mCapacity=e,0==t?this.mYinYang=-1:t==this.mCapacity?this.mYinYang=1:this.mYinYang=0},Object.defineProperty(e.prototype,"IsAutoAdaptive",{get:function(){return this._autoadaptive},set:function(e){this._autoadaptive=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.mYinYang<0?0:this.mYinYang>0?this.mCapacity:(this.mCapacity-this.mNIndex+this.mMIndex)%this.mCapacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"freeCount",{get:function(){return this.mCapacity-this.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nFree",{get:function(){return this.mNFreeIndex<=this.mNIndex?this.mNIndex-this.mNFreeIndex:this.mCapacity-this.mNFreeIndex+this.mNIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mFree",{get:function(){return this.mMIndex<=this.mMFreeIndex?this.mMFreeIndex-this.mMIndex:this.mCapacity-this.mMIndex+this.mMFreeIndex},enumerable:!0,configurable:!0}),e.prototype.tryMoreCapacity=function(){if(this.IsAutoAdaptive){var e=this.mCapacity>512?this.mCapacity+(1024-this.mCapacity%1024):this.mCapacity+this.mCapacity;e<this.mCapacity||this.reAdaptCapacity(e)}},e.prototype.allocForN=function(e){return 0>=e?0:this.freeCount<e&&(this.tryMoreCapacity(),this.freeCount<e)?0:(this.mNFreeIndex=this.moveReverseClockwise(this.mNFreeIndex,e),e)},e.prototype.freeFromN=function(e){return 0>=e||this.length<=0?0:(e>=this.length?(e=this.length,this.mYinYang=-1):this.mYinYang=0,this.mNIndex=this.moveClockwise(this.mNIndex,e),e)},e.prototype.allocForM=function(e){return 0>=e?0:this.freeCount<e&&(this.tryMoreCapacity(),this.freeCount<e)?0:(this.mMFreeIndex=this.moveClockwise(this.mMFreeIndex,e),e)},e.prototype.freeFromM=function(e){return 0>=e||this.length<=0?0:(e>=this.length?(e=this.length,this.mYinYang=-1):this.mYinYang=0,this.mMIndex=this.moveReverseClockwise(this.mMIndex,e),e)},e.prototype.rPush=function(e){return this.nFree<1&&this.allocForN(1)<=0?!1:(this.mNIndex=this.moveReverseClockwise(this.mNIndex,1),this.mNIndex==this.mMIndex?this.mYinYang=1:this.mYinYang=0,this.mItemList[this.mNIndex]=e,!0)},e.prototype.rPop=function(){if(!(this.length<=0)){var e=this.mItemList[this.mNIndex];return this.mItemList[this.mNIndex]=void 0,this.freeFromN(1),e}},e.prototype.push=function(e){return this.mFree<1&&this.allocForM(1)<=0?!1:(this.mItemList[this.mMIndex]=e,this.mMIndex=this.moveClockwise(this.mMIndex,1),this.mNIndex==this.mMIndex?this.mYinYang=1:this.mYinYang=0,!0)},e.prototype.pop=function(){if(!(this.length<=0)){this.freeFromM(1);var e=this.mItemList[this.mMIndex];return this.mItemList[this.mMIndex]=void 0,e}},e.prototype.enqueue=function(e){return this.push(e)},e.prototype.dequeue=function(){return this.rPop()},e.prototype.rEnqueue=function(e){return this.rPush(e)},e.prototype.rDequeue=function(){return this.pop()},e.prototype.dequeueAt=function(e){if(!(this.length<=0||e>=this.length)){for(var t=this[e],i=e;i>0;i--)this.set_at(i,this.get_at(i-1));return this.rPop(),t}},e.prototype.indexFromNOffset=function(e){if(e>=this.length)throw"IndexOutOfRangeException";var t=this.mNIndex;return 0==e?t:t=(this.mNIndex+e)%this.mCapacity},e.prototype.indexFromMOffset=function(e){if(e>=this.length)throw"IndexOutOfRangeException";var t=this.mMIndex-1-e;return 0>t&&(t+=this.mCapacity),t},e.prototype.atOffset=function(e){var t=this.indexFromNOffset(e);return this.mItemList[t]},e.prototype.atOffsetR=function(e){var t=this.indexFromMOffset(e);return this.mItemList[t]},e.prototype.atFixOffset=function(e){if(0>e||e>this.mItemList.length)throw"IndexOutOfRangeException";return this.mItemList[e]},e.prototype.get_at=function(e){var t=this.indexFromNOffset(e);return this.mItemList[t]},e.prototype.set_at=function(e,t){var i=this.indexFromNOffset(e);this.mItemList[i]=t},e}();e.HandyArray=t,__reflect(t.prototype,"Utility.HandyArray")}(Utility||(Utility={}));var Helper=function(){function e(){}return e.buildRectShape=function(e,t,i){void 0===i&&(i=65280);var n=new egret.Shape;return n.graphics.beginFill(i,1),n.graphics.drawRect(0,0,e,t),n.graphics.endFill(),n},e.loadLocalImg=function(e){var t=RES.getRes(e);if(!t)return null;var i=new egret.Bitmap;return i.texture=t,i},e.loadRemoteImg=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,r,s;return __generator(this,function(a){switch(a.label){case 0:return t=Utility.ObjectPool.Instance.pickUp(egret.ImageLoader),i=Utility.Async.FromEvent(t,egret.Event.COMPLETE),t.load(e),[4,i];case 1:return n=a.sent(),Utility.ObjectPool.Instance.putDown(t),n.target.data?(o=String.digestMD5(e),r=n.target.data,Utility.NamedCache.Instance.cacheObj(o,r),s=new egret.BitmapData(r.source),[2,s]):[2,null]}})})},e.loadRemoteTexture=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o;return __generator(this,function(r){switch(r.label){case 0:return t=String.digestMD5(e),i=Utility.NamedCache.Instance.getObj(t),null!=i?[3,2]:[4,this.loadRemoteImg(e)];case 1:return i=r.sent(),[3,3];case 2:n=new egret.BitmapData(i.source),i=n,r.label=3;case 3:return i?(o=new egret.Texture,o._setBitmapData(i),o.disposeBitmapData=!1,[2,o]):[2,null]}})})},e.loadRemoteImgIntoBitmap=function(e,t){var i=String.digestMD5(t),n=Utility.NamedCache.Instance.getObj(i);if(null!=n){var o=new egret.BitmapData(n.source),r=new egret.Texture;return e.texture&&(e.texture=null),r._setBitmapData(o),r.disposeBitmapData=!1,void(e.texture=r)}this.loadRemoteImg(t).then(function(t){var i=new egret.Texture;e.texture&&(e.texture=null),i._setBitmapData(t),i.disposeBitmapData=!1,e.texture=i})},e.formatResDigit=function(e){for(var t=-1,i=e;i>=1e3;)t++,i/=1e3;return t>=0?""+i.toFixed(2)+this.ResDigitUnits[t]:""+e.toFixed(0)},e.formatTime=function(e,t){void 0===t&&(t=!0);var i=("00"+Math.floor(e%60)).substr(-2);if(t){var n=Math.floor(e%3600/60),o=("00"+n).substr(-2),r=("00"+Math.floor(e/3600)).substr(-2);return r+":"+o+":"+i}var n=Math.floor(e/60),o=null;return o=100>n?("00"+n).substr(-2):n,o+":"+i},e.fixShareCanvas=function(e,t){var i=e.width/e.height,n=t.width/t.height;n>i?(i=t.width/e.width,e.width=t.width,e.height=e.height*i):(i=t.height/e.height,e.height=t.height,e.width=e.width*i)},e.loadResGroup=function(e,t,i){var n=Utility.Async.FromEvent(RES,RES.ResourceEvent.GROUP_COMPLETE,!1,0,RES.ResourceEvent.GROUP_LOAD_ERROR),o=RES.loadGroup(e,t,i);return o?(n["catch"](function(){}),o):n},e.loadResConfig=function(e,t){var i=Utility.Async.FromEvent(RES,RES.ResourceEvent.CONFIG_COMPLETE,!1,0,RES.ResourceEvent.CONFIG_LOAD_ERROR),n=RES.loadConfig(e,t);return n?(i["catch"](function(){}),n):i},e.invokeAsyncWxAPI=function(e,t){var i=Utility.Async.FromSFCAsync(t);return e(t),i},e.cloneBaseProperty=function(e,t){for(var i in t)i.indexOf("__")<0&&t.hasOwnProperty(i)&&(e[i]=t[i])},e.altBaseObj=function(e,t){for(var i in e)i.indexOf("__")<0&&t.hasOwnProperty(i)&&(t[i]=e[i]);return t},e.applyMixins=function(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(i){e.prototype[i]=t.prototype[i]})})},e.ResDigitUnits=["K","M","B","T","a","b","c","d","e","f","g","h"],e}();__reflect(Helper.prototype,"Helper");var MixBase=function(){function e(){}return e}();__reflect(MixBase.prototype,"MixBase");var Loading=function(){function e(){this._loadingsPrioritQueue=[]}return e.prototype.buildLoading=function(e,t,i){void 0===i&&(i=!0);var n=null,o=this._loadingsPrioritQueue[t+1];o||(o=new Utility.HandyArray(2,!0),this._loadingsPrioritQueue[t+1]=o);var r=this,s=function(){n.isClosed=!0,r.refreshUI()};return n={title:e,useMask:i,close:s,isClosed:!1},o.push(n),r.refreshUI(),n},e.prototype.refreshUI=function(){for(var e=null,t=0,i=this._loadingsPrioritQueue.length;i>t;t++){var n=this._loadingsPrioritQueue[t];if(n){for(;n.length>0;){var o=n.get_at(n.length-1);{if(!o.isClosed){e=o;break}n.pop()}}if(null!=e)break}}this._theUI&&(e?this._theUI.show(e.title,e.useMask):this._theUI.hide())},e.prototype.attachUI=function(e){this._theUI=e,this.refreshUI()
},e.prototype.showLoading=function(e,t){return void 0===t&&(t=!0),this.buildLoading(e,0,t)},e.prototype.showTopMostLoading=function(e,t){return void 0===t&&(t=!0),this.buildLoading(e,-1,t)},e.prototype.showDispensableLoading=function(e,t){return void 0===t&&(t=!0),this.buildLoading(e,1,t)},e.prototype.hideAll=function(){this._theUI&&this._theUI.hide();for(var e=0,t=this._loadingsPrioritQueue.length;t>e;e++){var i=this._loadingsPrioritQueue[e];if(i)for(;i.length>0;){i.dequeue()}}},e=__decorate([singleton],e)}();__reflect(Loading.prototype,"Loading");var Utility;!function(e){var t=function(){function e(){}return e.prototype.onPickUp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.onPutDown=function(){},e}();e.IPoolableObj=t,__reflect(t.prototype,"Utility.IPoolableObj");var i=function(){function t(){this._classList=[]}return t.prototype.pickUp=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var o=t.__objPool;o||(o=new e.HandyArray(10,!0),t.__objPool=o,this._classList.push(t));var r=void 0;return o.length>0&&(r=o.pop()),r||(r=new t),"function"==typeof r.onPickUp&&r.onPickUp.apply(r,i),r},t.prototype.putDown=function(t){var i=t.constructor;if(i){var n=i.__objPool;n||(n=new e.HandyArray(10,!0),i.__objPool=n,this._classList.push(i)),asType(t,function(e){return void 0!=e.onPutDown})&&t.onPutDown(),n.push(t)}},t.prototype.clear=function(){for(var e=0;e<this._classList.length;e++){var t=this._classList[e],i=t.__objPool;i&&i.reset()}},t=__decorate([singleton],t)}();e.ObjectPool=i,__reflect(i.prototype,"Utility.ObjectPool");var n=function(){function t(){this._cache=new e.Dictionary}return t.prototype.getObj=function(e){var t=this._cache.get(e);return t},t.prototype.cacheObj=function(e,t){this._cache.add(e,t)},t=__decorate([singleton],t)}();e.NamedCache=n,__reflect(n.prototype,"Utility.NamedCache");var o=function(){function t(){this._pool=new e.Dictionary}return t.prototype.pickUp=function(t,i){void 0===i&&(i=null);for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var r=this._pool.get(t);r||(r=new e.HandyArray(10,!0),this._pool.add(t,r));var s=void 0;if(r.length>0&&(s=r.pop()),!s){if(!i)return null;s=new i,s.__pool_key__=t}return"function"==typeof s.onPickUp&&s.onPickUp.apply(s,n),s},t.prototype.putDown=function(t,i){if(void 0===i&&(i=null),i&&""!=i||(i=t.__pool_key__),i&&""!=i){var n=this._pool.get(i);n||(n=new e.HandyArray(10,!0),this._pool.add(i,n)),asType(t,function(e){return void 0!=e.onPutDown})&&t.onPutDown(),n.push(t)}},t.prototype.clear=function(){for(var e=this._pool.keys,t=0;t<e.length;t++){var i=this._pool.get(e[t]);i&&i.reset()}},t=__decorate([singleton],t)}();e.NamedObjectPool=o,__reflect(o.prototype,"Utility.NamedObjectPool")}(Utility||(Utility={}));var Utility;!function(e){var t=function(){function e(){this.flag=-1,this.spinPeriod=50}return e}();__reflect(t.prototype,"LockEntryImple",["Utility.LockEntry"]);var i=function(){function i(){}return Object.defineProperty(i,"Instance",{get:function(){var e=this;return e.__instance||(e.__instance=new i),e.__instance},enumerable:!0,configurable:!0}),i.prototype.getLock=function(i){this._locks||(this._locks=new e.Dictionary);var n=this._locks.get(i);return n||(n=new t,this._locks.add(i,n)),n},i.prototype.destroyLock=function(e){this._locks.contains(e)&&this._locks.remove(e)},i.isHaveOwner=function(e){var t=e;if(!t)throw"Invalid param type";return t.flag>=0},i.tryEnterWrite=function(t,i){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(o){switch(o.label){case 0:if(n=t,!n)throw"Invalid param type";if(n.flag++,0==n.flag)return[2,!0];if(n.flag--,!i)return[2,!1];o.label=1;case 1:return n.flag>=0?[4,e.Async.Defer(50)]:[3,3];case 2:return o.sent(),[3,1];case 3:return[2,!1]}})})},i.leaveWrite=function(e){var t=e;if(!t)throw"Invalid param type";t.flag--},i}();e.STLock=i,__reflect(i.prototype,"Utility.STLock")}(Utility||(Utility={}));var Utility;!function(e){var t=function(){function e(){}return Object.defineProperty(e,"Now",{get:function(){return new Date},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Ticks",{get:function(){return Date.now()},enumerable:!0,configurable:!0}),e}();e.Time=t,__reflect(t.prototype,"Utility.Time");var i=function(){function e(){}return Object.defineProperty(e.prototype,"val",{get:function(){return 0},set:function(e){this.onValChanged(e)},enumerable:!0,configurable:!0}),e.prototype.onValChanged=function(e){this.onStep&&(this.onStep(e),this.onValChanged=this.onStep)},e}();e.TweenExt=i,__reflect(i.prototype,"Utility.TweenExt")}(Utility||(Utility={}));var Utility;!function(e){var t=function(){function e(){this._isInActive=!1}return e.prototype.onPickUp=function(e){e&&this.init(e)},e.prototype.onPutDown=function(){this.unInit()},e.prototype.init=function(e){this._updater=e,this.current=0,this._isInActive=!1},e.prototype.unInit=function(){this.stop()},e.prototype.start=function(e,t){this.current=e,t||(t=function(e,t){return t+e}),this._nextNumber=t,this._isInActive||(this._updater.startTick(this.onFrame,this),this._isInActive=!0)},e.prototype.stop=function(){this._updater.stopTick(this.onFrame,this),this._isInActive=!1},e.prototype.onFrame=function(e){return this._nextNumber&&(this.current=this._nextNumber(e,this.current)),!1},e}();e.TimeSeq=t,__reflect(t.prototype,"Utility.TimeSeq")}(Utility||(Utility={}));var TouchEvtType;!function(e){e[e.TOUCH_BEGIN=1]="TOUCH_BEGIN",e[e.TOUCH_TAP=2]="TOUCH_TAP",e[e.TOUCH_HELD=3]="TOUCH_HELD",e[e.TOUCH_SWEEP=4]="TOUCH_SWEEP",e[e.TOUCH_STOP=5]="TOUCH_STOP",e[e.TOUCH_MOVE=6]="TOUCH_MOVE"}(TouchEvtType||(TouchEvtType={}));var TouchHelp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t,"Touch",{get:function(){var e=t.getInstance();return null==e._touch&&(e._touch=new TouchInfer),e._touch},enumerable:!0,configurable:!0}),t}(Core.BaseSingleton);__reflect(TouchHelp.prototype,"TouchHelp");var TouchInfer=function(){function e(){this._curTouchX=0,this._curTouchY=0,this._lastMoveTick=0,this._isActivate=!1,this._touchState=0}return e.prototype.init=function(){App.LayerManager.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),App.LayerManager.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),App.LayerManager.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onStageTouch,this),App.LayerManager.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTuchEnd,this),App.LayerManager.stage.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onStageTouch,this),this._listeners=[]},e.prototype.unInit=function(){App.LayerManager.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),App.LayerManager.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),App.LayerManager.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onStageTouch,this),App.LayerManager.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTuchEnd,this),App.LayerManager.stage.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onStageTouch,this)},e.prototype.addListener=function(e){for(var t=0;t<this._listeners.length;t++)if(this._listeners[t]==e)return;this._listeners.push(e)},e.prototype.removeListener=function(e){for(var t=0;t<this._listeners.length;t++)if(this._listeners[t]==e)return void this._listeners.slice(t,1)},e.prototype.onTouchBegin=function(e){this._curTouchX=e.stageX,this._curTouchY=e.stageY,this._lastMoveTick=0,this._datas=[],this._isActivate=!0,this._touchState=1,this._datas.push({x:e.stageX,y:e.stageY,t:egret.getTimer(),e:e}),this.callBegin(e)},e.prototype.onTouchMove=function(e){if(this._datas){1==this._touchState&&(this._touchState=2),this._curTouchX=e.stageX,this._curTouchY=e.stageY,this._datas.length>30&&this._datas.shift();var t=egret.getTimer();this._datas.push({x:e.stageX,y:e.stageY,t:t,e:e}),this._lastMoveTick=t,this.callMove(e)}},e.prototype.onTuchEnd=function(e){if(this._datas){this._isActivate=!1;var t={x:e.stageX,y:e.stageY,t:egret.getTimer()},i=this._datas[this._datas.length-1];if(this._datas.length<=1)return void this.callTap(e);var n=t.t-i.t,o=this._datas[this._datas.length-2],r=i.t-o.t,s=i.x-o.x,a=i.y-o.y,h=1e3*s/r,u=1e3*a/r,p=n>0&&50>n;this.callEnd(e,p,h,u)}},e.prototype.onStageTouch=function(e){switch(e.type){case egret.TouchEvent.TOUCH_CANCEL:break;case egret.TouchEvent.TOUCH_RELEASE_OUTSIDE:break;case egret.TouchEvent.TOUCH_TAP:}},e.prototype.callBegin=function(e){for(var t=0;t<this._listeners.length;t++)this._listeners[t](e,TouchEvtType.TOUCH_BEGIN)},e.prototype.callHeld=function(e){for(var t=0;t<this._listeners.length;t++)this._listeners[t](e,TouchEvtType.TOUCH_HELD,this._datas,!0)},e.prototype.callTap=function(e){var t=Math.floor(this._touchState/10);t%=10;for(var i=t%10==1,n=0;n<this._listeners.length;n++)this._listeners[n](e,TouchEvtType.TOUCH_TAP,this._datas,i)},e.prototype.callMove=function(e){var t=Math.floor(this._touchState/10);t%=10;for(var i=t%10==1,n=0;n<this._listeners.length;n++)this._listeners[n](e,TouchEvtType.TOUCH_MOVE,this._datas,i)},e.prototype.callEnd=function(e,t,i,n){var o=Math.floor(this._touchState/10);o%=10;var r=o%10==1;if(t)for(var s=0;s<this._listeners.length;s++)this._listeners[s](e,TouchEvtType.TOUCH_SWEEP,this._datas,r,i,n);else for(var s=0;s<this._listeners.length;s++)this._listeners[s](e,TouchEvtType.TOUCH_STOP,this._datas,r)},e.prototype.updateFrame=function(){if(this._isActivate&&1==this._touchState){var e=this._datas[0],t=egret.getTimer();t-e.t>350&&(this._touchState=11,this.callHeld(e.e))}},e}();__reflect(TouchInfer.prototype,"TouchInfer");